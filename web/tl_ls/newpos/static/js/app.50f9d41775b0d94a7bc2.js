webpackJsonp([1],{"+FSC":function(t,e,a){t.exports=a.p+"static/img/vip_shadow.459a1f6.png"},"/L53":function(t,e){},"8mt4":function(t,e){},Apxf:function(t,e){},BdYy:function(t,e){},H3Hj:function(t,e,a){t.exports=a.p+"static/img/vip_title.7952238.png"},JBSm:function(t,e){},MqRL:function(t,e){},NFed:function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={};a.d(i,"isLock",function(){return T}),a.d(i,"userinfo",function(){return S}),a.d(i,"lockPassWord",function(){return N}),a.d(i,"currentPayMode",function(){return A}),a.d(i,"version",function(){return M}),a.d(i,"statusDots",function(){return B});var s=a("7+uW"),n=a("Dd8w"),o=a.n(n),l=new s.default,r=a("//Fk"),c=a.n(r),u=(a("j1ja"),a("mtWM")),d=a.n(u);var h={LeeRequest:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new c.a(function(e,a){t.timeout=t.timeout||2e4,t.method=t.method||"post",t.data=t.data||{},d()({method:t.method,url:t.url,data:t.data}).then(function(t){200==t.status?e(t.data):a("网络出错："+t.status+"|"+t.statusText)}).catch(a)})},formatDate:function(t,e){var a=t;return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/yyyy|YYYY/,a.getFullYear())).replace(/yy|YY/,a.getYear()%100>9?(a.getYear()%100).toString():"0"+a.getYear()%100)).replace(/MM/,a.getMonth()>8?(a.getMonth()+1).toString():"0"+(a.getMonth()+1))).replace(/M/g,a.getMonth()+1)).replace(/w|W/g,["日","一","二","三","四","五","六"][a.getDay()])).replace(/dd|DD/,a.getDate()>9?a.getDate().toString():"0"+a.getDate())).replace(/d|D/g,a.getDate())).replace(/hh|HH/,a.getHours()>9?a.getHours().toString():"0"+a.getHours())).replace(/h|H/g,a.getHours())).replace(/mm/,a.getMinutes()>9?a.getMinutes().toString():"0"+a.getMinutes())).replace(/m/g,a.getMinutes())).replace(/ss|SS/,a.getSeconds()>9?a.getSeconds().toString():"0"+a.getSeconds())).replace(/s|S/g,a.getSeconds())},formatMoney:function(t,e,a,i){t=(t+"").replace(/[^0-9+-Ee.]/g,"");var s=isFinite(+t)?+t:0,n=isFinite(+e)?Math.abs(e):0,o=void 0===i?",":i,l=void 0===a?".":a,r="";r=(n?function(t,e){var a=Math.pow(10,e);return""+Math.ceil(t*a)/a}(s,n):""+Math.round(s)).split(".");for(var c=/(-?\d+)(\d{3})/;c.test(r[0]);)r[0]=r[0].replace(c,"$1"+o+"$2");return(r[1]||"").length<n&&(r[1]=r[1]||"",r[1]+=new Array(n-r[1].length+1).join("0")),r.join(l)},string2Date:function(t){return new Date(Date.parse(t.replace(/-/g,"/")))},showMessage:function(t,e){e=e||"success",this.$message({message:t,type:e})},sleep:function(t){return new c.a(function(e){setTimeout(e,t)})},showAlert:function(t,e){this.$confirm(t,"提示",{type:e||"success",showCancelButton:!1})}},p=a("NYxO"),f={name:"TopBanner",data:function(){return{timeStr:""}},computed:o()({},Object(p.b)(["userinfo","version","statusDots"])),created:function(){this.timeInterval=null},mounted:function(){var t=this;this.timeInterval?clearInterval(this.timeInterval):this.timeInterval=setInterval(function(){t.timeStr=h.formatDate(new Date,"yyyy-MM-dd 星期w HH:mm:ss")},1e3)},destroyed:function(){clearInterval(this.timeInterval)},methods:{openRightPanel:function(t){l.$emit("openPanel",t)}}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"topBanner"},[t._m(0),t._v(" "),a("div",{staticClass:"banner_content"},[a("span",{staticClass:"title"},[t._v("利郎收银系统\n      "),a("sup",[t._v("v"+t._s(t.version))])]),t._v(" "),a("span",{staticClass:"store_name"},[t._v(t._s(t.userinfo.StoreName))]),t._v(" "),a("div",{staticClass:"banner_right"},[a("span",[t._v("收银员："+t._s(t.userinfo.UserName))]),t._v(" "),a("span",[t._v(t._s(t.timeStr))]),t._v(" "),a("el-badge",{staticClass:"item",attrs:{"is-dot":t.statusDots.distribution,hidden:!1,title:"待配货"}},[a("i",{staticClass:"iconfont icon-suggest",staticStyle:{"font-size":"24px","font-weight":"bold"},on:{click:function(e){e.stopPropagation(),t.openRightPanel("distribution_panel")}}})]),t._v(" "),a("el-badge",{staticClass:"item",attrs:{"is-dot":t.statusDots.cloudOrder,hidden:!1,title:"云 仓"}},[a("i",{staticClass:"iconfont icon-cloudorder",staticStyle:{"font-size":"28px","font-weight":"bold"},on:{click:function(e){e.stopPropagation(),t.openRightPanel("cloudorder_panel")}}})]),t._v(" "),a("el-badge",{staticClass:"item",attrs:{hidden:!1,title:"业绩统计"}},[a("i",{staticClass:"iconfont icon-yeji",staticStyle:{"font-size":"26px"},on:{click:function(e){e.stopPropagation(),t.openRightPanel("achieve_panel")}}})]),t._v(" "),a("el-badge",{staticClass:"item",attrs:{hidden:!1,title:"VIP信息"}},[a("i",{staticClass:"iconfont icon-vip",on:{click:function(e){e.stopPropagation(),t.openRightPanel("vip_panel")}}})]),t._v(" "),a("el-badge",{staticClass:"item",attrs:{"is-dot":t.statusDots.hangupList,hidden:!1,title:"挂单列表"}},[a("i",{staticClass:"iconfont icon-zhangdan",on:{click:function(e){e.stopPropagation(),t.openRightPanel("bill_panel")}}})]),t._v(" "),a("el-badge",{staticClass:"item",attrs:{"is-dot":t.statusDots.systemMessage,title:"消息中心"}},[a("i",{staticClass:"iconfont icon-xiaoxi",on:{click:function(e){e.stopPropagation(),t.openRightPanel("message_panel")}}})])],1)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"logo"},[e("img",{attrs:{src:a("ZBJ4")}})])}]};var m=a("VU/8")(f,v,!1,function(t){a("JBSm")},"data-v-286f0ef2",null).exports,g={props:{selectedName:{type:String,default:"pos"}},data:function(){return{menus:[{name:"pos",cname:"收银",icon:"icon-pos"},{name:"feedback",cname:"反 馈",icon:"icon-yjfk2"},{name:"more",cname:"更多",icon:"icon-more"}]}},methods:{routerGo:function(t){switch(t){case"feedback":l.$emit("openPanel","feedback_panel");break;case"more":this.$message({message:"后续功能正在加紧开发中，敬请期待..",type:"warning"})}}},computed:{selected:function(){return this.selectedName}}},y={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",{staticClass:"menu_ul"},t._l(t.menus,function(e,i){return a("li",{key:i,staticClass:"menu_li",class:{selected:e.name==t.selected},on:{click:function(a){t.routerGo(e.name)}}},[a("i",{staticClass:"iconfont",class:e.icon}),t._v(" "),a("p",{staticClass:"menuname"},[t._v(t._s(e.cname))])])}))},staticRenderFns:[]};var _=a("VU/8")(g,y,!1,function(t){a("xqWK")},"data-v-698b09ad",null).exports,b={data:function(){return{pwd:""}},computed:o()({},Object(p.b)(["lockPassWord"])),mounted:function(){this.listenAnimationEnd()},methods:o()({},Object(p.c)({setLock:"SET_LOCK"}),{listenAnimationEnd:function(){var t=$(".input-wrapper");t.on("webkitAnimationEnd",function(){t.removeClass("shake")})},doUnlock:function(){this.pwd==this.lockPassWord?this.setLock(!1):($(".input-wrapper").addClass("shake"),this.$refs.pwdInput.focus()),this.pwd=""}})},w={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"lock-container"},[a("div",{staticClass:"locking"},[a("div",{staticClass:"headimg"}),t._v(" "),a("p",{staticClass:"username"},[t._v("LILANZ POS")]),t._v(" "),a("div",{ref:"inputForm",staticClass:"input-wrapper animated"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.pwd,expression:"pwd"}],ref:"pwdInput",attrs:{type:"password",placeholder:"请输入解锁密码.."},domProps:{value:t.pwd},on:{keypress:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.doUnlock(e)},input:function(e){e.target.composing||(t.pwd=e.target.value)}}}),t._v(" "),a("button",{staticClass:"btn_unlock",on:{click:t.doUnlock}},[a("i",{staticClass:"el-icon-arrow-right"})])])])])},staticRenderFns:[]};var C=a("VU/8")(b,w,!1,function(t){a("uS+u")},"data-v-d90f4a3e",null).exports,k={name:"app",methods:{openSideBar:function(){l.$emit("switchSideBar")},forbitRight:function(){document.oncontextmenu=function(){return window.event.cancelBubble=!0,window.event.returnValue=!1,window.event.returnValue=!1,!1},document.onmousedown=function(t){if(window.Event){if(2==t.which||3==t.which)return!1}else if(2==event.button||3==event.button)return window.event.cancelBubble=!0,window.event.returnValue=!1,!1}}},created:function(){this.forbitRight()},computed:o()({},Object(p.b)(["isLock"])),components:{TopBanner:m,MenuList:_,LockScreen:C}},x={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("div",{class:{blur:this.isLock},staticStyle:{transition:"all 0.5s"}},[e("div",{staticClass:"top_banner",on:{click:this.openSideBar}},[e("top-banner")],1),this._v(" "),e("div",{staticClass:"left_nav"},[e("menu-list",{attrs:{selectedName:"pos"}})],1),this._v(" "),e("div",{staticClass:"main_area"},[e("router-view")],1)]),this._v(" "),e("lock-screen",{directives:[{name:"show",rawName:"v-show",value:this.isLock,expression:"isLock"}]})],1)},staticRenderFns:[]};var D,P=a("VU/8")(k,x,!1,function(t){a("NFed")},null,null).exports,I=a("mUbh"),T=function(t){return t.isLock},S=function(t){return t.user},N=function(t){return t.lockPassWord},A=function(t){return t.currentPayMode},M=function(t){return t.version},B=function(t){return t.statusDots},R={version:"0.1.5",isLock:!1,lockPassWord:"123456",user:{},statusDots:{cloudOrder:!1,hangupList:!1,systemMessage:!1,distribution:!1},currentPayMode:{payNO:"",payID:"",payCode:"",payName:""}},E=a("bOdI"),L=a.n(E),O=a("woOf"),j=a.n(O),z=(D={},L()(D,"SET_LOCK",function(t,e){t.isLock=e}),L()(D,"SET_USER",function(t,e){t.user=e}),L()(D,"SET_CURRENT_PAYMODE",function(t,e){t.currentPayMode=e}),L()(D,"SET_STATUS_DOTS",function(t,e){t.statusDots=j()({},t.statusDots,e)}),D);a("sax8");s.default.use(p.a);var F=new p.a.Store({getters:i,actions:I,mutations:z,state:R,strict:!1,plugins:[]}),U=a("/ocq"),V=a("mvHQ"),G=a.n(V),H=a("Xxa5"),Y=a.n(H),Z=a("exGp"),Q=a.n(Z),W=a("pFYg"),q=a.n(W),J=200,X="./PosApi.ashx";function K(t,e,a){var i={};return a&&"object"===(void 0===a?"undefined":q()(a))&&"{}"!=G()(a)?(a.params=e,i=a):i.params=e,new c.a(function(a,s){d.a.get(t,i).then(function(t){t.status==J?(a(t.data),console.log("【axios get】action:"+e.action,t.data)):s("Request Fail! Status:"+t.status+" StatusText:"+t.statusText+".")}).catch(function(a){var i=G()(e);console.error("url:"+t+"\r\nparams:"+i+"\r\nerrmsg:"+a),s("Request Error! "+a)})})}function tt(t,e,a){return new c.a(function(i,s){d.a.post(t,e,a||{}).then(function(t){t.status==J?(i(t.data),console.log("【axios post】",t.data)):s("Request Fail! Status:"+t.status+" StatusText:"+t.statusText+".")}).catch(function(a){var i=G()(e);console.error("url:"+t+"\r\nparams:"+i+"\r\nerrmsg:"+a),s("Request Error! "+a)})})}var et=a("mw3O"),at=a.n(et);function it(t){return K(X,j()({},{action:"GetVip",orgid:F.state.user.OrgID,timestamp:(new Date).getTime()},t))}function st(){var t={action:"LoadOrderList",storeid:F.state.user.StoreID,timestamp:(new Date).getTime()};return K(X,t)}function nt(t){var e={action:"LoadPayMode",orgid:F.state.user.OrgID,mode:t,timestamp:(new Date).getTime()};return K(X,e)}function ot(t){var e={action:"SavePrint",storeID:F.state.user.StoreID,data:t,timestamp:(new Date).getTime()};return tt(X,at.a.stringify(e))}function lt(t){var e={action:"MicroPay",storeid:F.state.user.StoreID,orgid:F.state.user.OrgID,timestamp:(new Date).getTime()},a=j()({},e,t);return K(X,a)}function rt(t){var e={action:"UnionPay",orgid:F.state.user.OrgID,storeid:F.state.user.StoreID,userid:F.state.user.UserID,timestamp:(new Date).getTime()},a=j()({},e,t);return K(X,a)}function ct(t){var e={action:"PostarPay",orgid:F.state.user.OrgID,storeid:F.state.user.StoreID,timestamp:(new Date).getTime()},a=j()({},e,t);return K(X,a)}function ut(t){var e={action:"Policies",mdid:249,policiesRequestSalesDetail:t};return tt(X,at.a.stringify(e))}function dt(t){var e={action:"InsLogistics",data:G()(t)};return K(X,e)}var ht={name:"AssistanterList",props:{visiable:{type:Boolean,default:!1},filterWords:{type:String,default:""}},watch:{visiable:function(t){this.show=t,t&&this.getSaler()}},data:function(){return{loading:!0,show:!1,tableData:[]}},created:function(){this.flag=!1},computed:o()({},Object(p.b)(["userinfo"])),methods:{cellClickHandle:function(t,e,a,i){this.flag=!0,this.$emit("select","assistantList",t)},closeDialog:function(){this.flag?this.flag=!1:this.$emit("select","assistantList",{name:"",id:0})},getSaler:function(){var t=this;this.loading=!0,function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a={action:"LoadSaler",orgid:F.state.user.OrgID,cname:t,isclerk:e,timestamp:(new Date).getTime()};return K(X,a)}(this.filterWords,this.userinfo.IsClerk).then(function(e){if(0==e.errcode){var a=e.data.map(function(t){return{id:t.id,name:t.userName,remark:t.remark}});t.tableData=a,t.loading=!1}else t.$confirm("查询营业员失败："+e.errmsg,"提示",{type:"error",showCancelButton:!1}),t.loading=!1})}}},pt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"assistant_wrap",attrs:{title:"请选择营业员",visible:t.show,width:"360px"},on:{"update:visible":function(e){t.show=e},close:t.closeDialog}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"assistant_table",attrs:{"element-loading-text":"正在加载.."}},[a("p",{staticClass:"tip"},[t._v("提示：启用人资系统的，营业员来源于人资档案。")]),t._v(" "),a("el-table",{staticStyle:{width:"337px"},attrs:{data:t.tableData,height:"370"},on:{"cell-click":t.cellClickHandle}},[a("el-table-column",{attrs:{prop:"name",label:"营业员",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"备注",width:"200"}})],1)],1)])},staticRenderFns:[]};var ft=a("VU/8")(ht,pt,!1,function(t){a("Tlhn")},null,null).exports,vt={props:{visiable:{type:Boolean,default:!1},data:{type:Array,default:function(){return[]}}},watch:{visiable:function(t){this.show=t}},data:function(){return{show:!1}},created:function(){this.flag=!1},methods:{cellClickHandle:function(t,e,a,i){this.flag=!0,this.$emit("select","vipList",j()({},t))},closeDialog:function(){this.flag?this.flag=!1:this.$emit("select","vipList",{})}}},mt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"viplist_wrap",attrs:{title:"VIP选择",visible:t.show,width:"440px"},on:{"update:visible":function(e){t.show=e},close:t.closeDialog}},[a("div",{staticClass:"viplist_table"},[a("p",{staticClass:"tip"},[t._v("提示：只显示符合条件的前5条记录。")]),t._v(" "),a("el-table",{attrs:{data:t.data,height:"370"},on:{"cell-click":t.cellClickHandle}},[a("el-table-column",{attrs:{prop:"kh",label:"卡号",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"xm",label:"姓名",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"zk",label:"折扣",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"lx",label:"卡类型",width:"100"}})],1)],1)])},staticRenderFns:[]};var gt=a("VU/8")(vt,mt,!1,function(t){a("c22h")},null,null).exports,yt={props:{mode:{type:String,default:""},visiable:{type:Boolean,default:!1},billInfo:{type:Object,default:function(){return{id:"",code:""}}}},data:function(){return{loading:!1,show:!1,data:[]}},watch:{visiable:function(t){var e=this;this.show=t,t&&(this.flag=!1,this.loading=!0,this._getData().then(function(t){e.data=t,e.$nextTick(function(){e.loading=!1})}).catch(function(t){e.$nextTick(function(){e.loading=!1})}))}},created:function(){this.payMode={},this.flag=!1},methods:{handleCheck:function(t){var e=this,a={billID:this.billInfo.id,payAmount:"",payID:t.ID,category:"check",authCode:""};this.loading=!0,t.isChecking=!0,lt(a).then(function(a){0==a.errcode?(e.$message({type:"success",message:"检查成功！"+a.errmsg,duration:1500}),Number(a.data)>0&&e.$emit("addPayItem",{no:e.mode,payid:t.ID,type:t.payName,count:Number(a.data)},"microCheck")):e.$message({type:"error",message:"检查失败！"+a.errmsg,duration:2e3}),e.loading=!1,t.isChecking=!1}).catch(function(a){e.$message({type:"error",message:"检查失败！！"+a,duration:2e3}),e.loading=!1,t.isChecking=!1})},cellClickHandle:function(t,e,a,i){this.flag||(this.flag=!0,this.$emit("select","paymodelist_dialog",t))},closeDialog:function(){this.flag||this.$emit("select","paymodelist_dialog")},_getData:function(){var t=this,e=this.mode;if(""!=e){if("4"==e){var a=[{ID:-21,isChecking:!1,payCode:"01",payName:"银联POS"},{ID:-23,isChecking:!1,payCode:"02",payName:"星驿付POS"}];return c.a.resolve(a)}return new c.a(function(a,i){t.payMode["mode_"+e]?a(t.payMode["mode_"+e]):nt(e).then(function(t){0==t.errcode&&t.data.length>0?(t.data.forEach(function(t){t.isChecking=!1}),a(t.data)):(console.log("_getMode",t),i())}).catch(function(t){console.log("_getMode",t),i()})})}}}},_t={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"paymodelist_wrap",attrs:{title:"支付代码选择",visible:t.show,width:"6"==t.mode?"420px":"320px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.show=e},close:t.closeDialog}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"paymodelist_table",attrs:{"element-loading-text":"正在加载.."}},[a("el-table",{attrs:{data:t.data,height:"370"},on:{"cell-click":t.cellClickHandle}},[a("el-table-column",{attrs:{prop:"payCode",label:"代码",width:"60"}}),t._v(" "),a("el-table-column",{attrs:{prop:"payName",label:"名称",width:"220"}}),t._v(" "),"6"==t.mode?a("el-table-column",{attrs:{label:"操作",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){a.stopPropagation(),t.handleCheck(e.row)}}},[t._v(t._s(e.row.isChecking?"检查中":"检 查"))])]}}])}):t._e()],1)],1)])},staticRenderFns:[]};var bt=a("VU/8")(yt,_t,!1,function(t){a("q3Bu")},null,null).exports,wt={props:{visiable:{type:Boolean,default:!1},billInfo:{type:Object,default:function(){return{id:"",code:""}}},shouldPay:{type:String,default:""}},watch:{visiable:function(t){this.show=t,t?(this.getPayList(),this._shouldPay()):(this.timeCount=0,this.orderSN="",this.loading=!1,this.isDone=!0,this.payCount="",clearInterval(this.orderCheckInterval))}},data:function(){return{show:!1,loading:!1,payType:"15",payCount:"",loadingText:"",data:[]}},created:function(){this.timeCount=0,this.orderSN="",this.orderCheckInterval=null,this.isDone=!0},methods:{closeDialog:function(){this.$emit("select","unionpaylist_dialog")},checkOrder:function(){var t=this;this.loadingText="订单号："+this.orderSN+" 支付中 "+this.timeCount+++"s",this.isDone&&(this.isDone=!1,rt({category:"payStatus",orderSN:this.orderSN}).then(function(e){if(0==e.errcode){var a=t.orderSN;if("1"!=e.data.status&&"3"!=e.data.status||(t.timeCount=0,t.orderSN="",clearInterval(t.orderCheckInterval),t.loading=!1),"1"==e.data.status){var i=Number(e.data.amount),s={no:"4",payid:-21,type:"银联POS",count:i};t.$emit("addPayItem",s),t.getPayList(),t.$nextTick(function(){t._showAlert("支付成功！订单号【"+a+"】金额：【"+i+"】元")})}"3"==e.data.status&&(console.error("支付失败",a),t._showAlert("支付失败，可使用检查功能进行检查。订单号【"+a+"】","error"),t.getPayList())}else console.error(e.errmsg),t._showMessage("支付检查失败！"+e.errmsg,"error",1e3);t.isDone=!0}).catch(function(e){console.error(e),t._showMessage("支付检查失败！！","error",1e3),t.isDone=!0}))},doUnionPay:function(){var t=this,e=this.payCount;""==e||isNaN(e)||Number(e)<=0?this._showMessage("金额输入不合法！","warning"):this.runPOSApi().then(function(e){t._showMessage("发起成功，请在设备上操作.."),t.orderSN=e,t.orderCheckInterval=setInterval(t.checkOrder.bind(t),2e3),t.payCount=""}).catch(function(e){t._showMessage(e,"error"),t.payCount=""})},getPayList:function(){var t=this;rt({category:"orderList",billID:this.billInfo.id,channel:this.payType}).then(function(e){if(t._showMessage("查询支付订单记录成功！"),0==e.errcode){var a=e.data.map(function(t){var e=0==t.status?"支付中":1==t.status?"支付成功":"支付失败";t.isRefund&&(e="撤消"+e);var a="12"==t.channel?"银行卡":"微支付";return j()(t,{statusText:e,type:a,isChecking:!1,isBacking:!1})});t.data=a}else console.log(e.errmsg),t.data=[]}).catch(function(t){})},handleCancel:function(t){var e=this;t.isBacking||(t.isBacking=!0,rt({category:"refund",ordersn:t.orderNo}).then(function(a){0==a.errcode?(e._showMessage(a.data),e.getPayList()):(t.isBacking=!1,e._showMessage("【"+t.orderNo+"】撤消操作失败！"+a.errmsg,"error"))}).catch(function(a){console.error(a),t.isBacking=!1,e._showMessage("【"+t.orderNo+"】撤消操作失败！！","error")}))},handleCheck:function(t){var e=this;t.isChecking||(t.isChecking=!0,rt({category:"payStatus",ordersn:t.orderNo}).then(function(a){0==a.errcode?(e._showMessage("【"+t.orderNo+"】检查成功！"),1==Number(a.data.status)&&e.$emit("addPayItem",{no:"4",payid:-21,type:"智能POS",count:Number(a.data.amount)}),e.getPayList()):(t.isChecking=!1,e._showMessage("【"+t.orderNo+"】检查失败！"+a.errmsg))}).catch(function(a){console.error(a),t.isChecking=!1,e._showMessage("【"+t.orderNo+"】检查失败！")}))},runPOSApi:function(){var t=this;return new c.a(function(e,a){t.loadingText="正在调用POS接口..",t.loading=!0,rt({category:"pay",billID:t.billInfo.id,payAmount:Number(t.payCount),channel:t.payType}).then(function(i){0==i.errcode?e(i.data.ordersn):(a(i.errmsg),t.$nextTick(function(){t.loading=!1}))}).catch(function(e){a(e),t.$nextTick(function(){t.loading=!1})})})},_showMessage:function(t,e,a){this.$message({type:e||"success",message:t,duration:a||2e3})},_showAlert:function(t,e){this.$confirm(t,"提示",{type:e||"success",showCancelButton:!1})},_shouldPay:function(){this.payCount=Number(this.shouldPay)>0?this.shouldPay:""}}},Ct={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"unionpay_wrap",attrs:{title:"银联POS支付",visible:t.show,width:"760px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.show=e},close:t.closeDialog}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"element-loading-text":t.loadingText}},[a("div",{staticClass:"unionpay_head floatfix"},[a("div",{staticClass:"unionpay_options"},[a("el-radio",{attrs:{label:"15"},model:{value:t.payType,callback:function(e){t.payType=e},expression:"payType"}},[t._v("微信/支付宝支付")]),t._v(" "),a("el-radio",{attrs:{label:"12"},model:{value:t.payType,callback:function(e){t.payType=e},expression:"payType"}},[t._v("银联支付")])],1),t._v(" "),a("div",{staticStyle:{float:"right","white-wrap":"nowrap"}},[a("el-input",{staticClass:"input_amount",attrs:{placeholder:"请输入金额.."},model:{value:t.payCount,callback:function(e){t.payCount=e},expression:"payCount"}}),t._v(" "),a("el-button",{staticClass:"btn_pay",attrs:{type:"success"},on:{click:function(e){e.stopPropagation(),t.doUnionPay(e)}}},[t._v("支 付")]),t._v(" "),a("el-button",{staticClass:"btn_pay",attrs:{type:"warning"},on:{click:function(e){e.stopPropagation(),t.getPayList(e)}}},[t._v("刷 新")])],1)]),t._v(" "),a("div",{staticClass:"unionpay_table"},[a("el-table",{attrs:{data:t.data,height:"320"}},[a("el-table-column",{attrs:{prop:"type",label:"类型",width:"100",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"orderNo",label:"订单编号",width:"200",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"amount",label:"金额",width:"120",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"statusText",label:"状态",width:"120",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"180",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isRefund||1!=e.row.status?t._e():a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(a){a.stopPropagation(),t.handleCancel(e.row)}}},[t._v(t._s(e.row.isBacking?"撤消中":"撤 消"))]),t._v(" "),e.row.isRefund||0!=e.row.status?t._e():a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){a.stopPropagation(),t.handleCheck(e.row)}}},[t._v(t._s(e.row.isChecking?"检查中":"检 查"))])]}}])})],1)],1)])])},staticRenderFns:[]};var kt=a("VU/8")(wt,Ct,!1,function(t){a("cf3/")},null,null).exports,xt={props:{billInfo:{type:Object,default:function(){return{id:0,code:""}}},shouldPay:{type:String,default:""}},created:function(){this.checkInterval=null},beforeDestroy:function(){clearInterval(this.checkInterval)},data:function(){return{show:!0,loading:!1,loadingText:"正在加载..",payType:"1",payAmount:"",isChecking:!1,timeCount:0}},mounted:function(){this._shouldPay()},methods:{doStarPay:function(){var t=this;Number(this.payAmount)<=0?this._showMessage("请输入支付金额！","warning"):(this.loading=!0,this._getTerminalNo().then(this._sendPayReq).then(function(e){t._showMessage("正在星驿付POS机上进行操作.."),t._checkStatus(e),t.checkInterval?clearInterval(t.checkInterval):t.checkInterval=setInterval(t._checkStatus.bind(t,e),1500)}).catch(function(e){t._showMessage(e,"error",3e3),t.$nextTick(function(){t.loading=!1})}))},numLimit:function(t){t.keyCode>=48&&t.keyCode<=57||46==t.keyCode||t.preventDefault()},_checkStatus:function(t){var e=this;this.loadingText="正在检查支付状态【"+this.timeCount+++"】s..",this.loading=!0,this.isChecking||(this.isChecking=!0,ct({category:"payStatus",recordId:t}).then(function(t){if(0==t.errcode){var a=t.data.ordStatus;if("0"!=a){clearInterval(e.checkInterval),e.$nextTick(function(){e.loading=!1}),e.timeCount=0;var i=Number(e.payAmount);if("2"==a)e._showAlert("支付失败！","error");else if("1"==a){var s={no:"4",payid:-23,type:"1"==e.payType?"星驿付-银行卡":"星驿付-微支付",count:i};e.$emit("addPayItem",s),e._showAlert("支付成功，支付金额【"+e.payAmount+"】元！"),e.closeDialog()}}}else console.error(t.errmsg),e._showMessage("检查失败！"+t.errmsg,"error");e.isChecking=!1}).catch(function(t){console.error(t),e._showMessage("检查失败！"+res.errmsg,"error"),e.isChecking=!1}))},_sendPayReq:function(t){var e=this;return new c.a(function(a,i){e.loadingText="正在发起支付请求..",ct({billID:e.billInfo.id,payAmount:Number(e.payAmount),payMode:e.payType,category:"pay",termialNo:t}).then(function(t){0==t.errcode?a(t.data.recordId):i("发起支付失败！"+t.errmsg)}).catch(function(t){i("发起支付失败！！")})})},_getTerminalNo:function(){var t=this;return new c.a(function(e,a){t.loadingText="正在获取终端号..",ct({category:"getTermialNo"}).then(function(t){0==t.errcode?t.data.length>0?e(t.data[0].termialNo):a("获取终端号为空！"):a("获取终端号失败！"+t.errmsg)}).catch(function(t){console.error(t),a("获取终端号失败！！")})})},_showMessage:function(t,e,a){this.$message({type:e||"success",message:t,duration:a||2e3})},_showAlert:function(t,e){this.$confirm(t,"提示",{type:e||"success",showCancelButton:!1})},_shouldPay:function(){this.payAmount=Number(this.shouldPay)>0?this.shouldPay:""},closeDialog:function(){this.$emit("select","starunionpay_dialog")}}},Dt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"starpay_wrap",attrs:{title:"星驿付POS支付",visible:t.show,width:"440px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.show=e},close:t.closeDialog}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"element-loading-text":t.loadingText}},[a("div",{staticClass:"starpay_options"},[a("span",[t._v("请选择支付方式：")]),t._v(" "),a("el-radio",{attrs:{label:"1"},model:{value:t.payType,callback:function(e){t.payType=e},expression:"payType"}},[t._v("银行卡")]),t._v(" "),a("el-radio",{attrs:{label:"2"},model:{value:t.payType,callback:function(e){t.payType=e},expression:"payType"}},[t._v("微支付")])],1),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.payAmount,expression:"payAmount"}],staticClass:"inputAmount",attrs:{type:"text",placeholder:"请输入支付金额.."},domProps:{value:t.payAmount},on:{keypress:[t.numLimit,function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.doStarPay(e)}],input:function(e){e.target.composing||(t.payAmount=e.target.value)}}}),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){e.stopPropagation(),t.doStarPay(e)}}},[t._v("确 定")])],1)])},staticRenderFns:[]};var Pt=a("VU/8")(xt,Dt,!1,function(t){a("OYaJ")},"data-v-778c5f2d",null).exports,It={props:{visiable:{type:Boolean,default:!1}},watch:{visiable:function(t){this.show=t,t&&this._getData()}},data:function(){return{loading:!0,show:!1,tableData:[]}},created:function(){this.flag=!1},methods:{cellClickHandle:function(t,e,a,i){this.flag=!0,this.$emit("select","hangUpList",t)},closeDialog:function(){this.flag?this.flag=!1:this.$emit("select","hangUpList"),this.tableData=[]},_getData:function(){var t=this;this.loading=!0,st().then(function(e){0==e.errcode?t.tableData=e.data:t.$confirm("查询挂单列表失败："+e.errmsg,"提示",{type:"error",showCancelButton:!1}),t.loading=!1}).catch(function(e){t.$confirm("查询挂单列表失败！！"+res.errmsg,"提示",{type:"error",showCancelButton:!1}),t.loading=!1})}}},Tt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"hangup_table",attrs:{title:"挂单列表",visible:t.show,width:"440px"},on:{"update:visible":function(e){t.show=e},close:t.closeDialog}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"hangup_wrapper",attrs:{"element-loading-text":"正在加载.."}},[a("el-table",{attrs:{data:t.tableData,height:"370"},on:{"cell-click":t.cellClickHandle}},[a("el-table-column",{attrs:{prop:"billCode",label:"单据号",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"billType",label:"单据别",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"billDate",label:"日期",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"creator",label:"制单人",width:"80"}})],1)],1)])},staticRenderFns:[]};var St=a("VU/8")(It,Tt,!1,function(t){a("tN9n")},null,null).exports,Nt={props:{visiable:{type:Boolean,default:!1},billInfo:{type:Object,default:function(){return{source:"pos",type:"local",billID:0}}}},computed:{visReceiver:function(){var t=this.billInfo,e=t.source;t.type;return"pos"==e},visLogistic:function(){var t=this.billInfo,e=t.source,a=t.type;return"pos"==e&&"local"==a||("dp"==e||"cop"==e)}},data:function(){return{show:!1,loading:!1,form:{cname:"",mobile:"",address:"",expressComName:"",expressNo:""}}},watch:{visiable:function(t){this.show=t,t&&console.log(this.billInfo)}},methods:{doSubmit:function(){var t=this;return Q()(Y.a.mark(function e(){var a;return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t._checkForm()){e.next=7;break}return t.loading=!0,e.next=4,t.sleep(500);case 4:a={ID:t.billInfo.billID,ReceiverAddress:t.form.address,OrderSource:t.billInfo.billID,ReceiverPhone:t.form.mobile,ReceiverName:t.form.cname,TrackingNumber:t.form.expressNo,LogisticsCompanyName:t.form.expressCom},t.cancelClick(),dt(a).then(function(e){0==e.errcode?(t._showMessage("保存配送信息成功！"),t.$emit("doNext")):t._showMessage("保存配送信息失败！"+e.errmsg,"error"),t.loading=!1}).catch(function(e){t._showMessage("保存配送信息失败！"+e,"error"),t.loading=!1});case 7:case"end":return e.stop()}},e,t)}))()},cancelClick:function(){this.$emit("select"),this.show=!1},closeDialog:function(){this.form={cname:"",mobile:"",address:"",expressCom:"",expressNo:""}},sleep:function(t){return new c.a(function(e){setTimeout(e,t)})},_checkForm:function(){var t=this.form,e=t.cname,a=t.mobile,i=t.address;return""!=e&&""!=a&&""!=i||(this._showMessage("请检查收货人信息！","error"),!1)},_showMessage:function(t,e){e=e||"success",this.$message({message:t,type:e})}}},$t={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"distribution_info",attrs:{title:"维护配送信息",visible:t.show,width:"440px","close-on-press-escape":!1,"close-on-click-modal":!1,"show-close":!1},on:{"update:visible":function(e){t.show=e},close:t.closeDialog}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"distribution_wrapper",attrs:{"element-loading-text":"正在保存.."}},[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px",size:"small","label-position":"top"}},[t.visReceiver?a("el-form-item",{staticClass:"sub_form_item",attrs:{"label-width":"0px",required:""}},[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"收件人",prop:"cname"}},[a("el-input",{attrs:{placeholder:"姓名"},model:{value:t.form.cname,callback:function(e){t.$set(t.form,"cname",e)},expression:"form.cname"}})],1)],1),t._v(" "),a("el-col",{staticClass:"line",attrs:{span:1}},[t._v(" ")]),t._v(" "),a("el-col",{attrs:{span:13}},[a("el-form-item",{attrs:{label:"联系电话",prop:"mobile"}},[a("el-input",{attrs:{placeholder:"电话"},model:{value:t.form.mobile,callback:function(e){t.$set(t.form,"mobile",t._n(e))},expression:"form.mobile"}})],1)],1)],1):t._e(),t._v(" "),t.visReceiver?a("el-form-item",{attrs:{label:"收货地址",required:""}},[a("el-input",{attrs:{placeholder:"请输入具体收货地址"},model:{value:t.form.address,callback:function(e){t.$set(t.form,"address",e)},expression:"form.address"}})],1):t._e(),t._v(" "),t.visLogistic?a("el-form-item",[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"快递公司",prop:"expressCom"}},[a("el-input",{attrs:{placeholder:"请输入快递公司名称.."},model:{value:t.form.expressComName,callback:function(e){t.$set(t.form,"expressComName",e)},expression:"form.expressComName"}})],1)],1),t._v(" "),a("el-col",{staticClass:"line",attrs:{span:1}},[t._v(" ")]),t._v(" "),a("el-col",{attrs:{span:13}},[a("el-form-item",{attrs:{label:"快递单号",prop:"expressNo"}},[a("el-input",{attrs:{placeholder:"请输入正确的快递单号.."},model:{value:t.form.expressNo,callback:function(e){t.$set(t.form,"expressNo",e)},expression:"form.expressNo"}})],1)],1)],1):t._e(),t._v(" "),a("el-form-item",{staticClass:"btn_form"},[a("el-button",{attrs:{type:"primary"},on:{click:t.doSubmit}},[t._v("立即保存")]),t._v(" "),a("el-button",{on:{click:t.cancelClick}},[t._v("取消")])],1)],1)],1)])},staticRenderFns:[]};var At=a("VU/8")(Nt,$t,!1,function(t){a("bkFu")},null,null).exports,Mt={name:"vipcard",props:{data:{type:Object,default:function(){return{}}},canPay:{type:Boolean,default:!1}},watch:{data:function(t){"{}"==G()(t)?(this.$refs.inp_pexchange.value="",this.exchangeVal=""):this.userinfo.VipFlag&&t.vipFlag&&this.userinfo.VipFlag!=t.vipFlag&&this.$confirm("该VIP不是本店的共享VIP，将无法进行积分兑换与积分消费！","温馨提示",{confirmButtonText:"确定",showCancelButton:!1,type:"warning"})}},data:function(){return{exchangeVal:"--",isRefreshing:!1}},computed:o()({},Object(p.b)(["userinfo"]),{showPointExchangeInput:function(){var t=this.data.jf,e=this.data.vipFlag==this.userinfo.VipFlag,a=this.userinfo.Point_IsBuy;return!!(""!=t&&Number(t)>0&&e&&a)}}),methods:{pointRefresh:function(){var t=this;if(this.data.kh&&""!=this.data.kh){this.isRefreshing||(this.isRefreshing=!0,(e=this.data.kh.toString(),K(X,{action:"GetVipPoints",vipcardno:e})).then(function(e){t.isRefreshing=!1,0==e.errcode?(t._showMessage("查询VIP："+t.data.kh+" 积分成功！"),t.$emit("updatePoints",e.data)):t._showMessage(e.errmsg,"error")}).catch(function(e){t._showMessage(e,"error"),t.isRefreshing=!1}));var e}},numLimit:function(t){t.keyCode>=48&&t.keyCode<=57||t.preventDefault()},inputCodeEnter:function(t){t.target.blur()},inputCode:function(t){var e=t.target.getAttribute("class"),a=t.target.value;this.$emit("blurEvent",a,e)},doExchange:function(){var t=this,e=Number(this.exchangeVal),a=Number(this.$refs.inp_pexchange.value);this.showPointExchangeInput?a%this.userinfo.Point_BuyRatio==0&&e>0&&a<=Number(this.data.jf)?this.$confirm("确认使用积分抵扣"+e+"元现金??","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$emit("addPayItem",{no:"7",payid:-25,type:"积分抵扣",count:e,points:a}),t.$refs.inp_pexchange.value=""}):this.$message({type:"error",message:"对不起，输入的兑换积分数有误，抵扣的金额必须是整数！"}):this.$message({type:"error",message:"对不起，您目前还不允许使用积分兑换功能！"})},pointExchange:function(t){var e=t.keyCode;if(e>=48&&e<=57||e>=96&&e<=105||8==t.keyCode){var a=t.target.value;if(""!=a){if(a<=this.data.jf){var i=this.userinfo.Point_BuyRatio;this.exchangeVal=parseInt(a/i)}}else this.exchangeVal="--"}else t.preventDefault()},_showMessage:function(t,e,a){this.$message({type:e||"success",message:t,duration:a||2e3})}}},Bt={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"vipcard"},[i("img",{staticStyle:{width:"150px",height:"14.28px"},attrs:{src:a("H3Hj")}}),t._v(" "),i("img",{staticClass:"shadow",attrs:{src:a("+FSC")}}),t._v(" "),i("p",{staticClass:"vip_class"},[t._v("微信会员")]),t._v(" "),i("div",{staticClass:"form_item"},[i("label",[t._v("卡号(电话)")]),t._v(" "),i("input",{staticClass:"kh",attrs:{type:"text"},domProps:{value:t.data.kh},on:{change:t.inputCode,keypress:[function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.inputCodeEnter(e)},t.numLimit]}})]),t._v(" "),i("div",{staticClass:"form_item"},[i("label",[t._v("会员姓名")]),t._v(" "),i("input",{staticClass:"name",attrs:{type:"text"},domProps:{value:t.data.xm},on:{change:t.inputCode,keypress:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.inputCodeEnter(e)}}})]),t._v(" "),i("div",{staticClass:"form_item"},[i("label",[t._v("可用积分")]),t._v(" "),i("input",{staticStyle:{width:"44%"},attrs:{type:"text",disabled:""},domProps:{value:t.data.jf}}),t._v(" "),i("el-button",{staticClass:"btn_prefresh",attrs:{disabled:!t.data.kh||""==t.data.kh,size:"mini",plain:""},on:{click:t.pointRefresh}},[t._v(t._s(t.isRefreshing?"刷新中":"刷 新"))])],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.showPointExchangeInput,expression:"showPointExchangeInput"}],staticClass:"form_item points"},[i("label",[t._v("积分抵扣")]),t._v(" "),i("input",{ref:"inp_pexchange",staticStyle:{width:"44%"},attrs:{type:"text",placeholder:""},on:{keyup:t.pointExchange,keypress:t.numLimit}}),t._v(" "),i("el-button",{attrs:{size:"mini",disabled:!t.canPay},on:{click:t.doExchange}},[t._v("兑 换")]),t._v(" "),i("p",{staticClass:"ptip"},[t._v("提示：积分抵扣 "+t._s(t.exchangeVal)+" 元（"+t._s(t.userinfo.Point_BuyRatio)+"积分=1元）")])],1),t._v(" "),t.data.isInner?i("div",{staticClass:"form_item"},[i("p",{staticClass:"innerTips"},[i("strong",[t._v("内部VIP：")]),t._v(t._s(t.data.innerRemark)+"，剩余额度：\n      "),i("strong",[t._v(t._s(t.data.innerAmount))]),t._v(" 元")])]):t._e()])},staticRenderFns:[]};var Rt=a("VU/8")(Mt,Bt,!1,function(t){a("Apxf")},"data-v-535b1712",null).exports,Et={props:{canPay:{type:Boolean,default:!1},billInfo:{type:Object,default:function(){return{id:"",code:""}}},payCounts:{type:String,default:""}},name:"paytypes",data:function(){return{showTypes:!1,payno:"",payid:"",payname:"",payTypes:[{no:1,icon:"icon-xianjin",color:"#ff7864",name:"现 金"},{no:2,icon:"icon-yinhangqia",color:"#f0b952",name:"银行卡"},{no:3,icon:"icon-diyongquan101",color:"#f5b287",name:"抵用券"},{no:4,icon:"icon-shouyintai",color:"#53b8b4",name:"智能POS"},{no:5,icon:"icon-weibiaoti-",color:"#1197e0",name:"银联预付"},{no:6,icon:"icon-zhifubaoweixin",color:"#40b034",name:"微支付"}],loading:!1,sumCounts:""}},computed:{autoFill:function(){return Number(this.payCounts)>0?this.payCounts:""}},watch:{payno:function(t,e){if(console.log("watch payno",t,e),""==t)return this.payid="",this.payname="",void(this.sumCounts="");0==this.payTypes.filter(function(e){return e.no==t}).length?(this.payno="",this.payname="",this.sumCounts="",this.$confirm("对不起，输入的付款方式编号有误！","提示",{type:"warning",showCancelButton:!1})):this._handlePayMode()}},created:function(){this.payMode={}},mounted:function(){l.$on("selectPayMode",this._selectPayMode),l.$on("hidePayTypes",this._hidePayTypes),console.log("payCounts:",this.autoFill)},beforeDestroy:function(){l.$off("selectPayMode",this._selectPayMode),l.$off("hidePayTypes",this._hidePayTypes)},methods:{doFocus:function(){this.canPay&&this.$refs.typeInput.focus()},_selectPayMode:function(t){console.log("selectPayMode",t),this.payid=t.ID,this.payname=t.payName,this.sumCounts=this.autoFill,this.$refs.inputPay&&this.$refs.inputPay.focus()},start:function(){var t=this;this.$refs.typeInput.focus(),this.showTypes||(this.showTypes=!0,setTimeout(function(){t.showTypes=!1},1500))},addPayItem:function(t){var e=t.target.value;""==this.payno||Number(e)<=0||(-19!=this.payid&&-20!=this.payid&&-24!=this.payid?(this.$emit("addPayItem",{no:this.payno,payid:this.payid,type:this.payname,count:Number(e)}),this.payno="",this.payid="",this.payname="",t.target.value="",t.target.blur()):this.$prompt("支付金额："+Number(e)+"元",this.payname+"支付",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,closeOnPressEscape:!1,showClose:!1,center:!0,inputValidator:function(t){return!isNaN(t)||"请输入数字！"},beforeClose:this._dialogBeforeClose}))},_dialogBeforeClose:function(t,e,a){if("confirm"==t){var i=e.inputValue;if(i&&""!=i){this._showMask($(e.$el));var s=Number(this.$refs.inputPay.value);this.doMicroPay(s,i,a)}else this.$message({type:"error",message:"请输入或扫描顾客屏幕上的付款码！"})}else a()},doMicroPay:function(t,e,a){var i=this;lt({billID:this.billInfo.id,payAmount:t,payID:this.payid,category:"pay",authCode:e}).then(function(e){0==e.errcode?(i.$message({type:"success",message:"支付成功！"+e.errmsg,duration:1500}),i.$emit("addPayItem",{no:i.payno,payid:i.payid,type:i.payname,count:t}),i.payno="",i.payid="",i.payname="",i.sumCounts="",a()):i.$message({type:"error",message:"支付失败！"+e.errmsg,duration:4e3}),i.loading=!1}).catch(function(t){console.log(t),i.$message({type:"error",message:"支付失败！！",duration:4e3}),i.loading=!1})},numLimit:function(t){t.keyCode>=48&&t.keyCode<=57||46==t.keyCode||t.preventDefault()},showTypeFn:function(){this.showTypes=!this.showTypes},itemClick:function(t){var e=this;this.canPay?(this.payno="",this.$nextTick(function(){e.payno=e.payTypes[t].no})):this.$message({type:"warning",message:"请先结算后，再录入支付方式！"})},reset:function(){this.payno=""},_hidePayTypes:function(t){this.showTypes=t},cashMode:function(){var t=this;this._getMode(this.payno).then(function(e){t.payid=e[0].ID,t.payname=e[0].payName,t.sumCounts=t.autoFill,t.$refs.inputPay.focus()}).catch(function(e){console.error(e),t.payno="",t.$confirm("查询付款种类失败，请重试！","提示",{type:"error",showCancelButton:!1})})},unionPrevPay:function(){var t=this;this._getMode(this.payno).then(function(e){t.payid=e[0].ID,t.payname=e[0].payName,t.sumCounts=t.autoFill,t.$refs.inputPay.focus()}).catch(function(e){console.error(e),t.payno="",t.$confirm("查询付款种类失败，请重试！","提示",{type:"error",showCancelButton:!1})})},_showMask:function(t){var e=t.find(".el-message-box"),a=$(".paying_mask");a.css("width",e.width()+"px"),a.css("height",e.height()+30+"px"),a.css("top",e.position().top+"px"),a.css("left",e.position().left+"px"),a.css("zIndex",Number(t.css("zIndex"))+1),this.loading=!0},_handlePayMode:function(){switch(this.payno.toString()){case"1":this.cashMode();break;case"2":this.$emit("openMenuList","2");break;case"6":this.$emit("openMenuList","6");break;case"3":this.$emit("openMenuList","3");break;case"4":this.$emit("openMenuList","4");break;case"5":this.unionPrevPay()}},_getMode:function(t){var e=this;return new c.a(function(a,i){e.payMode["mode_"+t]?a(e.payMode["mode_"+t]):nt(t).then(function(s){0==s.errcode&&s.data.length>0?(e.payMode["mode_"+t]=s.data,a(s.data)):(console.log("_getMode",s),i())}).catch(function(t){console.log("_getMode",t),i()})})}}},Lt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"paywrap floatfix"},[a("transition",{attrs:{name:"slide"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.showTypes,expression:"showTypes"}],staticClass:"paytypes floatfix"},t._l(t.payTypes,function(e,i){return a("div",{key:i,staticClass:"payitem",on:{click:function(e){t.itemClick(i)}}},[a("p",{staticClass:"payno"},[t._v(t._s(e.no))]),t._v(" "),a("p",{staticClass:"angle"}),t._v(" "),a("i",{staticClass:"iconfont",class:e.icon,style:{color:e.color}}),t._v(" "),a("p",{staticClass:"payname"},[t._v(t._s(e.name))])])}))]),t._v(" "),a("div",{staticClass:"payform floatfix"},[a("div",{staticClass:"form_item",staticStyle:{float:"left",width:"48%"}},[a("p",{staticClass:"label"},[t._v("付款种类\n        "),a("span",{staticStyle:{color:"#666","font-size":"12px",cursor:"pointer"},on:{click:function(e){e.stopPropagation(),t.showTypeFn(e)}}},[t._v(t._s(t.showTypes?"（隐藏）":"（查看）"))])]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.payno,expression:"payno"}],ref:"typeInput",staticStyle:{"text-align":"center"},attrs:{disabled:!t.canPay,type:"text"},domProps:{value:t.payno},on:{keypress:t.numLimit,input:function(e){e.target.composing||(t.payno=e.target.value)}}})]),t._v(" "),a("div",{staticClass:"form_item",staticStyle:{float:"left",width:"48%","margin-left":"4%"}},[a("p",{staticClass:"label"},[t._v("付款方式")]),t._v(" "),a("div",{staticClass:"value",staticStyle:{"text-align":"center"}},[t._v(t._s(t.payname))])]),t._v(" "),a("div",{staticClass:"form_item",staticStyle:{clear:"both","padding-top":"10px"}},[a("p",{staticClass:"label"},[t._v("付款金额")]),t._v(" "),a("input",{ref:"inputPay",staticStyle:{"text-align":"right"},attrs:{type:"text"},domProps:{value:t.sumCounts},on:{keypress:[t.numLimit,function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.addPayItem(e)}]}})])]),t._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"},{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"paying_mask",attrs:{"element-loading-text":"正在支付中.."}})],1)},staticRenderFns:[]};var Ot=a("VU/8")(Et,Lt,!1,function(t){a("rPKt")},"data-v-f069452a",null).exports,jt={name:"paytable",props:{data:{type:Array,default:function(){return[]}}},methods:{cellClick:function(t,e,a,i){this.$emit("cell-click",t,e,a,i)}}},zt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"paydetail"},[e("el-table",{staticClass:"pay_table",staticStyle:{width:"100%"},attrs:{data:this.data},on:{"cell-click":this.cellClick}},[e("el-table-column",{attrs:{prop:"order",label:"序号",width:"60","class-name":"order"}}),this._v(" "),e("el-table-column",{attrs:{prop:"type",label:"付款方式",width:"120"}}),this._v(" "),e("el-table-column",{attrs:{prop:"count",label:"付款金额"}})],1)],1)},staticRenderFns:[]};var Ft=a("VU/8")(jt,zt,!1,function(t){a("/L53")},null,null).exports,Ut={name:"paystatic",props:{payData:{type:Array,default:function(){return[]}},saleData:{type:Array,default:function(){return[]}}},computed:{shouldGetTotal:function(){var t=0;return this.saleData.forEach(function(e){t+=e.je}),t.toFixed(2)},netGetTotal:function(){var t=0;return this.payData.forEach(function(e){t+=Number(e.count)}),t.toFixed(2)},retTotal:function(){var t=(this.netGetTotal-this.shouldGetTotal).toFixed(2);return t>=0?l.$emit("hidePayTypes",!1):l.$emit("hidePayTypes",!0),t}},methods:{getStatic:function(){return{shouldGetTotal:this.shouldGetTotal,netGetTotal:this.netGetTotal,retTotal:this.retTotal}}}},Vt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"paystatic"},[e("div",{staticClass:"static_item"},[e("label",[this._v("应 收：")]),this._v(" "),e("span",{staticClass:"value"},[this._v(this._s(this.shouldGetTotal))])]),this._v(" "),e("div",{staticClass:"static_item"},[e("label",[this._v("实 收：")]),this._v(" "),e("span",{staticClass:"value"},[this._v(this._s(this.netGetTotal))])]),this._v(" "),e("div",{staticClass:"static_item"},[e("label",[this._v("找 赎：")]),this._v(" "),e("span",{staticClass:"value"},[this._v(this._s(this.retTotal))])])])},staticRenderFns:[]};var Gt=a("VU/8")(Ut,Vt,!1,function(t){a("dtRy")},"data-v-4a2ba191",null).exports,Ht={props:{show:{type:Boolean,default:!1}},data:function(){return{loading:!1,listData:[]}},watch:{show:function(t){t?this._getData():(this.listData=[],this.loading=!1)}},create:function(){this.ajaxTimeStamp=0},methods:{closePanel:function(){this.listData=[],this.$emit("close")},showBillDetail:function(t){this.$emit("showBillDetail",t.id),this.closePanel()},_getData:function(){var t=this;this.loading=!0;var e=Number(new Date);this.ajaxTimeStamp=e,st().then(function(a){if(t.ajaxTimeStamp!=e||!t.show)return console.warn("【getOrderList】上一次请求结果已失效！"),void t.$nextTick(function(){t.loading=!1});0==a.errcode?t.listData=a.data:t.$confirm("查询挂单列表失败："+a.errmsg,"提示",{type:"error",showCancelButton:!1}),t.$nextTick(function(){t.loading=!1})}).catch(function(e){t.$confirm("查询挂单列表失败！！"+e,"提示",{type:"error",showCancelButton:!1}),t.$nextTick(function(){t.loading=!1})})}}},Yt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"right_panel bills",class:{open:t.show},attrs:{"element-loading-text":"正在加载.."}},[a("i",{staticClass:"btn_close iconfont icon-xiangxiajiantou",on:{click:t.closePanel}}),t._v(" "),a("div",{staticClass:"bill_list"},[t._l(t.listData,function(e,i){return a("div",{key:i,staticClass:"bill_item holding"},[a("p",{staticClass:"status floatfix"},[a("span",[t._v("挂单中")]),t._v(" "),a("el-button",{attrs:{icon:"el-icon-search"},on:{click:function(a){t.showBillDetail(e)}}},[t._v("查看")])],1),t._v(" "),a("div",{staticClass:"info_wrap"},[a("div",{staticClass:"info_item floatfix"},[a("label",[t._v("单据号：")]),t._v(" "),a("div",{staticClass:"value"},[t._v(t._s(e.billCode))])]),t._v(" "),a("div",{staticClass:"info_item floatfix"},[a("label",[t._v("单据别：")]),t._v(" "),a("div",{staticClass:"value"},[t._v(t._s(e.billType))])]),t._v(" "),a("div",{staticClass:"info_item floatfix"},[a("label",[t._v("日期：")]),t._v(" "),a("div",{staticClass:"value"},[t._v(t._s(e.billDate))])]),t._v(" "),a("div",{staticClass:"info_item floatfix"},[a("label",[t._v("制单人：")]),t._v(" "),a("div",{staticClass:"value"},[t._v(t._s(e.creator))])])]),t._v(" "),a("div",{staticClass:"static"},[a("span",{staticClass:"num"},[t._v("数量："+t._s(e.qty))]),t._v(" "),a("span",{staticClass:"money"},[t._v("金额：￥"+t._s(e.amount))])])])}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.listData.length>0,expression:"!listData.length>0"}],staticClass:"no-result"},[t._v("对不起，暂时无相关单据..")])],2)])},staticRenderFns:[]};var Zt=a("VU/8")(Ht,Yt,!1,function(t){a("BdYy")},"data-v-38f92c17",null).exports,Qt={props:{show:{type:Boolean,default:!1}},methods:{closePanel:function(){this.$emit("close")}}},Wt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"right_panel message",class:{open:this.show}},[e("i",{staticClass:"btn_close iconfont icon-xiangxiajiantou",on:{click:this.closePanel}}),this._v(" "),this._m(0)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"message_wrapper"},[e("div",{staticClass:"no-result"},[this._v("对不起，暂无消息..")])])}]};var qt=a("VU/8")(Qt,Wt,!1,function(t){a("Q3rI")},"data-v-0f423b7d",null).exports,Jt={props:{show:{type:Boolean,default:!1}},data:function(){return{loading:!1,gradient:null,goalAmount:"--",todayAmount:"--",yesterDayAmount:"--"}},watch:{show:function(t){t?this._getData():this.loading=!1}},methods:{closePanel:function(){this.$emit("close")},_drawChart:function(t,e){var a=document.getElementById("lineChart");this.gradient=a.getContext("2d").createLinearGradient(0,0,0,450),this.gradient.addColorStop(0,"rgba(255, 0,0, 0.5)"),this.gradient.addColorStop(.5,"rgba(255, 0, 0, 0.25)"),this.gradient.addColorStop(1,"rgba(255, 0, 0, 0)"),this.myChart&&this.myChart.destroy(),this.myChart=new Chart(a,{type:"line",data:{labels:t,datasets:[{label:"交易额",backgroundColor:this.gradient,data:e}]},options:{spanGaps:!0,scaleOverride:!0,scaleStartValue:1e3}})},_getData:function(){var t=this;this.loading=!0,function(){var t={action:"GetSales",storeid:F.state.user.StoreID,timestamp:(new Date).getTime()};return K(X,t)}().then(function(e){if(0==e.errcode){if(t.goalAmount=h.formatMoney(e.data.goalAmount,0,".",","),t.todayAmount=h.formatMoney(e.data.todayAmount,0,".",","),t.yesterDayAmount=h.formatMoney(e.data.yesterDayAmount,0,".",","),e.data.latelyDetail&&e.data.latelyDetail.length>0){var a=[],i=[];e.data.latelyDetail.forEach(function(t){a.push(t.rq),i.push(t.je)}),a.reverse(),i.reverse(),t._drawChart(a,i)}}else t.$message({message:"统计近期销售额失败:"+e.errmsg,type:"error"}),t._reset();t.loading=!1}).catch(function(e){console.log(e),t.$message({message:"统计近期销售额失败!!"+e,type:"error"}),t.loading=!1,t._reset()})},_reset:function(){this.todayAmount="--",this.yesterDayAmount="--",this.goalAmount="--",this.myChart&&this.myChart.destroy()}}},Xt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:this.loading,expression:"loading"}],staticClass:"right_panel achieve",class:{open:this.show},attrs:{"element-loading-text":"正在加载.."}},[e("i",{staticClass:"btn_close iconfont icon-xiangxiajiantou",on:{click:this.closePanel}}),this._v(" "),e("div",{staticClass:"achieve_wrapper"},[e("div",{staticClass:"statics floatfix"},[e("div",{staticClass:"static_item",staticStyle:{"background-color":"#70d18a"}},[e("i",{staticClass:"iconfont icon-shouyintai"}),this._v(" "),e("div",[e("p",{staticClass:"value"},[this._v(this._s(this.yesterDayAmount))]),this._v(" "),e("p",{staticClass:"label"},[this._v("昨日业绩(元)")])])]),this._v(" "),e("div",{staticClass:"static_item floatfix"},[e("i",{staticClass:"iconfont icon-yeji",staticStyle:{"font-size":"38px"}}),this._v(" "),e("div",[e("p",{staticClass:"value"},[this._v(this._s(this.todayAmount))]),this._v(" "),e("p",{staticClass:"label"},[this._v("今日业绩(元)")])])]),this._v(" "),e("div",{staticClass:"static_item",staticStyle:{"background-color":"#5c98de"}},[e("i",{staticClass:"iconfont icon-yeji-"}),this._v(" "),e("div",[e("p",{staticClass:"value"},[this._v(this._s(0==this.goalAmount?"--":this.goalAmount))]),this._v(" "),e("p",{staticClass:"label"},[this._v("目标业绩(元)")])])])]),this._v(" "),this._m(0)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"chart_wrap"},[e("p",{staticClass:"title"},[this._v("近7日交易走势图")]),this._v(" "),e("div",{staticClass:"chart"},[e("canvas",{attrs:{id:"lineChart",width:"440",height:"260"}})])])}]};var Kt=a("VU/8")(Jt,Xt,!1,function(t){a("vZwz")},"data-v-36ece7f4",null).exports,te={props:{show:{type:Boolean,default:!0}},data:function(){return{loading:!1,loadingText:"正在处理..",feedbackContent:"",data:[{order:1,fileName:"XXXXX.jpg",action:"删除"},{order:2,fileName:"XXXXX.jpg",action:"删除"}]}},methods:{selectImage:function(){this.$refs.imgFileInput.click()},uploadImgFile:function(){this.loading=!0;var t=this;$(".uploadForm").ajaxSubmit({url:"User_data_edit",type:"post",dataType:"json",success:function(t){console.log("uploadImgFile",t)},error:function(e){setTimeout(function(){t.loading=!1},2e3)}})},closePanel:function(){console.log("closePanel"),this.$emit("close")},cellClick:function(){},submitForm:function(){console.log(this.feedbackContent),this.$message({message:"正在拼命开发中..",type:"info"})}}},ee={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"right_panel feedback",class:{open:t.show},attrs:{"element-loading-text":t.loadingText}},[a("i",{staticClass:"btn_close iconfont icon-xiangxiajiantou",on:{click:t.closePanel}}),t._v(" "),a("div",{staticClass:"feedback_wrapper"},[a("p",{staticClass:"title"},[t._v("问题和意见")]),t._v(" "),a("el-input",{attrs:{resize:"none",type:"textarea",rows:6,placeholder:"请输入10个字以上的问题描述以便我们提供更好的帮助"},model:{value:t.feedbackContent,callback:function(e){t.feedbackContent=e},expression:"feedbackContent"}}),t._v(" "),a("p",{staticClass:"title floatfix",staticStyle:{"margin-top":"20px"}},[a("span",[t._v("图片（选填、提供问题截图）")]),t._v(" "),a("el-button",{staticClass:"btn_select",attrs:{icon:"el-icon-upload",size:"mini",type:"warning",plain:""},on:{click:t.selectImage}},[t._v("选择文件")])],1),t._v(" "),a("div",{staticClass:"upload_wraper floatfix"},[a("form",{staticClass:"uploadForm",attrs:{enctype:"multipart/form-data"}},[a("input",{ref:"imgFileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:t.uploadImgFile}})]),t._v(" "),a("el-table",{staticClass:"upload_table",staticStyle:{width:"100%"},attrs:{data:t.data,stripe:""},on:{"cell-click":t.cellClick}},[a("el-table-column",{attrs:{prop:"order",label:"序号",width:"60","class-name":"order"}}),t._v(" "),a("el-table-column",{attrs:{prop:"fileName",label:"文件名",width:"240"}}),t._v(" "),a("el-table-column",{attrs:{prop:"action",label:"删除"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"danger"}},[t._v("删除")])]}}])})],1)],1),t._v(" "),a("el-button",{staticClass:"btn_save",attrs:{type:"primary"},on:{click:t.submitForm}},[t._v("提 交")])],1)])},staticRenderFns:[]};var ae=a("VU/8")(te,ee,!1,function(t){a("pkXS")},null,null).exports,ie={props:{source:{type:String,default:"cop"},filter:{type:String,default:"1"},type:{type:String,default:"cloud"},data:{type:Object,default:function(){return{amount:"--",billCode:"--",billDate:"--",creator:"--",id:0,isCloudOrder:1,localSendMethod:1,qty:"--",status:-1}}}},data:function(){return{showDetail:!1,tableData:[],contentHeight:"0px",loading:!1,distriData:{}}},computed:{status:function(){return"2"==this.filter?3!=this.data.status:"1"==this.filter?1!=this.data.status:void 0},statusText:function(){if("cloud"==this.type)return this.status?"已接单":"未接单"},clsDetailBtn:function(){if("cloud"==this.type){if("1"==this.filter)return"full";if("2"==this.filter&&3!=this.data.status)return 2==this.data.status?"full":"half"}return"local"==this.type?"half":""},showAcceptBtn:function(){return"cloud"==this.type&&"2"==this.filter&&3==this.data.status},showDistriBtn:function(){return"cloud"==this.type&&"2"==this.filter&&1==this.data.status||"local"==this.type}},methods:{doAccept:function(){var t=this;this.loading=!0,function(t){var e={action:"UpdOrderShop",CustomID:F.state.user.OrgID,StoreID:F.state.user.StoreID,ID:t};return K(X,e)}(this.data.id).then(function(e){0==e.errcode?(h.showMessage.call(t,"接单成功！"),t.$emit("refresh")):h.showMessage.call(t,"接单失败！原因："+e.errmsg),t.loading=!1}).catch(function(e){t.loading=!1,h.showMessage.call(t,"接单失败！原因："+e)})},openDistribution:function(){h.showMessage.call(this,"正在拼命开发中..","info"),l.$emit("openDialog","distribution_dialog",{source:this.source,type:this.type,billID:this.data.id})},getDetail:function(){var t=this;if(this.showDetail)return this.tableData=[],void(this.showDetail=!this.showDetail);(e=this.data.id,K(X,{action:"GetOrderLogis",billID:e})).then(function(e){0==e.errcode?(""!=e.data.Logis&&(t.distriData={cname:e.data.Logis.receiverName,mobile:e.data.Logis.receiverPhone,address:e.data.Logis.receiverAddress,expressCom:e.data.Logis.logisticsCompanyName,expressNo:e.data.Logis.trackingNumber}),t.tableData=e.data.detail):h.showMessage.call(t,"查询配送单详情失败！原因："+e.errmsg,"error")}).catch(function(e){h.showMessage.call(t,"查询配送单详情失败！原因："+e,"error")});var e;this.showDetail=!this.showDetail}}},se={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:this.loading,expression:"loading"}],staticClass:"order-item order-item-container",attrs:{"element-loading-text":"正在处理.."}},[e("div",{staticClass:"order-status"},["cop"==this.source?e("div",{staticClass:"left",class:this.status?"s0":"s1"},[e("i",{staticClass:"iconfont icon-success"}),this._v(" "),e("span",[this._v(this._s(this.statusText))])]):this._e(),this._v(" "),"dp"==this.source?e("div",{staticClass:"left",class:"cloud"==this.type?"s1":"s0"},[e("i",{staticClass:"iconfont icon-suggest",staticStyle:{"font-weight":"bold"}}),this._v(" "),e("span",[this._v(this._s("local"==this.type?"本店配送单":"云仓单"))])]):this._e(),this._v(" "),e("div",{staticClass:"right floatfix"},[e("span",[this._v(this._s(this.data.billDate))]),this._v(" "),this._e()])]),this._v(" "),e("div",{staticClass:"order-info floatfix"},[e("div",{staticClass:"info-item"},[e("p",[this._v(this._s(this.data.billCode))]),this._v(" "),e("p",[this._v("单据号")])]),this._v(" "),e("div",{staticClass:"info-item"},[e("p",[this._v(this._s(this.data.qty))]),this._v(" "),e("p",[this._v("数量")])]),this._v(" "),e("div",{staticClass:"info-item"},[e("p",[this._v("¥"+this._s(this.data.amount))]),this._v(" "),e("p",[this._v("金额")])]),this._v(" "),e("div",{staticClass:"info-item"},[e("p",{staticStyle:{"font-size":"15px"}},[this._v(this._s(this.data.creator))]),this._v(" "),e("p",[this._v("制单人")])])]),this._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:this.showDetail,expression:"showDetail"}],ref:"orderDetail",staticClass:"order-detail"},[this._m(0),this._v(" "),e("el-table",{ref:"orderTable",staticStyle:{width:"100%"},attrs:{data:this.tableData,stripe:"",border:"","max-height":"240"}},[e("el-table-column",{attrs:{prop:"goodsCode",label:"货号",width:"100"}}),this._v(" "),e("el-table-column",{attrs:{prop:"goodsName",label:"名称",width:"100"}}),this._v(" "),e("el-table-column",{attrs:{prop:"sizeName",label:"尺码",width:"60"}}),this._v(" "),e("el-table-column",{attrs:{prop:"salePrice",label:"零售价",width:"80"}}),this._v(" "),e("el-table-column",{attrs:{prop:"discounts",label:"折扣",width:"60"}}),this._v(" "),e("el-table-column",{attrs:{prop:"goodsRealPrice",label:"实售价",width:"80"}}),this._v(" "),e("el-table-column",{attrs:{prop:"qty",label:"数量",width:"80"}}),this._v(" "),e("el-table-column",{attrs:{prop:"goodsAmount",label:"金额",width:"100"}})],1),this._v(" "),this._m(1),this._v(" "),e("div",{staticClass:"logistics_detail"},[e("el-row",[e("el-col",{staticClass:"label",attrs:{span:5}},[this._v(" 收件人： ")]),this._v(" "),e("el-col",{attrs:{span:7}},[this._v(" "+this._s(this.distriData.cname)+" ")]),this._v(" "),e("el-col",{staticClass:"label",attrs:{span:5}},[this._v(" 联系电话： ")]),this._v(" "),e("el-col",{attrs:{span:7}},[this._v(" "+this._s(this.distriData.mobile)+" ")])],1),this._v(" "),e("el-row",[e("el-col",{staticClass:"label",attrs:{span:5}},[this._v(" 物流公司： ")]),this._v(" "),e("el-col",{attrs:{span:7}},[this._v(" "+this._s(this.distriData.expressCom)+" ")]),this._v(" "),e("el-col",{staticClass:"label",attrs:{span:5}},[this._v(" 物流单号： ")]),this._v(" "),e("el-col",{attrs:{span:7}},[this._v(" "+this._s(this.distriData.expressNo)+" ")])],1),this._v(" "),e("el-row",[e("el-col",{staticClass:"label",attrs:{span:5}},[this._v("配送地址：")]),this._v(" "),e("el-col",{attrs:{span:19}},[this._v(this._s(this.distriData.address))])],1)],1)],1),this._v(" "),e("div",{staticClass:"order-actions floatfix"},[e("el-button",{class:this.clsDetailBtn,attrs:{type:"primary",size:"mini",icon:this.showDetail?"el-icon-arrow-up":"el-icon-arrow-down"},on:{click:this.getDetail}},[this._v(this._s(this.showDetail?"关 闭":"查 看"))]),this._v(" "),this.showAcceptBtn?e("el-button",{attrs:{type:"success",size:"mini"},on:{click:this.doAccept}},[this._v("接 单")]):this._e(),this._v(" "),this.showAcceptBtn?e("el-button",{attrs:{type:"danger",size:"mini"}},[this._v("拒 绝")]):this._e(),this._v(" "),this.showDistriBtn?e("el-button",{class:this.clsDetailBtn,attrs:{type:"success",size:"mini"},on:{click:this.openDistribution}},[this._v("马上配送")]):this._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticClass:"title"},[e("i",{staticClass:"iconfont icon-calendar"}),this._v(" "),e("span",[this._v("单据详情")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticClass:"title"},[e("i",{staticClass:"iconfont icon-suggest"}),this._v(" "),e("span",[this._v("配送信息")])])}]};var ne=a("VU/8")(ie,se,!1,function(t){a("gvjP")},null,null).exports,oe={data:function(){return{show:!1,activeIndex:"1-0",loading:!1,loadingText:"正在处理..",orderList:[]}},mounted:function(){var t=this;setTimeout(function(){t.show=!0,t.handleSelect(t.activeIndex)},0)},computed:{filter:function(){return this.activeIndex.split("-")[0]}},methods:{closePanel:function(){this.$emit("close")},handleSelect:function(t){var e=t.split("-");this.loading=!0,this.orderList=[],this.activeIndex=t,1==e[0]?this._getData("push",e[1]):2==e[0]&&this._getData("pull",e[1])},_getData:function(t,e){var a=this;"push"==t?function(t){var e={action:"getPushCloudOrdList",data:G()({Type:t,CustomID:F.state.user.OrgID,StoreID:F.state.user.StoreID})};return K(X,e)}(e).then(function(t){0==t.errcode?a.orderList=t.data:a._showMessage("查询云仓推送列表失败！信息："+t.errmsg,"error"),a.loading=!1}).catch(function(t){a.loading=!1,a._showAlert(t,"error")}):"pull"==t&&function(t){var e={action:"getSendCloudOrdList",data:G()({Type:t,CustomID:F.state.user.OrgID,StoreID:F.state.user.StoreID})};return K(X,e)}(e).then(function(t){0==t.errcode?a.orderList=t.data:a._showMessage("查询云仓接单列表失败！信息："+t.errmsg,"error"),a.loading=!1}).catch(function(t){a.loading=!1,a._showAlert(t,"error")})},_showAlert:function(t,e){this.$confirm(t,"提示",{type:e||"success",showCancelButton:!1})},_showMessage:function(t,e){e=e||"success",this.$message({message:t,type:e})}},components:{CloudOrderItem:ne}},le={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"right_panel cloudorder",class:{open:t.show},attrs:{"element-loading-text":t.loadingText}},[a("i",{staticClass:"btn_close iconfont icon-xiangxiajiantou",on:{click:t.closePanel}}),t._v(" "),a("div",{staticClass:"cloudpanel_wrapper"},[a("div",{staticStyle:{"text-align":"center","background-color":"#fff",height:"43px"}},[a("el-menu",{staticClass:"el-menu-demo",attrs:{"default-active":t.activeIndex,mode:"horizontal","unique-opened":!0},on:{select:t.handleSelect}},[a("el-submenu",{attrs:{index:"1"}},[a("template",{slot:"title"},[t._v("云仓推送")]),t._v(" "),a("el-menu-item",{attrs:{index:"1-0"}},[t._v("全部")]),t._v(" "),a("el-menu-item",{attrs:{index:"1-1"}},[t._v("推送未接单")]),t._v(" "),a("el-menu-item",{attrs:{index:"1-2"}},[t._v("推送已接单")])],2),t._v(" "),a("el-submenu",{attrs:{index:"2"}},[a("template",{slot:"title"},[t._v("云仓接单")]),t._v(" "),a("el-menu-item",{attrs:{index:"2-0"}},[t._v("全部")]),t._v(" "),a("el-menu-item",{attrs:{index:"2-2"}},[t._v("已接已配送")]),t._v(" "),a("el-menu-item",{attrs:{index:"2-1"}},[t._v("已接未配送")]),t._v(" "),a("el-menu-item",{attrs:{index:"2-3"}},[t._v("未接")])],2)],1)],1),t._v(" "),a("div",{staticClass:"cloudorder_content"},[t._l(t.orderList,function(e,i){return a("cloud-order-item",{key:i,attrs:{type:"cloud",data:e,filter:t.filter,source:"cop"},on:{refresh:function(e){t.handleSelect(t.activeIndex)}}})}),t._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:!t.orderList.length>0,expression:"!orderList.length>0"}],staticClass:"noresult"},[t._v("暂无数据..")])],2)])])},staticRenderFns:[]};var re=a("VU/8")(oe,le,!1,function(t){a("iUKJ")},null,null).exports,ce={data:function(){return{show:!1,loading:!1,list:[]}},mounted:function(){var t=this;setTimeout(function(){t.show=!0,t._getList()},0)},methods:{closePanel:function(){this.$emit("close")},_getList:function(){var t=this;(function(){var t={action:"getNoSendOrdList",data:G()({CustomID:F.state.user.OrgID,StoreID:F.state.user.StoreID})};return K(X,t)})().then(function(e){0==e.errcode&&(t.list=e.data)})}},components:{CloudOrderItem:ne}},ue={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:this.loading,expression:"loading"}],staticClass:"right_panel distribution_panel",class:{open:this.show},attrs:{"element-loading-text":"正在加载.."}},[e("i",{staticClass:"btn_close iconfont icon-xiangxiajiantou",on:{click:this.closePanel}}),this._v(" "),e("div",{staticClass:"distribution_panel_wrapper"},[e("p",{staticClass:"title"},[e("span",[this._v("待配送单据列表")]),this._v(" "),e("span",{staticClass:"dot"},[this._v(this._s(this.list.length))])]),this._v(" "),e("div",{staticClass:"distribution_panel_content"},this._l(this.list,function(t,a){return e("cloud-order-item",{key:a,attrs:{type:1==t.isCloudOrder?"cloud":"local",data:t,filter:1==t.isCloudOrder?"2":"-1",source:"dp"}})}))])])},staticRenderFns:[]};var de=a("VU/8")(ce,ue,!1,function(t){a("cP4q")},"data-v-82a8b614",null).exports,he={props:{show:{type:Boolean,default:!1},vipData:{type:Object,default:function(){return{}}}},data:function(){return{loading:!1,loadingText:"正在加载历史消费..",consumeHistory:[]}},methods:{closePanel:function(){this.$emit("close")},getVipConsume:function(){var t=this;this.loading=!0,function(t,e){var a={action:"LoadVipOrder",vipcardno:t,days:e||30,timestamp:(new Date).getTime()};return K(X,a)}(this.vipData.kh,180).then(function(e){t.loading=!1,0==e.errcode&&(e.data.forEach(function(t){t.time=t.time.split(" ")[0]}),t.consumeHistory=e.data)}).catch(function(e){t._showMessage("获取VIP消费记录失败！"+e,"error"),t.loading=!1})},_showMessage:function(t,e,a){this.$message({type:e||"success",message:t,duration:a||2e3})}},watch:{show:function(t){t&&this.vipData.kh&&""!=this.vipData.kh&&this.getVipConsume(),t||(this.loading=!1,this.consumeHistory=[])}}},pe={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"right_panel vip",class:{open:t.show},attrs:{"element-loading-text":t.loadingText}},[a("i",{staticClass:"btn_close iconfont icon-xiangxiajiantou",on:{click:t.closePanel}}),t._v(" "),a("div",{staticClass:"vip_wrapper"},[a("div",{staticClass:"vip_info"},[a("p",{staticClass:"title"},[t._v("会员信息")]),t._v(" "),a("div",{staticClass:"card"},[a("div",{staticClass:"top floatfix"},[a("img",{staticClass:"avatar",attrs:{src:"http://tm.lilanz.com/qywx/res/img/storesaler/defaulticon2.png"}}),t._v(" "),a("span",{staticClass:"name"},[t._v(t._s(t.vipData.xm||"--")+"（"+t._s(t.vipData.xb||"-")+"）")]),t._v(" "),a("span",{staticClass:"discounts"},[t._v("折扣: "+t._s(t.vipData.zk||"--"))])]),t._v(" "),a("div",{staticClass:"card_item floatfix"},[t._m(0),t._v(" "),a("p",{staticClass:"value"},[t._v(t._s(t.vipData.kh||"--"))])]),t._v(" "),a("div",{staticClass:"card_item floatfix"},[t._m(1),t._v(" "),a("p",{staticClass:"value"},[t._v(t._s(t.vipData.jf||"--"))])]),t._v(" "),a("div",{staticClass:"card_item floatfix"},[t._m(2),t._v(" "),a("p",{staticClass:"value"},[t._v(t._s(t.vipData.lx||"--"))])]),t._v(" "),a("div",{staticClass:"card_item floatfix"},[t._m(3),t._v(" "),a("p",{staticClass:"value"},[t._v(t._s(t.vipData.zdrq||"--"))])]),t._v(" "),a("div",{staticClass:"card_item floatfix"},[t._m(4),t._v(" "),a("p",{staticClass:"value"},[t._v(t._s(t.vipData.sr||"--"))])])])]),t._v(" "),a("div",{staticClass:"vip_consume"},[a("p",{staticClass:"title"},[t._v("消费记录（近一个月）")]),t._v(" "),t._l(t.consumeHistory,function(e,i){return a("div",{key:i,staticClass:"consume_item"},[a("div",{staticClass:"head floatfix"},[a("span",[t._v("单据号："+t._s(e.billCode))]),t._v(" "),a("span",{staticStyle:{float:"right"}},[t._v(t._s(e.time))])]),t._v(" "),a("div",{staticClass:"body"},[a("ul",t._l(e.detail,function(e,i){return a("li",{key:i},[a("span",{staticStyle:{width:"40%"}},[t._v("货号："+t._s(e.goodsCode))]),t._v(" "),a("span",{staticStyle:{width:"20%","text-align":"center"}},[t._v("数量："+t._s(e.qty))]),t._v(" "),a("span",{staticStyle:{width:"40%","text-align":"right"}},[t._v("金额：￥"+t._s(e.goodsRealPrice))])])}))]),t._v(" "),a("div",{staticClass:"foot"},[t._v("\n          合计金额：\n          "),a("span",{staticClass:"money"},[t._v("￥"+t._s(e.realReceiptAmount))])])])}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.consumeHistory.length>0,expression:"!consumeHistory.length>0"}],staticClass:"no-result"},[t._v("对不起，暂时无消费记录..")])],2)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("label",[e("span",[this._v("*")]),this._v("卡号（电话）")])},function(){var t=this.$createElement,e=this._self._c||t;return e("label",[e("span",[this._v("*")]),this._v("可用积分")])},function(){var t=this.$createElement,e=this._self._c||t;return e("label",[e("span",[this._v("*")]),this._v("卡类别")])},function(){var t=this.$createElement,e=this._self._c||t;return e("label",[e("span",[this._v("*")]),this._v("办卡日期")])},function(){var t=this.$createElement,e=this._self._c||t;return e("label",[e("span",[this._v("*")]),this._v("生日")])}]};var fe=a("VU/8")(he,pe,!1,function(t){a("YWp+")},"data-v-5b7e59d8",null).exports,ve={name:"POS",mixins:[{methods:{handleUnqCode:function(t,e){var a=t.goodsCode,i=t.sizeCode,s=this.findRow(a,i);if(s>-1){var n=this.tableData[s];if(this.scanBack&&-1==n.sl||!this.scanBack&&1==n.sl)return void this.$confirm("对不起，该惟一码已经扫过，请不要重复！","提示",{type:"warning",showCancelButton:!1});var o=this.scanBack?n.sl-1:n.sl+1,l=n.ssj*o;n.sl=o,n.je=l}else{var r=this.discount>0&&this.discount<=10?parseInt(t.salePrice*this.discount/10):t.salePrice,c="",u=0;if(this.tableData.length>0){var d=this.tableData[this.tableData.length-1];""!=d.yyy&&d.yyyid>0&&(c=d.yyy,u=d.yyyid)}var h={sphh:t.goodsCode,sh:t.colorCode,spmc:t.goodsName,dw:t.unit,ggdm:t.sizeCode,gg:t.sizeName,lsdj:t.salePrice,zk:this.discount,ssj:r,sl:this.scanBack?-1:1,je:this.scanBack?-1*r:r,yyy:c,yyyid:u,sourcecode:e};this.tableData.push(h),this.detailUnionID.push(e)}},handleOrdCode:function(t,e){var a=t.goodsCode,i=t.sizeCode,s=this.findRow(a,i);if(s>-1){var n=this.tableData[s],o=n.sl,l=n.ssj;this.scanBack?l*=--o:l*=++o,n.sl=o,n.je=l}else{var r=this.discount>0&&this.discount<=10?parseInt(t.salePrice*this.discount/10):t.salePrice,c="",u=0;if(this.tableData.length>0){var d=this.tableData[this.tableData.length-1];""!=d.yyy&&d.yyyid>0&&(c=d.yyy,u=d.yyyid)}var h={sphh:a,sh:t.colorCode,spmc:t.goodsName,dw:t.unit,ggdm:t.sizeCode,gg:t.sizeName,lsdj:t.salePrice,zk:this.discount,ssj:r,sl:this.scanBack?-1:1,je:this.scanBack?-1*r:r,yyy:c,yyyid:u,sourcecode:e};this.tableData.push(h)}},findRow:function(t,e){var a=-1;return this.tableData.forEach(function(i,s){var n=i.sphh,o=i.ggdm;if(t==n&&e==o)return a=s}),a},sleep:function(t){return new c.a(function(e){setTimeout(e,t)})}}}],data:function(){return{disBillInfo:{source:"pos"},localExpress:!1,isCloudOrder:!1,billSaveResult:{id:0,code:"",sourceid:0,modifyTime:""},assistFilterWord:"",vipInfo:{},vipListData:[],currentPanel:"",currentDialog:"",currentPayMode:"",loading:!1,loadingText:"正在处理中..",tableData:[],payTableData:[],scanBack:!1,tableHeight:"",cantPrint:!1,discount:10,saleType:1,saleTypeOptions:[{label:"销售",value:1},{label:"定制销售",value:2},{label:"退货",value:-1},{label:"定制退货",value:-2}],classNo:"A班",classList:[{label:"A班",value:"A班"},{label:"B班",value:"B班"}],stockNo:0,remark:""}},watch:{tableData:{handler:function(){this.cantPrint=!1},deep:!0},saleType:function(t,e){console.log("watch saleType:",t,e),(t>0&&e<0||t<0&&e>0)&&0==this.billSaveResult.id&&""==this.billSaveResult.code&&this.userinfo.Auth_IsBack&&(console.log("saleType has change,reset all!"),this.restart())}},created:function(){this.currentRow=null,this.detailUnionID=[],this.payTableOrder=1},mounted:function(){return this.resizeTable(),this.bindEvents(),void this.initInfos()},destroyed:function(){window.onresize=function(){},$(document).unbind("keypress",this._keyPressEvent)},computed:o()({},Object(p.b)(["userinfo"]),{showMask:function(){return""!=this.currentPanel},isBack:function(){return(-1==this.saleType||-2==this.saleType)&&(this.$message({message:"温馨提示：当前处于退换货模式！",type:"warning",duration:1500}),!0)},retTotal:function(){var t=0,e=0;return this.tableData.forEach(function(e){t+=Number(e.je)}),this.payTableData.forEach(function(t){e+=Number(t.count)}),console.log("retTotal computed:",t,e),parseInt(t-e).toString()},canSwitchOrder:function(){return this.saleType<0&&(this.isCloudOrder=!1,!0)},distributionInfos:function(){if("pos"==this.disBillInfo.source){var t="";return this.isCloudOrder?t="cloud":this.localExpress&&(t="local"),{source:"pos",type:t,billID:this.billSaveResult.id||0}}return{source:this.disBillInfo.source,type:this.disBillInfo.type,billID:this.disBillInfo.billID}}}),methods:o()({},Object(p.c)({setLock:"SET_LOCK"}),{updatePoints:function(t){this.vipInfo.kh&&""!=this.vipInfo.kh&&(this.vipInfo.jf=t)},policiesCheck:function(){ut(this.tableData.map(function(t){return{sphh:t.sphh,sl:t.sl,lsdj:t.lsdj,dj:t.ssj,sh:t.sh,spmc:t.spmc,dw:t.dw,ggdm:t.ggdw,gg:t.gg,yyy:t.yyy,yyyid:t.yyyid,sourcecode:t.sourcecode}}))},cloudOrderSwitch:function(t){console.log("cloudOrderSwitch",t)},priceChange:function(t,e){var a=Number(t.target.value);if(a>0){var i=(a/e.lsdj*10).toFixed(2),s=a*e.sl;e.zk=i,e.je=s}},numLimit:function(t){t.keyCode>=48&&t.keyCode<=57||46==t.keyCode||t.preventDefault()},discountChange:function(t,e){if(void 0==this.userinfo.Auth_IsDiscount||this.userinfo.Auth_IsDiscount){var a=Number(t.target.value),i=isNaN(this.vipInfo.zk)?10:this.vipInfo.zk;if(a<Math.min(i,this.userinfo.Auth_MinDiscount))return t.target.value=10,e.zk=10,void t.preventDefault();e.ssj=parseInt(e.zk*e.lsdj/10),e.je=e.ssj*e.sl}else this._showAlert("对不起，您没有折扣权！！","warning")},checkDiscount:function(){if(console.log("checkDiscount"),""!=this.discount&&Number(this.userinfo.Auth_MinDiscount)>=0){var t=Number(this.userinfo.Auth_MinDiscount);this.discount<t&&(this.discount=10,this.$confirm("对不起，您的最低折扣数为"+t,"提示",{type:"warning",showCancelButton:!1}))}},newBill:function(){this.restart("newbill")},restart:function(t){this.billSaveResult={id:0,code:"",sourceid:0,modifyTime:""},this.disBillInfo={source:"pos"},this.assistFilterWord="",this.vipInfo={},this.tableData=[],this.payTableData=[],this.scanBack=!1,this.cantPrint=!1,this.discount=10,this.classNo="A班",this.remark="",this.currentRow=null,this.detailUnionID=[],this.localExpress=!1,this.isCloudOrder=!1,this.payTableOrder=1,"print"!=t&&"newbill"!=t&&"hangUpBill"!=t||(this.saleType=1),this.$refs.pay_types.reset()},doPushOrder:function(){var t=this;return Q()(Y.a.mark(function e(){return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.loadingText="正在推送订单，请稍候..",t.loading=!0,e.next=4,t.sleep(1e3);case 4:return e.abrupt("return",new c.a(function(e){(a=t.billSaveResult.id,K(X,{action:"PushCloudOrd",ID:a})).then(function(a){0==a.errcode?e({result:!0}):(e({result:!1,errmsg:a.errmsg}),t.loading=!1)}).catch(function(a){t.loading=!1,e({result:!1,errmsg:error})});var a}));case 5:case"end":return e.stop()}},e,t)}))()},doPrintBill:function(){var t=this;return Q()(Y.a.mark(function e(){var a,i,s,n,o,l;return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isCloudOrder){e.next=10;break}return e.next=3,t.doPushOrder();case 3:if((a=e.sent).result){e.next=9;break}return t._showAlert("云单推送失败！原因："+a.errmsg,"error"),e.abrupt("return");case 9:t._showMessage("订单推送成功！");case 10:return t.loadingText="正在打印保存，请稍候..",t.loading=!0,e.next=14,t.sleep(1e3);case 14:i=t.$refs.pay_static.getStatic(),s=t._checkPointsFlag(),n=!!t.vipInfo.innerAmount&&Number(t.vipInfo.innerAmount)>0,o={id:t.billSaveResult.id,storeID:t.userinfo.storeID,billCode:t.billSaveResult.code,modifyTime:t.billSaveResult.modifyTime,mustReceiptAmount:Number(i.shouldGetTotal),realReceiptAmount:Number(i.netGetTotal),classes:t.classNo,stockID:t.stockNo,discountOffAmount:"",points:"",vipCardCode:t.vipInfo.kh,creator:t.userinfo.UserName,sourceBillID:t.billSaveResult.sourceid,pointsFlag:s,isCoreAuth:n,isCloudOrder:t.isCloudOrder?1:0,localSendMethod:t.localExpress?1:0},l=t.payTableData.map(function(e){return{id:t.billSaveResult.id,payID:e.id,amount:Number(e.count),cashCardID:0,exchangePoints:e.points||0}}),o.payMode=l,Number(i.retTotal)>0&&l.push({id:t.billSaveResult.id,payID:-1,amount:-1*Number(i.retTotal),cashCardID:0,exchangePoints:0}),ot(G()(o)).then(function(e){if(0==e.errcode){var a=t.billSaveResult.id;window.open("./posPrint.aspx?USER="+t.userinfo.mySession+"&Dzid="+a),t.restart("print"),t._showAlert("打印保存成功！")}else t._showAlert("打印保存失败！"+e.errmsg,"error");t.$nextTick(function(){t.$refs.sourceBC.value="",t.loading=!1})}).catch(function(e){t.$confirm("打印保存失败！"+e,"提示",{type:"error",showCancelButton:!1}),t.$nextTick(function(){t.$refs.sourceBC.value="",t.loading=!1})});case 22:case"end":return e.stop()}},e,t)}))()},printBill:function(){var t=this,e=this.$refs.pay_static.getStatic();if(0!=Number(e.shouldGetTotal)&&0!=Number(e.netGetTotal)&&Number(e.retTotal)>=0){if(!this._checkBillID())return;if(this.localExpress||this.isCloudOrder){var a="该单据为【"+(this.isCloudOrder?"云仓单":"本地配送单")+"】需要先录入配送信息！";return void this.$confirm(a,"提示",{type:"info",confirmButtonText:"好的"}).then(function(){t.disBillInfo={source:"pos"},t.currentDialog="distribution_dialog"}).catch(function(){})}this.$confirm("确定打印收银单？？","提示",{type:"warning"}).then(this.doPrintBill.bind(this))}else this.$confirm("对不起，付款不足！","提示",{type:"error",showCancelButton:!1})},showSourceBillDetail:function(t){var e=this,a=t.target.value;""!=a&&(this.loadingText="正在查询单据【"+a+"】详情..",this.loading=!0,""!=a&&(this.restart(),function(t){var e={action:"LoadByBillNo",storeid:F.state.user.StoreID,billNo:t,timestamp:(new Date).getTime()};return K(X,e)}(a).then(function(t){if(0==t.errcode)if(!t.data||t.data&&"{}"==G()(t.data))e._showAlert("对不起，该单据号【"+a+"】无效！","warning");else{e.billSaveResult.sourceid=t.data.id,e.detailUnionID=t.data.unionID,e.remark="原单据号"+a,t.data.vipCardCode&&(e.vipInfo={kh:t.data.vipCardCode}),void 0!==t.data.vipCardCode&&""!=t.data.vipCardCode&&e.getVipByNo(t.data.vipCardCode);var i=t.data.detail.map(function(t){return{sphh:t.goodsCode,sh:t.colorCode,spmc:t.goodsName,dw:t.unit,ggdm:t.sizeCode,gg:t.sizeName,lsdj:t.salePrice,zk:t.discounts,ssj:t.goodsRealPrice,sl:t.qty,je:Number(t.goodsAmount),yyy:t.saler,yyyid:t.salerID,sourcecode:""}});e.tableData=i}else e.$refs.sourceBC.value="",e._showAlert("读取单据号【"+a+"】失败！"+t.errmsg,"error");console.log(e.billSaveResult),e.$nextTick(function(){e.loading=!1})}).catch(function(t){e.$refs.sourceBC.value="",e._showAlert("读取单据号【"+a+"】失败！！"+t,"error"),e.$nextTick(function(){e.loading=!1})})))},showBillDetail:function(t){var e=this;this.loadingText="正在查询单据，请稍候..",this.loading=!0,function(t){var e={action:"GetOrder",storeid:F.state.user.StoreID,orderid:t,timestamp:(new Date).getTime()};return K(X,e)}(t).then(function(t){if(0==t.errcode){e.billSaveResult.id=t.data.iD,e.billSaveResult.code=t.data.billCode,e.billSaveResult.sourceid=t.data.sourceBillID,e.billSaveResult.modifyTime=t.data.modifyTime,e.saleType=t.data.billType,Number(e.saleType)<0&&(e.isCloudOrder=!1),e.discount=t.data.discounts,e.stockNo=t.data.stockID,e.classNo=t.data.classes,e.remark=t.data.remark,t.data.vipCardCode&&(e.vipInfo={kh:t.data.vipCardCode}),void 0!==t.data.vipCardCode&&""!=t.data.vipCardCode&&e.getVipByNo(t.data.vipCardCode);var a=t.data.detail.map(function(t){return{sphh:t.goodsCode,sh:t.colorCode,spmc:t.goodsName,dw:t.unit,ggdm:t.sizeCode,gg:t.sizeName,lsdj:t.salePrice,zk:t.discounts,ssj:t.goodsRealPrice,sl:t.qty,je:Number(t.goodsAmount),yyy:t.saler,yyyid:t.salerID,sourcecode:""}});e.detailUnionID=t.data.unionID,e.tableData=a,e.payTableData=[],e.$refs.pay_types.reset(),e.assistFilterWord="",e.scanBack=!1,e.cantPrint=!1,e.currentRow=null,e.payTableOrder=1,1==t.data.isCloudOrder?e.isCloudOrder=!0:1==t.data.localSendMethod&&(e.localExpress=!0)}else e.$confirm("读取单据详情失败："+t.errmsg,"提示",{type:"error",showCancelButton:!1});e.$nextTick(function(){console.log(e.loading),e.loading=!1,console.log(e.loading)})}).catch(function(t){e.$confirm("读取单据详情失败！！"+t,"提示",{type:"error",showCancelButton:!1}),e.$nextTick(function(){e.loading=!1})})},delPayTableRow:function(t,e,a,i){var s=this;"order"==e.property&&this.$confirm("确认该付款记录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){if(-19==t.id||-20==t.id||-24==t.id){s.loadingText="正在发起微支付退款，请稍候..",s.loading=!0;lt({billID:s.billSaveResult.id,payAmount:"",payID:t.id,category:"refund",authCode:""}).then(function(e){0==e.errcode?(s.$message({type:"success",message:"微支付退款成功！"}),s.removePayType(t)):s.$message({type:"error",message:"微支付退款失败！"+e.errmsg,duration:2e3}),s.$nextTick(function(){s.loading=!1})}).catch(function(t){console.log(t),s.$message({type:"error",message:"微支付退款失败！！"}),s.$nextTick(function(){s.loading=!1})})}else s.removePayType(t)})},removePayType:function(t){for(var e=null,a=0;a<this.payTableData.length;a++)if(t===this.payTableData[a]){e=a;break}this.payTableData.splice(e,1),this.$message({message:"移除付款记录成功！",type:"success"})},initInfos:function(){this.stockNo=this.userinfo.DefaultStockID},bindEvents:function(){var t=this;l.$on("openPanel",function(e){t.currentPanel=e}),l.$on("openDialog",function(e,a){t.currentDialog=e,a&&(t.disBillInfo=a)}),$(document).unbind("keypress",this._keyPressEvent),$(document).bind("keypress",this._keyPressEvent),window.onresize=this.resizeTable.bind(this)},getVipByNo:function(t){var e=this;it({vipcardno:t,phone:"",name:""}).then(function(t){if(0==t.errcode&&t.data.length>0){var a=t.data[0].birthday,i=t.data[0].createTime;""!=a&&(a=a.split(" ")[0]),""!=i&&(i=i.split(" ")[0]),e.vipInfo={kh:t.data[0].vipCardCode,xm:t.data[0].vipName,jf:t.data[0].points,zk:Number(t.data[0].discounts),xb:"1"==t.data[0].sex?"女":"男",lx:t.data[0].vipCardType,sr:a,zdrq:i,isInner:t.data[0].isCoreAuth,innerRemark:t.data[0].coreAuthRemark,innerAmount:t.data[0].coreAuthAmount,vipFlag:t.data[0].vipFlag}}})},getVip:function(t,e){var a=this;if(""==t)return this.vipInfo={},void(this.discount=10);this.loadingText="正在查询VIP信息..",this.loading=!0;it({vipcardno:"kh"==e?t:"",name:"name"==e?t:"",phone:""}).then(function(t){if(0==t.errcode)if(0==t.data.length)a._showAlert("对不起，无效卡号！","warning"),a.vipInfo={};else{var e=t.data.map(function(t){var e=t.birthday,a=t.createTime;return""!=e&&(e=e.split(" ")[0]),""!=a&&(a=a.split(" ")[0]),{kh:t.vipCardCode,xm:t.vipName,jf:t.points,zk:Number(t.discounts),xb:"1"==t.sex?"女":"男",lx:t.vipCardType,sr:e,zdrq:a,isInner:t.isCoreAuth,innerRemark:t.coreAuthRemark,innerAmount:t.coreAuthAmount,vipFlag:t.vipFlag}});if(1==e.length){a.vipInfo=e[0],console.log("vipInfo",a.vipInfo);var i=e[0].zk;!isNaN(i)&&i>0&&i<=10&&(a.discount=i)}else a.vipListData=e,a.openDialog("vipList")}else a.$confirm("查询VIP信息失败："+t.errmsg,"提示",{type:"error",showCancelButton:!1});a.$nextTick(function(){a.loading=!1})}).catch(function(t){a._showAlert("查询VIP出错！"+t,"error"),a.$nextTick(function(){a.loading=!1})})},inputCode:function(t){var e=this,a=t.target.value;""!=a&&(t.target.value="",function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a={action:"LoadProduct",code:t,orgid:F.state.user.OrgID,storeid:F.state.user.StoreID,isCloudOrder:e,timestamp:(new Date).getTime()};return K(X,a)}(a,this.isCloudOrder?1:0).then(function(i){0==i.errcode?a.length>15?e.handleUnqCode(i.data,a):e.handleOrdCode(i.data,a):e.$confirm("查询条码失败："+i.errmsg,"提示",{type:"error",showCancelButton:!1}),t.target.focus()}).catch(function(t){e.$confirm("查询条码失败，请联系IT解决。"+t,"提示",{type:"error",showCancelButton:!1})}))},addPayItem:function(t,e){var a=-1;if(this.payTableData.forEach(function(e,i){e.id!=t.payid||(a=i)}),t.points=t.points||0,-1==a){var i=this.payTableOrder++;this.payTableData.push({order:i,id:t.payid,no:t.no,type:t.type,count:t.count,points:t.points})}else if("microCheck"==e)this.payTableData[a].count=t.count;else{var s=this.payTableData[a].count,n=this.payTableData[a].points;this.payTableData[a].count=s+t.count,this.payTableData[a].points=n+t.points}},cellClick:function(t,e,a,i){"序号"==e.label&&"order"==e.className&&this.$confirm("确认删除该记录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(this.delTableRow.bind(this,t)).catch(function(t){})},delTableRow:function(t){for(var e=null,a=0;a<this.tableData.length;a++)if(t===this.tableData[a]){e=a;break}var i=t.sourcecode;i.length>15&&(this.detailUnionID=this.detailUnionID.filter(function(t){return t!=i})),this.tableData.splice(e,1),this.$message({message:"记录移除成功！",type:"success"})},openAssistDialog:function(t,e){""!=e.yyy?this.openDialog(t,e):e.yyyid=""},openMenuList:function(t){"2"!=t&&"3"!=t&&"6"!=t&&"4"!=t||this.openDialog("paymodelist_dialog",t)},autoFill:function(t,e,a){for(var i=t+1;i<this.tableData.length;i++)""==this.tableData[i].yyy&&(this.tableData[i].yyy=e,this.tableData[i].yyyid=a)},openDialog:function(t,e){"assistantList"==t?(this.currentRow=e,this.assistFilterWord=e.yyy,this.currentDialog="assistant_dialog"):"vipList"==t?this.currentDialog="vip_dialog":"hangUpList"==t?this.currentDialog="hangup_dialog":"paymodelist_dialog"==t?(this.currentPayMode=e,this.currentDialog="paymodelist_dialog"):"unionpaylist_dialog"==t?(this.currentPayMode=e,this.currentDialog="unionpaylist_dialog"):"starunionpay_dialog"==t&&(this.currentPayMode=e,this.currentDialog="starunionpay_dialog")},dialogHandle:function(t,e){var a=this;switch(t){case"assistantList":this.currentRow.yyy=e.name,this.currentRow.yyyid=e.id;var i=-1;this.tableData.forEach(function(t,e){a.currentRow!==t||(i=e)}),i>-1&&""!=e.name&&e.id>0&&this.autoFill(i,e.name,e.id),this.currentRow=null;break;case"vipList":this.vipInfo=e;var s=e.zk;!isNaN(s)&&s>0&&s<=10&&(this.discount=s);break;case"hangUpList":console.log(e);break;case"paymodelist_dialog":if(void 0===e)this.$refs.pay_types.reset();else{if("4"==this.currentPayMode&&-21==e.ID)return void this.openDialog("unionpaylist_dialog","4");if("4"==this.currentPayMode&&-23==e.ID)return void this.openDialog("starunionpay_dialog","4");l.$emit("selectPayMode",{ID:e.ID,payCode:e.payCode,payName:e.payName})}}this.currentDialog=""},doSaveBill:function(){var t=this;this._checkBillID()&&(!this.userinfo.IsClerk||1!=this.userinfo.IsClerk||this.checkAssistantFill()?(this.loadingText="正在结算保存中，请稍候..",this.loading=!0,this.saveBill().then(function(e){0==e.errcode?(t.billSaveResult.id=e.data.ID,t.billSaveResult.code=e.data.billCode,t.billSaveResult.modifyTime=e.data.modifyTime,t.$message({message:"结算保存成功，接下来请录入付款信息！",type:"success",duration:2e3}),t.cantPrint=!0,t.$refs.pay_types.start()):t.$confirm("对不起，结算失败！"+e.errmsg,"提示",{type:"error",showCancelButton:!1}),t.$nextTick(function(){t.$refs.sourceBC.value="",t.loading=!1})}).catch(function(e){t.$confirm("结算失败！"+e,"提示",{type:"error",showCancelButton:!1}),t.$nextTick(function(){t.$refs.sourceBC.value="",t.loading=!1})})):this._showAlert("对不起，必须全部维护营业员后才能继续！","warning"))},checkAssistantFill:function(){for(var t=!0,e=0;e<this.tableData.length;e++){var a=this.tableData[e];if(!a.yyy||a.yyy&&""==a.yyy){t=!1;break}}return t},hangUpBill:function(){var t=this;!this._checkBillID()||this.tableData.length<=0||(this.loadingText="正在挂单保存中，请稍候..",this.loading=!0,this.saveBill().then(function(e){0==e.errcode?(t.$confirm("挂单成功！单据号【"+e.data.billCode+"】","提示",{type:"success",showCancelButton:!1}),t.restart("hangUpBill")):t.$confirm("挂单失败！"+e.errmsg,"提示",{type:"error",showCancelButton:!1}),t.$nextTick(function(){t.$refs.sourceBC.value="",t.loading=!1})}).catch(function(e){t.$confirm("挂单失败！"+e,"提示",{type:"error",showCancelButton:!1}),t.$nextTick(function(){t.$refs.sourceBC.value="",t.loading=!1})}))},saveBill:function(t){var e=this;return new c.a(function(t,a){e.tableData.length<=0?a("暂未录入相关商品！"):setTimeout(function(){var i={id:e.billSaveResult.id,billCode:e.billSaveResult.code,customID:e.userinfo.OrgID,storeID:e.userinfo.StoreID,billType:e.saleType,classes:e.classNo,stockID:e.stockNo,remark:e.remark,vipCardCode:e.vipInfo.kh,creator:e.userinfo.UserName,discounts:e.discount,discountOffType:"",discountOffAmount:"",sourceBillID:e.billSaveResult.sourceid,modifyTime:e.billSaveResult.modifyTime,isCloudOrder:e.isCloudOrder?1:0,localSendMethod:e.localExpress?1:0},s=e.tableData.map(function(t){return{goodsCode:t.sphh,colorCode:t.sh,sizeCode:t.ggdm,sizeName:t.gg,salePrice:t.lsdj,discounts:t.zk,goodsRealPrice:t.ssj,qty:t.sl,goodsAmount:t.je,saler:t.yyy,salerID:""!=t.yyy?t.yyyid:""}});i.Detail=s;var n=[];for(var o in e.detailUnionID)n.push(o);i.UnionID=n,function(t){var e={action:"SaveOrder",data:t,timestamp:(new Date).getTime()};return tt(X,at.a.stringify(e))}(G()(i)).then(function(e){t(e)}).catch(function(t){a(t)})},500)})},resizeTable:function(){var t=this.$refs.sale_wrap.clientHeight;t<120||(this.tableHeight=t,this.$refs.sale_table.doLayout())},tableSummaries:function(t){var e=t.columns,a=t.data,i=[];return e.forEach(function(t,e){if(0!==e)if("sl"==t.property||"je"==t.property){var s=a.map(function(e){return Number(e[t.property])});s.every(function(t){return isNaN(t)})||(i[e]=s.reduce(function(t,e){var a=Number(e);return isNaN(a)?t:t+e},0))}else i[e]="";else i[e]="合计"}),i},_showAlert:function(t,e){this.$confirm(t,"提示",{type:e||"success",showCancelButton:!1})},_showMessage:function(t,e){e=e||"success",this.$message({message:t,type:e})},_checkBillID:function(){return!(void 0==this.billSaveResult.id||Number(this.billSaveResult.id)<=0)||""==this.billSaveResult.code||(this.$message({type:"error",message:"对不起，单据ID不能为空！"}),!1)},_keyPressEvent:function(t){var e=t||window.event,a=e.keyCode||e.which||e.charCode;43==a?($(".inp_scan").focus(),t.preventDefault(),console.log("keyPressEvent:+")):45==a&&(this.$refs.pay_types.doFocus(),console.log("keyPressEvent:-"))},_checkPointsFlag:function(){if(0==this.tableData.length)return!1;var t=this.vipInfo.vipFlag==this.userinfo.VipFlag,e=0,a=0,i=0;return this.tableData.forEach(function(t){e+=t.sl*t.lsdj,a+=t.je}),i=(a/e).toFixed(2),t&&a>=this.userinfo.Point_CheckMinAmount&&i>=this.userinfo.Point_CheckMinDiscount}}),components:{AssistantList:ft,VipCard:Rt,PayTypes:Ot,PayTable:Ft,PayStatic:Gt,MessagePanel:qt,AchievePanel:Kt,FeedbackPanel:ae,VipPanel:fe,CloudOrderPanel:re,BillPanel:Zt,VipList:gt,HangUpList:St,PayModeList:bt,UnionPayList:kt,StarUnionPay:Pt,DistributionDialog:At,DistributionPanel:de}},me={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"pos_container",attrs:{"element-loading-text":t.loadingText}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.showMask,expression:"showMask"}],staticClass:"pos_container_mask"}),t._v(" "),a("div",{staticClass:"right_area"},[a("vip-card",{attrs:{data:t.vipInfo,"can-pay":t.cantPrint},on:{blurEvent:t.getVip,updatePoints:t.updatePoints,addPayItem:t.addPayItem}}),t._v(" "),a("pay-types",{ref:"pay_types",attrs:{"bill-info":t.billSaveResult,"can-pay":t.cantPrint,payCounts:t.retTotal},on:{addPayItem:t.addPayItem,openMenuList:t.openMenuList}}),t._v(" "),a("pay-table",{attrs:{data:t.payTableData},on:{"cell-click":t.delPayTableRow}}),t._v(" "),a("pay-static",{ref:"pay_static",attrs:{"pay-data":t.payTableData,"sale-data":t.tableData}})],1),t._v(" "),a("div",{staticClass:"left_area"},[a("div",{staticClass:"main_area"},[a("div",{staticClass:"lab_wrap floatfix"},[a("div",{staticClass:"lab_item"},[a("el-checkbox",{staticClass:"sale_mode",attrs:{size:"medium"},model:{value:t.scanBack,callback:function(e){t.scanBack=e},expression:"scanBack"}},[t._v("刷退")])],1),t._v(" "),a("div",{staticClass:"lab_item",staticStyle:{"margin-left":"10px"}},[t._v("单据号："+t._s(t.billSaveResult.code||"--"))]),t._v(" "),a("div",{staticClass:"lab_item",staticStyle:{"margin-left":"10px"}},[a("label",{staticStyle:{color:"#414b5d",width:"70px","font-size":"16px"}},[t._v("扫 条 码：")]),t._v(" "),a("input",{staticClass:"inp_scan",attrs:{type:"text"},on:{blur:t.inputCode,keypress:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;e.target.blur()}}})]),t._v(" "),a("div",{staticClass:"lab_item",staticStyle:{float:"right","margin-right":"-2px"}},[a("label",{style:{color:t.isCloudOrder?"#579be4":""}},[t._v("云仓单：")]),t._v(" "),a("el-switch",{attrs:{disabled:t.canSwitchOrder,"active-color":"#579be4","inactive-color":"#ccc"},on:{change:t.cloudOrderSwitch},model:{value:t.isCloudOrder,callback:function(e){t.isCloudOrder=e},expression:"isCloudOrder"}})],1)]),t._v(" "),a("div",{staticClass:"filter_wrap"},[a("div",{staticClass:"row floatfix"},[a("div",{staticClass:"f_item"},[a("el-checkbox",{attrs:{disabled:t.isCloudOrder},model:{value:t.localExpress,callback:function(e){t.localExpress=e},expression:"localExpress"}},[t._v("配 送")])],1),t._v(" "),a("div",{staticClass:"f_item"},[a("label",[t._v("销售别")]),t._v(" "),a("el-select",{ref:"saleTypeSelect",attrs:{placeholder:"请选择",disabled:t.isCloudOrder},model:{value:t.saleType,callback:function(e){t.saleType=e},expression:"saleType"}},t._l(t.saleTypeOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("div",{staticClass:"f_item"},[a("label",{staticStyle:{width:"30px"}},[t._v("折扣")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.discount,expression:"discount"}],staticStyle:{width:"50px"},attrs:{disabled:!t.userinfo.Auth_IsDiscount,type:"text"},domProps:{value:t.discount},on:{blur:t.checkDiscount,keypress:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;e.target.blur()},input:function(e){e.target.composing||(t.discount=e.target.value)}}})]),t._v(" "),a("div",{staticClass:"f_item"},[a("label",{staticStyle:{width:"30px"}},[t._v("仓库")]),t._v(" "),a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.stockNo,callback:function(e){t.stockNo=e},expression:"stockNo"}},t._l(t.userinfo.StockList,function(t){return a("el-option",{key:t.id,attrs:{label:t.Name,value:t.id}})}))],1),t._v(" "),a("div",{staticClass:"f_item"},[a("label",{staticStyle:{width:"20px"}},[t._v("班次")]),t._v(" "),a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.classNo,callback:function(e){t.classNo=e},expression:"classNo"}},t._l(t.classList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("div",{staticClass:"f_item"},[a("label",{staticStyle:{width:"60px"}},[t._v("原销售单号")]),t._v(" "),a("input",{ref:"sourceBC",staticStyle:{width:"100px"},attrs:{type:"text",disabled:!t.isBack},on:{blur:t.showSourceBillDetail,keypress:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;e.target.blur()}}})]),t._v(" "),a("div",{staticClass:"f_item"},[a("label",{staticStyle:{width:"30px"}},[t._v("备注")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.remark,expression:"remark"}],staticStyle:{width:"120px"},attrs:{type:"text"},domProps:{value:t.remark},on:{input:function(e){e.target.composing||(t.remark=e.target.value)}}})])])]),t._v(" "),a("div",{ref:"sale_wrap",staticClass:"sale_wrap",class:{back:t.isBack,cloudorder:t.isCloudOrder}},[a("el-table",{ref:"sale_table",staticClass:"sale_table",attrs:{"summary-method":t.tableSummaries,data:t.tableData,height:t.tableHeight,border:"","show-summary":""},on:{"cell-click":t.cellClick}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"50","class-name":"order"}}),t._v(" "),a("el-table-column",{attrs:{prop:"sphh",label:"货号",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"sh",label:"色号",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{prop:"spmc",label:"名称",width:"160","class-name":"spmc"}}),t._v(" "),a("el-table-column",{attrs:{prop:"dw",label:"单位",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{prop:"gg",label:"规格",width:"60"}}),t._v(" "),a("el-table-column",{attrs:{prop:"lsdj",label:"零售价",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{label:"折扣",width:"80","class-name":"zk"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"el-input"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.row.zk,expression:"scope.row.zk"}],staticClass:"el-input__inner",attrs:{type:"text"},domProps:{value:e.row.zk},on:{change:function(a){t.discountChange(a,e.row)},input:function(a){a.target.composing||t.$set(e.row,"zk",a.target.value)}}})])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"实售价",width:"80","class-name":"ssj"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"el-input"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.row.ssj,expression:"scope.row.ssj"}],staticClass:"el-input__inner",attrs:{type:"text"},domProps:{value:e.row.ssj},on:{change:function(a){t.priceChange(a,e.row)},keypress:[t.numLimit,function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;e.target.blur()}],input:function(a){a.target.composing||t.$set(e.row,"ssj",a.target.value)}}})])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"sl",label:"数量",width:"60"}}),t._v(" "),a("el-table-column",{attrs:{prop:"je",label:"金额",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{label:"营业员",width:"80","class-name":"yyy"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{on:{change:function(a){t.openAssistDialog("assistantList",e.row)}},nativeOn:{contextmenu:function(a){t.openDialog("assistantList",e.row)}},model:{value:e.row.yyy,callback:function(a){t.$set(e.row,"yyy",a)},expression:"scope.row.yyy"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:""}})],1)],1),t._v(" "),a("div",{staticClass:"btn_wrap"},[a("el-button",{staticClass:"action",attrs:{type:"info",plain:""},on:{click:function(e){t.setLock(!0)}}},[t._v("锁屏")]),t._v(" "),a("el-button",{staticClass:"action",attrs:{type:"info",plain:""},on:{click:t.hangUpBill}},[t._v("挂单[F3]")]),t._v(" "),a("el-button",{staticClass:"action",attrs:{type:"info",plain:"",disabled:!t.cantPrint},on:{click:t.printBill}},[t._v("打印[F9]")]),t._v(" "),a("el-button",{staticClass:"action",attrs:{type:"info",disabled:"",plain:""},on:{click:t.policiesCheck}},[t._v("促销检查")]),t._v(" "),a("el-button",{attrs:{type:"success",plain:""},on:{click:t.newBill}},[t._v("开新单")]),t._v(" "),a("el-button",{attrs:{type:"primary",disabled:!this.tableData.length>0},on:{click:t.doSaveBill}},[t._v("结 算")])],1)])]),t._v(" "),t._m(0),t._v(" "),a("achieve-panel",{attrs:{show:"achieve_panel"==t.currentPanel},on:{close:function(e){t.currentPanel=""}}}),t._v(" "),a("vip-panel",{attrs:{show:"vip_panel"==t.currentPanel,"vip-data":t.vipInfo},on:{close:function(e){t.currentPanel=""}}}),t._v(" "),a("bill-panel",{attrs:{show:"bill_panel"==t.currentPanel},on:{close:function(e){t.currentPanel=""},showBillDetail:t.showBillDetail}}),t._v(" "),a("message-panel",{attrs:{show:"message_panel"==t.currentPanel},on:{close:function(e){t.currentPanel=""}}}),t._v(" "),a("feedback-panel",{attrs:{show:"feedback_panel"==t.currentPanel},on:{close:function(e){t.currentPanel=""}}}),t._v(" "),"cloudorder_panel"==t.currentPanel?a("cloud-order-panel",{on:{close:function(e){t.currentPanel=""}}}):t._e(),t._v(" "),"distribution_panel"==t.currentPanel?a("distribution-panel",{on:{close:function(e){t.currentPanel=""}}}):t._e(),t._v(" "),a("assistant-list",{attrs:{visiable:"assistant_dialog"==t.currentDialog,"filter-words":t.assistFilterWord},on:{select:t.dialogHandle}}),t._v(" "),a("vip-list",{attrs:{visiable:"vip_dialog"==t.currentDialog,data:t.vipListData},on:{select:t.dialogHandle}}),t._v(" "),a("distribution-dialog",{attrs:{visiable:"distribution_dialog"==t.currentDialog,"bill-info":t.distributionInfos},on:{select:t.dialogHandle,doNext:t.doPrintBill}}),t._v(" "),a("pay-mode-list",{attrs:{visiable:"paymodelist_dialog"==t.currentDialog,mode:t.currentPayMode,"bill-info":t.billSaveResult},on:{addPayItem:t.addPayItem,select:t.dialogHandle}}),t._v(" "),a("union-pay-list",{attrs:{visiable:"unionpaylist_dialog"==t.currentDialog,"bill-info":t.billSaveResult,shouldPay:t.retTotal},on:{addPayItem:t.addPayItem,select:t.dialogHandle}}),t._v(" "),"starunionpay_dialog"==t.currentDialog?a("star-union-pay",{attrs:{"bill-info":t.billSaveResult,shouldPay:t.retTotal},on:{addPayItem:t.addPayItem,select:t.dialogHandle}}):t._e()],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"bot_area floatfix"},[e("div",{staticClass:"button_tips"},[e("i",{staticClass:"iconfont icon-tishi"}),this._v(" "),e("span",[this._v("快捷切换：")]),this._v(" "),e("span",{staticStyle:{color:"#3a8ae3",margin:"0 15px","font-size":"16px"}},[this._v("+")]),this._v(" "),e("span",[this._v("切换至商品录入区；")]),this._v(" "),e("span",{staticStyle:{color:"#3a8ae3",margin:"0 15px","font-size":"16px"}},[this._v("-")]),this._v(" "),e("span",[this._v("切换至收款显示区；")]),this._v(" "),e("span",[this._v("推荐分辨率1440X900")])])])}]};var ge=a("VU/8")(ve,me,!1,function(t){a("eOv1")},null,null).exports,ye={data:function(){return{logining:!0}},computed:o()({},Object(p.b)(["userinfo"]),{btnText:function(){return this.logining?"自动登陆中..":"登 陆"}}),mounted:function(){var t=this;void 0===this.userinfo.UserName?setTimeout(function(){t.autoLogin()},500):this.$router.replace("/pos")},methods:o()({},Object(p.c)({updateUserLogin:"SET_USER"}),{login:function(){this.logining=!0,this.autoLogin()},autoLogin:function(){var t=this;K(X,{action:"InitCurrent",timestamp:(new Date).getTime()}).then(function(){var e=Q()(Y.a.mark(function e(a){return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=a.errcode){e.next=7;break}return e.next=3,i=a.data.StoreID,K(X,{action:"IsAllowStore",storeid:i});case 3:e.sent.data,t.updateUserLogin(a.data),t.$message({message:"登陆成功！",type:"success",duration:1e3,onClose:function(){t.$router.replace("/pos")}}),e.next=8;break;case 7:t.$confirm("自动登陆失败！"+a.errmsg,"提示",{type:"error",showCancelButton:!1}).then(function(){t.logining=!1}).catch(function(e){t.logining=!1});case 8:case"end":return e.stop()}var i},e,t)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){t.$confirm("自动登陆失败！！"+e,"提示",{type:"error",showCancelButton:!1}).then(function(){t.logining=!1}).catch(function(e){t.logining=!1})})},_checkUser:function(t){return["18857","1906","16723","17491","1522","249"].indexOf(t)>-1}})},_e={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"login_wrapper"},[e("div",{staticClass:"login_form"},[e("div",{staticClass:"headimg"}),this._v(" "),e("h2",{staticClass:"title"},[this._v("利郎POS收银系统")]),this._v(" "),this._m(0),this._v(" "),this._m(1),this._v(" "),e("button",{staticClass:"btn_login",class:{logining:this.logining},attrs:{loading:this.logining,disabled:this.logining},on:{click:this.login}},[e("i",{directives:[{name:"show",rawName:"v-show",value:this.logining,expression:"logining"}],staticClass:"el-icon-loading"}),this._v(" "),e("span",[this._v(this._s(this.btnText))])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"form_item"},[e("input",{attrs:{type:"text",placeholder:"请输入用户名.."}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"form_item"},[e("input",{attrs:{type:"password",placeholder:"请输入密码.."}})])}]};var be=a("VU/8")(ye,_e,!1,function(t){a("8mt4")},"data-v-a3d60c32",null).exports,we={data:function(){return{tableData:[{sphh:"1QBH00101",sh:"111",spmc:"黑色上衣",dw:"件",gg:"165",lsdj:"1000",zk:"10",ssj:"1000",sl:"2",je:"2000",yyy:"张三",bz:""},{sphh:"2QBL00101",sh:"10",spmc:"红色T恤",dw:"双",gg:"72",lsdj:"900",zk:"10",ssj:"900",sl:"1",je:"900",yyy:"张三",bz:""},{sphh:"2QBL00201",sh:"12",spmc:"红色帽子",dw:"双",gg:"74",lsdj:"800",zk:"10",ssj:"800",sl:"1",je:"800",yyy:"李四",bz:""}]}},methods:{changeData:function(){var t=this;ut().then(function(e){var a=[];t.handleData(e.data).forEach(function(t){t[0].rowSpan=t.length,a=a.concat(t)}),t.tableData=a})},handleData:function(t){for(var e=[],a=[],i="",s="",n=[],o=0;o<t.length;o++){var l=t[o];Number(l.zbid)>0?(i!=l.zbid&&(a=[],e.push(a),i=l.zbid,s=this.getColor()),l.bgColor=s,a.push(l)):n.push(l)}return e.push(n),console.log(e),e},rowStyle:function(t){if(t.row.bgColor&&""!=t.row.bgColor)return{backgroundColor:t.row.bgColor,color:"#fff"}},objectSpanMethod:function(t){var e=t.row;t.column,t.rowIndex;if(12===t.columnIndex)return e.rowSpan&&Number(e.rowSpan)>0?{rowspan:e.rowSpan,colspan:1}:{rowspan:0,colspan:0}},getColor:function(){for(var t="0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f".split(","),e="#",a=0;a<6;a++)e+=t[Math.floor(16*Math.random())];return e}}},Ce={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tabledemo_container"},[e("el-table",{attrs:{data:this.tableData,height:"320",border:"","row-style":this.rowStyle,"span-method":this.objectSpanMethod}},[e("el-table-column",{attrs:{type:"index",label:"序号",width:"50","class-name":"order"}}),this._v(" "),e("el-table-column",{attrs:{prop:"sphh",label:"货号",width:"120"}}),this._v(" "),e("el-table-column",{attrs:{prop:"sh",label:"色号",width:"50"}}),this._v(" "),e("el-table-column",{attrs:{prop:"spmc",label:"名称",width:"160","class-name":"spmc"}}),this._v(" "),e("el-table-column",{attrs:{prop:"dw",label:"单位",width:"50"}}),this._v(" "),e("el-table-column",{attrs:{prop:"gg",label:"规格",width:"60"}}),this._v(" "),e("el-table-column",{attrs:{prop:"lsdj",label:"零售价",width:"80"}}),this._v(" "),e("el-table-column",{attrs:{prop:"zk",label:"折扣",width:"80","class-name":"zk"}}),this._v(" "),e("el-table-column",{attrs:{prop:"ssj",label:"实售价",width:"80","class-name":"ssj"}}),this._v(" "),e("el-table-column",{attrs:{prop:"sl",label:"数量",width:"60"}}),this._v(" "),e("el-table-column",{attrs:{prop:"je",label:"金额",width:"100"}}),this._v(" "),e("el-table-column",{attrs:{prop:"yyy",label:"营业员",width:"80","class-name":"yyy"}}),this._v(" "),e("el-table-column",{attrs:{prop:"policieName",label:"备注",width:"200"}})],1),this._v(" "),e("el-button",{on:{click:this.changeData}},[this._v("change")]),this._v(" "),this._m(0)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("p",{staticStyle:{color:"#1AAD16","line-height":"2"}},[this._v("V0.2.0 更新日志")]),this._v(" "),e("ul",{staticStyle:{"padding-left":"15px","line-height":"1.6"}},[e("li",[this._v("1.更新日志一")]),this._v(" "),e("li",[this._v("1.更新日志一")]),this._v(" "),e("li",[this._v("1.更新日志一")]),this._v(" "),e("li",[this._v("1.更新日志一")]),this._v(" "),e("li",[this._v("1.更新日志一")]),this._v(" "),e("li",[this._v("1.更新日志一")]),this._v(" "),e("li",[this._v("1.更新日志一")]),this._v(" "),e("li",[this._v("1.更新日志一")]),this._v(" "),e("li",[this._v("1.更新日志一")])])])}]};var ke=a("VU/8")(we,Ce,!1,function(t){a("T5bl")},null,null).exports;s.default.use(U.a);var xe=new U.a({routes:[{path:"/",redirect:"/login"},{path:"/pos",name:"POS",component:ge},{path:"/login",name:"login",component:be},{path:"/td",component:ke}]});xe.beforeEach(function(t,e,a){var i=F.state.user.UserName;"login"!=t.name&&void 0===i?a({path:"/login",replace:!0}):a()});var De=xe,Pe=a("zL8q"),Ie=a.n(Pe);a("tvR6"),a("MqRL");s.default.config.productionTip=!1,s.default.use(Ie.a),new s.default({el:"#app",router:De,store:F,template:"<App/>",components:{App:P}})},OYaJ:function(t,e){},Q3rI:function(t,e){},T5bl:function(t,e){},Tlhn:function(t,e){},"YWp+":function(t,e){},ZBJ4:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAMAAAAKE/YAAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTE1MkMxNTc3MUEzMTFFNzlERUZERjEzMUExMTczMkEiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QTE1MkMxNTg3MUEzMTFFNzlERUZERjEzMUExMTczMkEiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBMTUyQzE1NTcxQTMxMUU3OURFRkRGMTMxQTExNzMyQSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBMTUyQzE1NjcxQTMxMUU3OURFRkRGMTMxQTExNzMyQSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnOZ9hQAAAAGUExURf///////1V89WwAAAACdFJOU/8A5bcwSgAAALpJREFUeNrs2bEJADAIAEGz/9JZwaBghPva4joR4ywsoKGhoaGhoaGhoaGhoaGhoaGhoaGhoaF70JEpP5kNGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaeg+68q2ChoaGhoYuoLduRGhoaGhoaGhoaGho6An0G3sCXb1ioaGhoaGh+x9t0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0BvQXwYNDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NnewKMABlqVQ0TkeAlgAAAABJRU5ErkJggg=="},bkFu:function(t,e){},c22h:function(t,e){},cP4q:function(t,e){},"cf3/":function(t,e){},dtRy:function(t,e){},eOv1:function(t,e){},gvjP:function(t,e){},iUKJ:function(t,e){},mUbh:function(t,e){},pkXS:function(t,e){},q3Bu:function(t,e){},rPKt:function(t,e){},tN9n:function(t,e){},tvR6:function(t,e){},"uS+u":function(t,e){},vZwz:function(t,e){},xqWK:function(t,e){}},["NHnr"]);