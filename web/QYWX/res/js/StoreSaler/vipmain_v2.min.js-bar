var tagShow=!1,tagsArr=[],currentUser="0",tagIsLoad=!1,pageLoaded=!1,isFilter=!1,lastxh="0",interval,radarChart,lbChart,xlChart,ysChart,CurrentSite="vip-list",pageSize=200,pageNo=1,allPageNo=0,filterObj={mons:"",bdays:"",splb:"",cname:"",lable:"",lableid:[]};$(function(){GetVIPList();"1"==RoleID&&$(".filterbtn[filter]").hide()});$(".search_tag_title").click(function(){var a=$("#searchTagPage");a.hasClass("page-top")?a.removeClass("page-top"):a.addClass("page-top")});function SearchFunc(){"1"==$(".mysort").attr("isshow")&&($(".mysort").attr("isshow","0"),$(".mysort").addClass("page-top"),$("#mask2").hide());var a=$("#filter-page"),b=a.find(".sortul[data-type\x3d'consume'] li.checked").attr("data-dm"),b=void 0===b?"":b,c=a.find(".sortul[data-type\x3d'birthday'] li.checked").attr("data-dm"),c=void 0===c?"":c,a=a.find(".sortul[data-type\x3d'goodClass'] li.checked").attr("data-dm"),a=void 0===a?"":a,d;d=encodeURIComponent($("#searchtxt").val().trim());for(var e=[],f=$("#searchTagPage .tagselected"),g=0;g<f.length;g++)e.push(f.eq(g).attr("tid"));0<e.length?$(".search_tag_title").addClass("active"):$(".search_tag_title").removeClass("active");f={mons:b,bdays:c,splb:a,cname:d,lable:"",lableid:e};console.log("\u4e0a\u4e00\u6b21\u641c\u7d22\u6761\u4ef6\uff1a"+JSON.stringify(filterObj));console.log("\u76ee\u524d\u641c\u7d22\u6761\u4ef6"+JSON.stringify(f));JSON.stringify(f)!=JSON.stringify(filterObj)?(filterObj.mons=b,filterObj.bdays=c,filterObj.splb=a,filterObj.cname=d,filterObj.lable="",filterObj.lableid=e,pageNo=1,allPageNo=0,GetVIPList()):showLoader("warn","\u641c\u7d22\u6761\u4ef6\u65e0\u53d8\u5316..")}$("#btn_searchTag").click(function(){SearchFunc();backFunc()});function LoadTagTemplate(){showLoader("loading","\u6b63\u5728\u52a0\u8f7d\u6807\u7b7e\u6a21\u677f...");$.ajax({url:"../../WebBLL/VIPListCore.aspx?ctrl\x3dGetTagTemplate",type:"POST",dataType:"text",timeout:3E4,error:function(a,b,c){showLoader("error","\u60a8\u7684\u7f51\u7edc\u597d\u50cf\u51fa\u4e86\u70b9\u95ee\u9898,\u8bf7\u7a0d\u540e\u91cd\u8bd5...")},success:function(a){-1<a.indexOf("Error")?showLoader("error","System Error:"+a):(a={list:JSON.parse(a).rows},a=_.template($("#tagtemplate").html())(a),$("#subtags").before(a),a=$("#tags-page .tagcontent").clone(),a.find(".tagitem:last-child").remove(),$("#btn_searchTag").before(a),$(".tagitemul li").click(function(a){a=$(a.target);a.hasClass("tagselected")?a.removeClass("tagselected"):(a.parent().children().removeClass("tagselected"),a.addClass("tagselected"))}),tagIsLoad=!0,showLoader("successed","\u83b7\u53d6\u6210\u529f!"),loadGoodClass())}})}function GetVIPList(){showLoader("loading","\u6b63\u5728\u62c9\u53d6\u6570\u636e...");$.ajax({url:"../../webbll/VIPListCoreV1.aspx?ctrl\x3dgetVipList",type:"POST",dataType:"text",data:{mdid:mdid,salerid:AppSystemKey,role:RoleID,pageSize:pageSize,pageNo:pageNo,mons:filterObj.mons,bdays:filterObj.bdays,cname:filterObj.cname,lable:filterObj.lable,splb:filterObj.splb,lableid:filterObj.lableid.join(",")},timeout:3E4,error:function(a,b,c){showLoader("error","\u60a8\u7684\u7f51\u7edc\u597d\u50cf\u51fa\u4e86\u70b9\u95ee\u9898,\u8bf7\u7a0d\u540e\u91cd\u8bd5...")},success:function(a){if(-1<a.indexOf("Error:"))showLoader("error",a);else if(""==a)showLoader("successed","\u83b7\u53d6\u6210\u529f\uff01"),$("#loadmore_btn").text("\u65e0\u66f4\u591a\u6570\u636e...");else{a=a.replace("Successed","");a=JSON.parse(a);var b={list:a.rows};$("#vipall").text(a.totalRows);b=_.template($("#userlist").html())(b);$(".vipul").empty().html(b);$("#vip_wrap").scrollTop(0);$("#vip_wrap").unbind("scroll");$("#vipdiv .userimg.lazy").lazyload({threshold:10,container:$("#vip_wrap")});tagIsLoad?showLoader("successed","\u83b7\u53d6\u6210\u529f\uff01"):LoadTagTemplate();"1"==pageNo&&(allPageNo=0<a.totalRows%pageSize?parseInt(a.totalRows/pageSize)+1:a.totalRows/pageSize,$("#allPageNo").text(allPageNo),$("#currentPageNo").text(pageNo));selectedUsers=0;$("#select_count").text(selectedUsers)}}})}function LatestConsume(){$(".consumebtn i").hasClass("fa-pulse")||($(".consumebtn").html("\x3ci class\x3d'fa fa-rotate-right fa-pulse'\x3e\x3c/i\x3e"),$.ajax({url:"../../WebBLL/VIPListCore.aspx?ctrl\x3dLatestConsume",type:"POST",dataType:"text",data:{ukh:$("#vipdiv li[vipid\x3d"+currentUser+"]").attr("vipkh")},timeout:3E4,error:function(a,b,c){showLoader("error","\u60a8\u7684\u7f51\u7edc\u597d\u50cf\u51fa\u4e86\u70b9\u95ee\u9898,\u8bf7\u7a0d\u540e\u91cd\u8bd5...");$(".consumebtn").html("\x3ci class\x3d'fa fa-rotate-right'\x3e\x3c/i\x3e")},success:function(a){-1<a.indexOf("Error")?showLoader("error","System Error:"+a):""==a?$("#noconsume").show():(a={list:JSON.parse(a).rows},a=_.template($("#latestcontemp").html())(a),$("#latestconsumeul").children().remove(),$("#latestconsumeul").append(a),showLoader("successed","\u52a0\u8f7d\u6210\u529f!"));$(".consumebtn").html("\x3ci class\x3d'fa fa-rotate-right'\x3e\x3c/i\x3e")}}))}function getConsumeDetail(a){showLoader("loading","\u6b63\u5728\u67e5\u8be2...");$.ajax({url:"../../WebBLL/VIPListCore.aspx?ctrl\x3dConsumeDetail",type:"POST",dataType:"text",data:{djid:$(a).attr("djid")},timeout:3E4,error:function(a,c,d){showLoader("error","\u60a8\u7684\u7f51\u7edc\u597d\u50cf\u51fa\u4e86\u70b9\u95ee\u9898,\u8bf7\u7a0d\u540e\u91cd\u8bd5...")},success:function(b){-1<b.indexOf("Error")?showLoader("error","System Error:"+b):""==b?showLoader("warn","\u6b64\u5355\u636e\u65e0\u8bb0\u5f55!"):(b={list:JSON.parse(b).rows},b=_.template($("#cdetailtemp").html())(b),$("#cdetaillist").children().remove(),$("#cdetaillist").append(b),$("#cd_djh").text($(a).attr("djh")),$("#cd_djsj").text($(a).find(".djsj").text()),showLoader("successed","\u52a0\u8f7d\u6210\u529f!"),$(".tags").hide(),$("#consumedetail").removeClass("page-right"),CurrentSite="consume-detail")}})}$("#subtags").click(function(){var a=$("#tags-page .tagselected"),b={},b=[],c=encodeURI($("#tagdefine").val());if(0==a.length&&""==c)b={uid:currentUser,data:"",remark:"",type:"delete"};else if(0!=a.length){for(var d=0;d<a.length;d++)b.push(a.eq(d).attr("tid"));b={uid:currentUser,data:b,remark:c,type:"update"}}else b={uid:currentUser,data:"",remark:c,type:"update"};showLoader("loading","\u6b63\u5728\u63d0\u4ea4\u6570\u636e...");$.ajax({url:"../../WebBLL/VIPListCore.aspx?ctrl\x3dUpUserTags",type:"POST",dataType:"text",data:{tags:JSON.stringify(b)},timeout:3E4,error:function(a,b,c){showLoader("error","\u60a8\u7684\u7f51\u7edc\u597d\u50cf\u51fa\u4e86\u70b9\u95ee\u9898,\u8bf7\u7a0d\u540e\u91cd\u8bd5...")},success:function(a){-1<a.indexOf("Error:")?showLoader("error","System Error:"+a):(showLoader("successed","\u63d0\u4ea4\u6210\u529f!"),$("#tags-page").addClass("page-top"),$(".tags").text("\u6253\u6807\u7b7e"),tagShow=!1,putTags())}})});$("#vipdiv").on("click","li",function(a){userinfo(this)});function userinfo(a){var b=$(a).attr("vtype");if("WX"==b)b=_.template($("#guideTemp").html()),$("#NewGuide").html(b()),$("#NewGuide .userinfo .headimg").css("background-image",$(".userimg",a).css("background-image")),$("#NewGuide .userinfo .username").text($("h3",a).text()),$("#NewGuide").attr("bid",$(a).attr("bid")),$("#NewGuide .confirm-btn").click(function(a){a=$(a.target).attr("val");"bind"==a?(a=_.template($("#bindTemp").html()),$("#bindWX").html(a()),$("#NewGuide").addClass("page-left"),$("#bindWX").removeClass("page-right"),CurrentSite="bind-vip"):"register"==a&&(a=_.template($("#regTemp").html()),$("#registerVIP").html(a()),$("#NewGuide").addClass("page-left"),$("#registerVIP").removeClass("page-right"),CurrentSite="register-vip")}),$("#NewGuide").removeClass("page-right"),CurrentSite="new-guide",$(".sorts").hide();else if("VIP-WX"==b||"VIP"==b)showLoader("loading","\u6b63\u5728\u8bfb\u53d6\u7528\u6237\u4fe1\u606f..."),currentUser=$(a).attr("vipid"),$.ajax({url:"../../WebBLL/VIPListCore.aspx?ctrl\x3dGetUserInfo",type:"POST",dataType:"text",data:{uid:$(a).attr("vipid"),ukh:$(a).attr("vipkh")},timeout:3E4,error:function(a,b,e){showLoader("error","\u60a8\u7684\u7f51\u7edc\u597d\u50cf\u51fa\u4e86\u70b9\u95ee\u9898,\u8bf7\u7a0d\u540e\u91cd\u8bd5...")},success:function(b){if(-1<b.indexOf("Error"))showLoader("error",b);else{b={data:JSON.parse(b)};var c=_.template($("#userview").html());$("#info-page").html(c(b));$(".mask").hide();$("#to-top").hide();$(".filterbtn[filter]").hide();$("#page-main").addClass("page-left");$("#info-page").removeClass("page-right");$(".backbtn").fadeIn(200);$(".sorts").fadeOut(200);$(".tags").fadeIn(200);$(".userinfo .headimg").css("background-image",$(a).find(".userimg").css("background-image"));pageLoaded=!1;CurrentSite="vip-detail";$(".morebtn").unbind("click").click(function(){"none"==$(".moreinfo").css("display")?($(".moreinfo").show(),$(".morebtn i").addClass("iconup")):($(".moreinfo").hide(),$(".morebtn i").removeClass("iconup"))});GetUserTags()}}})}function GetUserTags(){pageLoaded||$.ajax({url:"../../WebBLL/VIPListCore.aspx?ctrl\x3dGetUserTags",type:"POST",dataType:"text",data:{uid:currentUser},timeout:3E4,error:function(a,b,c){showLoader("error","\u60a8\u7684\u7f51\u7edc\u597d\u50cf\u51fa\u4e86\u70b9\u95ee\u9898,\u8bf7\u7a0d\u540e\u91cd\u8bd5...")},success:function(a){if(-1<a.indexOf("Error"))showLoader("error","System Error:"+a);else{tagsArr=a.split("||")[0].split(",");$("#tags-page .tagselected").removeClass("tagselected");for(var b=0;b<tagsArr.length-1;b++)$("#tags-page .tagitemul li[tid\x3d'"+tagsArr[b]+"']").addClass("tagselected");a=a.split("||")[1];$("#tagdefine").val(decodeURI(a));putTags();UserConsume()}}})}function BarCharts(a){pageLoaded||(showLoadingText("#l2title"," \u6b63\u5728\u7edf\u8ba1\uff0c\u8bf7\u7a0d\u5019"),$.ajax({url:"../../WebBLL/VIPListCore.aspx?ctrl\x3dGetChartDatas",type:"POST",dataType:"text",data:{uid:currentUser,type:a,ukh:$("#vipdiv li[vipid\x3d"+currentUser+"]").attr("vipkh")},timeout:3E4,error:function(a,c,d){showLoader("error","\u60a8\u7684\u7f51\u7edc\u597d\u50cf\u51fa\u4e86\u70b9\u95ee\u9898,\u8bf7\u7a0d\u540e\u91cd\u8bd5...")},success:function(b){if(-1<b.indexOf("Error"))showLoader("error","System Error:"+b);else if(-1<b.indexOf("Warn:"))showLoader("successed",b.replace("Warn:","")),hideLoading();else if(""==b)showLoader("error","System Error:"+b);else if(b=JSON.parse(b),0<b.rows.length){for(var c=[],d=[],e=0;e<b.rows.length;e++){var f=b.rows[e];c.push(f.label);d.push(f.sl)}$("#"+a).before("\x3cdiv style\x3d'margin:10px auto 0 auto;width:300px;'\x3e\x3ccanvas id\x3dchart-"+a+"\x3e\x3c/canvas\x3e\x3c/div\x3e");switch(a){case "lb":void 0!=lbChart&&lbChart.destroy();b={labels:c,datasets:[{fillColor:"#e1987b",strokeColor:"rgba(220,220,220,1)",data:d}]};lbChart=(new Chart(document.getElementById("chart-"+a).getContext("2d"))).Bar(b);BarCharts("ys");break;case "ys":void 0!=ysChart&&ysChart.destroy();b={labels:c,datasets:[{fillColor:"#ee5257",strokeColor:"rgba(220,220,220,1)",data:d}]};ysChart=(new Chart(document.getElementById("chart-"+a).getContext("2d"))).Bar(b);hideLoading();pageLoaded=!0;break;case "xl":void 0!=xlChart&&xlChart.destroy(),b={labels:c,datasets:[{fillColor:"#785f62",strokeColor:"rgba(220,220,220,1)",data:d}]},xlChart=(new Chart(document.getElementById("chart-"+a).getContext("2d"))).Bar(b)}}}}))}function drawCharts(a,b){pageLoaded||(void 0!=radarChart&&radarChart.destroy(),radarChart=(new Chart(document.getElementById("radar-chart").getContext("2d"))).Radar(a,b),BarCharts("lb"))}function UserConsume(){pageLoaded||(showLoadingText("#contitle"," \u6b63\u5728\u7edf\u8ba1\uff0c\u8bf7\u7a0d\u5019"),$.ajax({url:"../../WebBLL/VIPListCore.aspx?ctrl\x3dGetVIPBehavior",type:"POST",dataType:"text",data:{uid:currentUser,ukh:$("#vipdiv li[vipid\x3d"+currentUser+"]").attr("vipkh")},timeout:3E4,error:function(a,b,c){showLoader("error","\u60a8\u7684\u7f51\u7edc\u597d\u50cf\u51fa\u4e86\u70b9\u95ee\u9898,\u8bf7\u91cd\u8bd5...");hideLoading()},success:function(a){if(-1<a.indexOf("Error"))showLoader("error","System Error:"+a);else if(-1<a.indexOf("Warn:"))showLoader("successed",a.replace("Warn:","")),$(".chart-title").hide(),hideLoading();else{a=a.split("|");var b={gmcs:a[0],pjdj:parseFloat(a[1]).toFixed(2),pjdl:parseFloat(a[2]).toFixed(2),pjzks:parseFloat(a[3]).toFixed(1),pl:a[4],fg:a[5],ys:a[6],xfje:a[7],lastje:a[8],lastsj:a[9],dists:a[10]+"\u5929"},c=_.template($("#userconsume").html());$("#info-page .usernav .title").eq(0).after(c(b));var b=parseInt(a[7])/parseInt(a[0]),b=599>=b?5:5999<=b?95:parseInt(9*(b-599)/540)+5,c=parseInt(a[1]),c=199>=c?5:1999<=c?95:parseInt(9*(c-199)/180)+5,d=parseInt(a[2]),d=1>=d?5:5<=d?95:parseInt(90*(d-1)/4)+5,e=parseFloat(a[3]).toFixed(1),e=5.9>=e?5:10<=e?95:parseInt(90*(e-5.9)/4)+5,f=parseInt(a[10]),f=30>=f?95:120<=f?5:parseInt(95-(f-30));a={labels:["\u5ba2\u5355\u4ef7 "+parseInt(parseInt(a[7])/parseInt(a[0]))+"\u5143","\u5e73\u5747\u5355\u4ef7 "+parseInt(a[1])+"\u5143","\u5ba2\u5355\u91cf "+parseInt(a[2])+"\u4ef6","\u5e73\u5747\u6298\u6263 "+parseFloat(a[3]).toFixed(1)+"\u6298","\u6700\u540e\u6d88\u8d39 "+a[10]+"\u5929"],datasets:[{fillColor:"rgba(217,83,79,0.6)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(153,153,153,1)",pointStrokeColor:"#fff",data:[b,c,d,e,f]}]};drawCharts(a,{pointDot:!1,scaleOverride:!0,scaleSteps:10,scaleStepWidth:10,scaleStartValue:1})}}}))}function showLoader(a,b){switch(a){case "loading":$(".mask .fa").removeAttr("class").addClass("fa fa-2x fa-spinner fa-pulse");$("#loadtext").html(b);$(".mask").show();break;case "successed":$(".mask .fa").removeAttr("class").addClass("fa fa-2x fa-check");$("#loadtext").text(b);$(".mask").show();setTimeout(function(){$(".mask").fadeOut(200)},1E3);break;case "error":$(".mask .fa").removeAttr("class").addClass("fa fa-2x fa-close (alias)");$("#loadtext").text(b);$(".mask").show();setTimeout(function(){$(".mask").fadeOut(400)},1500);break;case "warn":$(".mask .fa").removeAttr("class").addClass("fa fa-2x fa-warning (alias)"),$("#loadtext").text(b),$(".mask").show(),setTimeout(function(){$(".mask").fadeOut(400)},800)}}var showMesssage={loading:function(a){$(".mask .fa").removeAttr("class").addClass("fa fa-2x fa-spinner fa-pulse");$("#loadtext").text(a);$(".mask").show()},successed:function(a){$(".mask .fa").removeAttr("class").addClass("fa fa-2x fa-check");$("#loadtext").text(a);$(".mask").show();setTimeout(function(a){$(".mask").fadeOut(200)},500)},error:function(a){$(".mask .fa").removeAttr("class").addClass("fa fa-2x fa-close (alias)");$("#loadtext").text(a);$(".mask").show();setTimeout(function(a){$(".mask").fadeOut(400)},2E3)},warn:function(a){$(".mask .fa").removeAttr("class").addClass("fa fa-2x fa-warning (alias)");$("#loadtext").text(a);$(".mask").show();setTimeout(function(a){$(".mask").fadeOut(400)},800)}};function backFunc(){switch(CurrentSite){case "consume-detail":$("#consumedetail").addClass("page-right");$(".tags").show();CurrentSite="vip-detail";break;case "vip-detail":pageLoaded=!0;$("#info-page").addClass("page-right");$("#page-main").removeClass("page-left");$(".tags").hide();$(".attract_tools").removeClass("show");$(".tags").text("\u6253\u6807\u7b7e");tagShow=!1;$(".sorts").show();$("#to-top").show();CurrentSite="vip-list";break;case "new-guide":$("#NewGuide").addClass("page-right");$("#NewGuide").attr("bid","");$(".sorts").show();CurrentSite="vip-list";break;case "bind-vip":$("#bindWX").addClass("page-right");$("#NewGuide").removeClass("page-left");CurrentSite="new-guide";break;case "register-vip":$("#registerVIP").addClass("page-right");$("#NewGuide").removeClass("page-left");CurrentSite="new-guide";break;case "vip-list":"0"==$(".mysort").attr("isshow")&&$("#searchTagPage").hasClass("page-top")?llApp&&llApp.isInApp?llApp.closeWKView():window.history.go(-1):$("#searchTagPage").hasClass("page-top")||$("#searchTagPage").addClass("page-top");break;case "weixincard":$(".attract_tools").hasClass("show")&&$(".attract_tools").removeClass("show");$("#weixincard").addClass("page-right");CurrentSite="vip-list";break;case "goodlink":$(".attract_tools").hasClass("show")&&$(".attract_tools").removeClass("show"),$("#goodlink").addClass("page-right"),CurrentSite="vip-list"}"1"==$(".mysort").attr("isshow")&&($(".mysort").attr("isshow","0"),$(".mysort").addClass("page-top"),$("#mask2").hide());$("#tags-page").addClass("page-top")}$(".backbtn").click(backFunc);function switchTags(){tagShow?($("#tags-page").addClass("page-top"),$(".tags").text("\u6253\u6807\u7b7e"),tagShow=!1):($("#tags-page").removeClass("page-top"),$(".tags").text("\u5173\u95ed"),tagShow=!0)}function switchSF(a,b){$("#filter-btn a").removeClass("fchecked");"sort"==a?($(".filter-item").hide(),$(".sort-item").show(),$(b).addClass("fchecked")):"filter"==a&&($(".sort-item").hide(),$(".filter-item").show(),$(b).addClass("fchecked"))}function switchMenu(a){switch(a){case 0:window.location.href="chatlist.aspx";break;case 1:window.location.href="#";break;case 3:window.location.href="usercenter.aspx";break;default:showLoader("warn","\u5373\u5c06\u63a8\u51fa,\u656c\u8bf7\u671f\u5f85!")}}$.expr[":"].Contains=function(a,b,c){return 0<=(a.textContent||a.innerText||"").toUpperCase().indexOf(c[3].toUpperCase())};function localSearch(){if(!$(".search_tag_title").hasClass("active")&&0<$("#vipdiv li h3").length){var a=$("#searchtxt").val();a?($matches=$("#vipdiv li").find("h3:Contains("+a+")").parent(),$("li",$("#vipdiv")).not($matches).hide(),$matches.show()):$("#vipdiv").find("li").show()}}function mysort(){"0"==$(".mysort").attr("isshow")?($(".mysort").attr("isshow","1"),$(".mysort").removeClass("page-top"),$("#mask2").show()):($(".mysort").attr("isshow","0"),$(".mysort").addClass("page-top"),$("#mask2").hide())}$.fn.fadeInWithDelay=function(){var a=0;return this.each(function(){$(this).delay(a).animate({opacity:1},200);a+=100})};$("#to-top").click(function(){$("#vip_wrap").animate({scrollTop:0},400)});$("#mask2").click(function(){$(".mysort").attr("isshow","0");$(".mysort").addClass("page-top");$("#mask2").hide()});function unique(a){for(var b=[],c={},d=0,e;null!=(e=a[d]);d++)c[e]||(b.push(e),c[e]=!0);return b}function putTags(){$(".usertags").children().remove();var a=$("#tags-page .tagselected");if(0<a.length){for(var b=10<a.length?10:a.length,c=0;c<b;c++)0==c%2?$("#tag-left").append("\x3cp\x3e"+a.eq(c).text()+"\x3c/p\x3e"):$("#tag-right").append("\x3cp\x3e"+a.eq(c).text()+"\x3c/p\x3e");10<a.length&&$("#tag-right").append("\x3cp\x3e\u2026\x3c/p\x3e")}$(".usertags p").fadeInWithDelay()}function showLoadingText(a,b){null!=interval&&void 0!=interval&&(clearInterval(interval),$("#loadingtext").remove());var c="\x3cspan id\x3d'loadingtext'\x3e"+b+"\x3c/span\x3e";$(a).append(c);interval=window.setInterval(function(){var a=$("#loadingtext"),c=a.text();c.length<b.length+8?a.text(c+" . "):a.text(b)},400)}function hideLoading(){null!=interval&&void 0!=interval&&(clearInterval(interval),$("#loadingtext").fadeOut(800))}function sexSelect(a){$(".sex-group i").attr("class","fa fa-square-o");$("i",a).attr("class","fa fa-check-square-o")}function BindVIP(){var a=$("#bind-vipkh").val(),b=$("#NewGuide").attr("bid");"0"==b||""==b||void 0==b?showLoader("warn","BID\u53c2\u6570\u4e22\u5931,\u8bf7\u5c1d\u8bd5\u91cd\u65b0\u6253\u5f00!"):""==a?showLoader("warn","VIP\u5361\u53f7\u4e0d\u80fd\u4e3a\u7a7a!"):(showLoader("loaing","\u6b63\u5728\u5904\u7406,\u8bf7\u7a0d\u5019..."),$.ajax({url:"../../WebBLL/VIPListCore.aspx?ctrl\x3dBindVIP",type:"POST",dataType:"text",data:{jsonStr:JSON.stringify({mdid:mdid,salerid:AppSystemKey,bid:b,vipkh:a})},timeout:3E4,error:function(a,b,e){showLoader("error","\u60a8\u7684\u7f51\u7edc\u597d\u50cf\u51fa\u4e86\u70b9\u95ee\u9898,\u8bf7\u7a0d\u540e\u91cd\u8bd5...")},success:function(a){if(-1<a.indexOf("Successed")){a=a.replace("Successed","").split("|");var c=$(".vipul li[bid\x3d"+b+"]");c.attr("vipid",a[0]);c.attr("vipkh",a[1]);c.attr("vtype","VIP-WX");$($(".icon-group img",c)[1]).attr("src","../../res/img/storesaler/icon-vip-1.png");showLoader("successed","\u606d\u559c,\u7ed1\u5b9a\u6210\u529f!");setTimeout(function(){backFunc();backFunc()},500)}else showLoader("error",a.replace("Error:",""))}}))}function RegisterVIP(){var a=$("#reg-username").val(),b=$("#reg-birthday").val(),c=$("#reg-phone").val(),d=$(".sex-item .fa.fa-check-square-o").parent().attr("xb");if(""==a)showLoader("error","\u59d3\u540d\u4e0d\u80fd\u4e3a\u7a7a!");else if("0"!=d&&"1"!=d)showLoader("error","\u6027\u522b\u6709\u8bef!");else if(""==b)showLoader("error","\u751f\u65e5\u4e0d\u80fd\u4e3a\u7a7a!");else if(""==c)showLoader("error","\u624b\u673a\u53f7\u7801\u4e0d\u80fd\u4e3a\u7a7a!");else{showLoader("loading","\u6b63\u5728\u5904\u7406,\u8bf7\u7a0d\u5019...");var e=$("#NewGuide").attr("bid");$.ajax({url:"../../WebBLL/VIPListCore.aspx?ctrl\x3dRegisterVIP",type:"POST",dataType:"text",data:{jsonStr:JSON.stringify({khid:khid,mdid:mdid,salerid:AppSystemKey,bid:e,vipkh:c,name:a,xb:d,birthday:b,tel:c})},timeout:3E4,error:function(a,b,c){showLoader("error","\u60a8\u7684\u7f51\u7edc\u597d\u50cf\u51fa\u4e86\u70b9\u95ee\u9898,\u8bf7\u7a0d\u540e\u91cd\u8bd5...")},success:function(a){if(-1<a.indexOf("Successed")){a=a.replace("Successed","").split("|");var b=$(".vipul li[bid\x3d"+e+"]");b.attr("vipid",a[0]);b.attr("vipkh",a[1]);b.attr("vtype","VIP-WX");$($(".icon-group img",b)[1]).attr("src","../../res/img/storesaler/icon-vip-1.png");showLoader("successed","\u606d\u559c,\u6ce8\u518c\u6210\u529f!");setTimeout(function(){backFunc();backFunc()},500)}else showLoader("error",a.replace("Error:",""))}})}}function loadWXCards(){showLoader("loading","\u6b63\u5728\u52a0\u8f7d\u5361\u5238\u5217\u8868..");setTimeout(function(){$.ajax({url:"../../WebBLL/VIPListCoreV1.aspx?ctrl\x3dgetCardsList",type:"POST",dataType:"text",data:{mdid:mdid},timeout:3E4,error:function(a,b,c){showLoader("error","\u60a8\u7684\u7f51\u7edc\u597d\u50cf\u51fa\u4e86\u70b9\u95ee\u9898,\u8bf7\u7a0d\u540e\u91cd\u8bd5...")},success:function(a){if(-1<a.indexOf("Error"))showLoader("error","\u83b7\u53d6\u5361\u5238\u5931\u8d25:"+a.replace("Error:",""));else{a=JSON.parse(a).rows;for(var b="",c=0;c<a.length;c++)b+=template("tpl_wxcard",a[c]);$("#weixincard .card_wrap").empty().html(b);""==b&&$("#weixincard .noresult").show();$(".mask").hide()}}})},100)}function SearchGoods(){var a=$(".goodslink_search").val().trim();""==a?showLoader("warn","\u8bf7\u8f93\u5165\u5b8c\u6574\u7684\u5546\u54c1\u8d27\u53f7\uff01"):(showLoader("loading","\u6b63\u5728\u641c\u7d22.."),setTimeout(function(){$.ajax({url:"../../WebBLL/VIPListCoreV1.aspx?ctrl\x3dgetSphhInfo",type:"POST",dataType:"text",data:{sphh:a},timeout:3E4,error:function(a,c,d){showLoader("error","\u60a8\u7684\u7f51\u7edc\u597d\u50cf\u51fa\u4e86\u70b9\u95ee\u9898,\u8bf7\u7a0d\u540e\u91cd\u8bd5...")},success:function(a){console.log(a);if(-1<a.indexOf("Error:"))showLoader("error",a.replace("Error:","")),$("#goodlink .good_wrap").empty(),$("#goodlink .noresult").show();else{a=JSON.parse(a).rows;for(var b="",d=0;d<a.length;d++)a[d].picUrl=""==a[d].picUrl?"../../res/img/storesaler/lilanzlogo.jpg":a[d].picUrl,b+=template("tpl_gooditem",a[d]);$("#goodlink .good_wrap").empty().html(b);""==b&&$("#goodlink .noresult").show();$(".mask").hide()}}})},100))}$("#goodlink .good_wrap").on("click",".good_item",function(){var a=$(this).find(".good_spmc").text(),b=$(this).find(".good_sphh").text();""!=b&&confirm("\u786e\u8ba4\u5c06\u3010"+a+"|"+b+"\u3011\u53d1\u9001\u7ed9\u3010"+selectedUsers+"\u3011\u7528\u6237\uff1f\uff1f")&&(backFunc(),massSendLink(b,0))});function massSendLink(a,b){var c=$("#vipdiv .checked");if(!(0>=c.length)){showLoader("loading","\x3cp\x3e\u6b63\u5728\u53d1\u9001\u5546\u54c1\u94fe\u63a5\u4e2d..\x3c/p\x3e\x3cp\x3e"+(b+1)+" / "+c.length)+"\x3c/p\x3e";var d=c.eq(b).parent().find(".send_result");d.attr("class","send_result").text("\u6b63\u5728\u53d1\u9001\u5546\u54c1\u94fe\u63a5..");var e=c.eq(b).parent().attr("bid");setTimeout(function(){$.ajax({type:"POST",timeout:3E4,contentType:"application/x-www-form-urlencoded; charset\x3dutf-8",url:"../../WebBLL/VIPListCoreV1.aspx?ctrl\x3dsendSphhInfo",data:{sphh:a,bid:e,mdid:mdid,cid:customerID},success:function(c){-1<c.indexOf("Successed")?(c=(new Date(Date.now())).Format("yyyy-MM-dd HH:mm:ss"),d.attr("class","send_result success").text("\u53d1\u9001\u5546\u54c1\u94fe\u63a5\u6210\u529f\uff01"+c)):d.attr("class","send_result fail").text("\u53d1\u9001\u5546\u54c1\u94fe\u63a5\u5931\u8d25\uff01"+c.replace("Error:",""));b<$("#vipdiv .checked").length-1?massSendLink(a,b+1):($("#vipdiv .checkbox.checked").removeClass("checked"),selectedUsers=0,$("#select_count").text("0"),showLoader("successed","\u5168\u90e8\u53d1\u9001\u5b8c\u6bd5\uff0c\u53d1\u9001\u7ed3\u679c\u8bf7\u5728\u9875\u9762\u4e0a\u67e5\u770b\u3002"))},error:function(c,e,h){d.attr("class","send_result fail").text("\u7f51\u7edc\u51fa\u9519\uff01"+c.status+"|"+c.statusText);b<$("#vipdiv .checked").length-1?massSendLink(a,b+1):($("#vipdiv .checkbox.checked").removeClass("checked"),selectedUsers=0,$("#select_count").text("0"),showLoader("successed","\u5168\u90e8\u53d1\u9001\u5b8c\u6bd5\uff0c\u53d1\u9001\u7ed3\u679c\u8bf7\u5728\u9875\u9762\u4e0a\u67e5\u770b\u3002"))}})},50)}}$("#weixincard .card_wrap").on("click",".card_item",function(){var a=$(this).find(".card_name").text(),b=$(this).attr("data-id");""!=b&&"0"!=b&&void 0!==b&&confirm("\u786e\u8ba4\u5c06\u3010"+a+"\u3011\u53d1\u9001\u7ed9\u3010"+selectedUsers+"\u3011\u7528\u6237\uff1f\uff1f")&&(backFunc(),massSendCard(b,0))});function massSendCard(a,b){var c=$("#vipdiv .checked");if(!(0>=c.length)){showLoader("loading","\x3cp\x3e\u6b63\u5728\u53d1\u9001\u5fae\u4fe1\u5361\u5238\u4e2d..\x3c/p\x3e\x3cp\x3e"+(b+1)+" / "+c.length)+"\x3c/p\x3e";var d=c.eq(b).parent().find(".send_result");d.attr("class","send_result").text("\u6b63\u5728\u53d1\u9001\u5fae\u4fe1\u5361\u5238..");var e=c.eq(b).parent().attr("bid");setTimeout(function(){$.ajax({type:"POST",timeout:3E4,contentType:"application/x-www-form-urlencoded; charset\x3dutf-8",url:"../../WebBLL/VIPListCoreV1.aspx?ctrl\x3dsenCardToVIP",data:{bid:e,cardid:a},success:function(c){-1<c.indexOf("Successed")?(c=(new Date(Date.now())).Format("yyyy-MM-dd HH:mm:ss"),d.attr("class","send_result success").text("\u53d1\u9001\u5361\u5238\u6210\u529f\uff01"+c)):d.attr("class","send_result fail").text("\u53d1\u9001\u5361\u5238\u5931\u8d25\uff01"+c.replace("Error:",""));b<$("#vipdiv .checked").length-1?massSendCard(a,b+1):($("#vipdiv .checkbox.checked").removeClass("checked"),selectedUsers=0,$("#select_count").text("0"),showLoader("successed","\u5168\u90e8\u53d1\u9001\u5b8c\u6bd5\uff0c\u53d1\u9001\u7ed3\u679c\u8bf7\u5728\u9875\u9762\u4e0a\u67e5\u770b\u3002"))},error:function(c,e,h){d.attr("class","send_result fail").text("\u7f51\u7edc\u51fa\u9519\uff01"+c.status+"|"+c.statusText);b<$("#vipdiv .checked").length-1?massSendCard(a,b+1):($("#vipdiv .checkbox.checked").removeClass("checked"),selectedUsers=0,$("#select_count").text("0"),showLoader("successed","\u5168\u90e8\u53d1\u9001\u5b8c\u6bd5\uff0c\u53d1\u9001\u7ed3\u679c\u8bf7\u5728\u9875\u9762\u4e0a\u67e5\u770b\u3002"))}})},50)}}Date.prototype.Format=function(a){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},c=this.getFullYear()+"",c=4<=c.length?c:"0000".substr(0,4-c.length)+c;/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(c+"").substr(4-RegExp.$1.length)));for(var d in b)(new RegExp("("+d+")")).test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?b[d]:("00"+b[d]).substr((""+b[d]).length)));return a};function getPageData(a){"prev"==a?1<pageNo&&($("#currentPageNo").text(--pageNo),GetVIPList()):"next"==a&&pageNo<allPageNo&&($("#currentPageNo").text(++pageNo),GetVIPList())}$(".attract_tools .select_all").click(function(){$(this).hasClass("checked")?($("#vipdiv li .checkbox.checked").removeClass("checked"),selectedUsers=0,$("#select_count").text("0"),$(this).removeClass("checked")):100<$("#vipdiv li").length?showLoader("warn","\u4e3a\u4e86\u9632\u6b62\u5bf9\u987e\u5ba2\u9020\u6210\u9a9a\u6270\uff0c\u8bf7\u5148\u5c06\u5217\u8868\u7b5b\u9009\u5230100\u540d\u4ee5\u4e0b\uff01"):($("#vipdiv li .checkbox").addClass("checked"),selectedUsers=$("#vipdiv li").length,$("#select_count").text(selectedUsers),$(this).addClass("checked"))});function loadGoodClass(){$.ajax({url:"../../WebBLL/VIPListCoreV1.aspx?ctrl\x3dgetsplb",type:"POST",dataType:"text",timeout:3E4,error:function(a,b,c){showLoader("error","\u60a8\u7684\u7f51\u7edc\u597d\u50cf\u51fa\u4e86\u70b9\u95ee\u9898,\u8bf7\u7a0d\u540e\u91cd\u8bd5...")},success:function(a){if(-1<a.indexOf("Error:"))showLoader("error","\u52a0\u8f7d\u54c1\u7c7b\u51fa\u9519\uff01"+a.replace("Error:",""));else{var b="";a=JSON.parse(a).rows;for(var c=0;c<a.length;c++)b+=template("tpl_classitem",a[c]);$("#filter-page .sortul[data-type\x3d'goodClass']").empty().html(b)}}})};