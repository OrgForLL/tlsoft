【2016-10-10 8:18:50】  select sp.sphh,sp.spmc,sum(a.sl) ddsl into #zb
                            from yx_v_dddjmx a                            
                             inner join yx_t_spdmb sp on a.sphh=sp.sphh                                 
                            where a.tzid=1 and a.djlx=201 and a.djbs=1  and a.rq>=convert(datetime,@ksrq) and a.rq<dateadd(day,1,convert(datetime,@jsrq))
                            group by sp.sphh,sp.spmc order by sum(a.sl) desc;
                            --备货量与周转量
                            select distinct sphh into #sphh from #zb;
                            select a.sphh,isnull(a.tcl,0) tcl,c.bhl,isnull(a.tcl,0)-isnull(b.ddsl,0) zzl into #zzbh
                            from #sphh s
                            left join (
                              --统筹计划量
                              select a.sphh,sum(b.sl0) tcl 
                              from #sphh s inner join yx_t_tcjhb a on s.sphh=a.sphh
                              inner join yx_t_tcjhcmmx b on a.id=b.id
                              where a.tzid=1 and a.shbs=1 group by a.sphh
                            ) a on s.sphh=a.sphh
                              --订单数量
                            left join (
                              select a.sphh,sum(a.sl) ddsl  
                              from #sphh s inner join yx_v_dddjmx a on a.sphh=s.sphh
                              where a.djlx=201 and a.djbs=1 group by a.sphh
                            ) b on a.sphh=b.sphh
                            left join (
                              --备货库存
                              select a.sphh,sum(a.sl0-a.dbdf0-a.qtdf0) bhl 
                              from #sphh s inner join YX_T_Spkccmmx a on a.sphh=s.sphh
                              where a.tzid=1 and a.ckid not in (9325,6671,7013) group by a.sphh
                            ) c on a.sphh=c.sphh
                            
                            select a.*,b.zzl,b.bhl from #zb a left join #zzbh b on a.sphh=b.sphh

                            drop table #zb;drop table #sphh;drop table #zzbh;
{"lx":"sphh","khid":"","mdid":"","sphh":"","lbid":"","kfbh":"all","ksrq":"2016-10-01","jsrq":"2016-10-10","khlb":"","roleid":"3","curkhid":"","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:18:51】  订单数据查询结束！server='192.168.35.10';database=tlsoft;uid=ABEASD14AD;pwd=+AuDkDew
【2016-10-10 8:18:51】  select a.sphh,sp.spmc,sum(a.djlb/abs(a.djlb)*sl) xssl
                         from zmd_v_lsdjmx a
                          inner join yx_t_spdmb sp on a.sphh=sp.sphh 
                         where a.djlb in (1,-1,2,-2) and a.djbs=1  and a.rq>=convert(datetime,@ksrq) and a.rq<convert(datetime,@jsrq) and sp.kfbh=@kfbh
                         group by a.sphh,sp.spmc
{"lx":"sphh","khid":"","mdid":"","sphh":"","lbid":"","kfbh":"all","ksrq":"2016-10-01","jsrq":"2016-10-10","khlb":"","roleid":"3","curkhid":"","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:18:52】  销售数据查询结束！
【2016-10-10 8:18:52】  @ksrq=2016-10-01
【2016-10-10 8:18:52】  @jsrq=2016-10-10
【2016-10-10 8:18:52】  @kfbh=all
【2016-10-10 8:18:52】  dt_dd-rows:777 dt_ls-rows:0
【2016-10-10 8:21:49】   select sp.sphh,sp.spmc,'' zzl,'' bhl,sum(a.sl) ddsl
                            from yx_v_dddjmx a                                                            
                             inner join yx_t_spdmb sp on a.sphh=sp.sphh                                 
                            where a.djlx=201 and a.djbs=1  and a.rq>=convert(datetime,@ksrq) and a.rq<dateadd(day,1,convert(datetime,@jsrq)) and a.khid=@mdkhid
                            group by sp.sphh,sp.spmc order by sum(a.sl) desc
{"lx":"sphh","khid":"17832","mdid":"18090","sphh":"","lbid":"","kfbh":"all","ksrq":"2016-10-01","jsrq":"2016-10-10","khlb":"","roleid":"4","curkhid":"17832","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:21:49】  订单数据查询结束！server='192.168.35.11';database=FXDB;uid=ABEASD14AD;pwd=+AuDkDew
【2016-10-10 8:21:49】  select a.sphh,sp.spmc,sum(a.djlb/abs(a.djlb)*sl) xssl
                         from zmd_v_lsdjmx a
                          inner join t_mdb md on a.mdid=md.mdid and md.ty=0  inner join yx_t_khb kh on md.khid=kh.khid and kh.ty=0  inner join yx_t_spdmb sp on a.sphh=sp.sphh 
                         where a.djlb in (1,-1,2,-2) and a.djbs=1  and kh.ccid+'-' like @khid and a.rq>=convert(datetime,@ksrq) and a.rq<convert(datetime,@jsrq) and a.khid=@mdkhid and sp.kfbh=@kfbh
                         group by a.sphh,sp.spmc
{"lx":"sphh","khid":"17832","mdid":"18090","sphh":"","lbid":"","kfbh":"all","ksrq":"2016-10-01","jsrq":"2016-10-10","khlb":"","roleid":"4","curkhid":"17832","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:21:50】  销售数据查询结束！
【2016-10-10 8:21:50】  @khid=-1-17832-%
【2016-10-10 8:21:50】  @ksrq=2016-10-01
【2016-10-10 8:21:50】  @jsrq=2016-10-10
【2016-10-10 8:21:50】  @mdkhid=18090
【2016-10-10 8:21:50】  @kfbh=all
【2016-10-10 8:21:50】  dt_dd-rows:0 dt_ls-rows:0
【2016-10-10 8:21:57】   select sp.sphh,sp.spmc,'' zzl,'' bhl,sum(a.sl) ddsl
                            from yx_v_dddjmx a                                                            
                             inner join yx_t_spdmb sp on a.sphh=sp.sphh                                 
                            where a.djlx=201 and a.djbs=1  and a.rq>=convert(datetime,@ksrq) and a.rq<dateadd(day,1,convert(datetime,@jsrq)) and a.khid=@mdkhid
                            group by sp.sphh,sp.spmc order by sum(a.sl) desc
{"lx":"sphh","khid":"17832","mdid":"18090","sphh":"","lbid":"","kfbh":"all","ksrq":"2016-10-01","jsrq":"2016-10-10","khlb":"","roleid":"4","curkhid":"17832","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:21:57】  订单数据查询结束！server='192.168.35.11';database=FXDB;uid=ABEASD14AD;pwd=+AuDkDew
【2016-10-10 8:21:57】  select a.sphh,sp.spmc,sum(a.djlb/abs(a.djlb)*sl) xssl
                         from zmd_v_lsdjmx a
                          inner join t_mdb md on a.mdid=md.mdid and md.ty=0  inner join yx_t_khb kh on md.khid=kh.khid and kh.ty=0  inner join yx_t_spdmb sp on a.sphh=sp.sphh 
                         where a.djlb in (1,-1,2,-2) and a.djbs=1  and kh.ccid+'-' like @khid and a.rq>=convert(datetime,@ksrq) and a.rq<convert(datetime,@jsrq) and a.khid=@mdkhid and sp.kfbh=@kfbh
                         group by a.sphh,sp.spmc
{"lx":"sphh","khid":"17832","mdid":"18090","sphh":"","lbid":"","kfbh":"all","ksrq":"2016-10-01","jsrq":"2016-10-10","khlb":"","roleid":"4","curkhid":"17832","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:21:58】  销售数据查询结束！
【2016-10-10 8:21:58】  @khid=-1-17832-%
【2016-10-10 8:21:58】  @ksrq=2016-10-01
【2016-10-10 8:21:58】  @jsrq=2016-10-10
【2016-10-10 8:21:58】  @mdkhid=18090
【2016-10-10 8:21:58】  @kfbh=all
【2016-10-10 8:21:58】  dt_dd-rows:0 dt_ls-rows:0
【2016-10-10 8:22:03】   select sp.sphh,sp.spmc,'' zzl,'' bhl,sum(a.sl) ddsl
                            from yx_v_dddjmx a                                                            
                             inner join yx_t_spdmb sp on a.sphh=sp.sphh                                 
                            where a.djlx=201 and a.djbs=1  and a.tzid=1 and a.khid=@khid
                            group by sp.sphh,sp.spmc order by sum(a.sl) desc
{"lx":"sphh","khid":"249","mdid":"","sphh":"","lbid":"","kfbh":"all","ksrq":"","jsrq":"","khlb":"","roleid":"4","curkhid":"249","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:22:03】  订单数据查询结束！server='192.168.35.10';database=tlsoft;uid=ABEASD14AD;pwd=+AuDkDew
【2016-10-10 8:22:03】  select a.sphh,sp.spmc,sum(a.djlb/abs(a.djlb)*sl) xssl
                         from zmd_v_lsdjmx a
                          inner join t_mdb md on a.mdid=md.mdid and md.ty=0  inner join yx_t_khb kh on md.khid=kh.khid and kh.ty=0  inner join yx_t_spdmb sp on a.sphh=sp.sphh 
                         where a.djlb in (1,-1,2,-2) and a.djbs=1  and kh.ccid+'-' like @khid and sp.kfbh=@kfbh
                         group by a.sphh,sp.spmc
{"lx":"sphh","khid":"249","mdid":"","sphh":"","lbid":"","kfbh":"all","ksrq":"","jsrq":"","khlb":"","roleid":"4","curkhid":"249","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:22:05】  销售数据查询结束！
【2016-10-10 8:22:05】  @khid=-1-249-%
【2016-10-10 8:22:05】  @kfbh=all
【2016-10-10 8:22:05】  dt_dd-rows:24281 dt_ls-rows:0
【2016-10-10 8:56:38】   select sp.sphh,sp.spmc,'' zzl,'' bhl,sum(a.sl) ddsl
                            from yx_v_dddjmx a                                                            
                             inner join yx_t_spdmb sp on a.sphh=sp.sphh                                 
                            where a.djlx=201 and a.djbs=1  and a.rq>=convert(datetime,@ksrq) and a.rq<dateadd(day,1,convert(datetime,@jsrq)) and a.khid=@mdkhid
                            group by sp.sphh,sp.spmc order by sum(a.sl) desc
{"lx":"sphh","khid":"17832","mdid":"18090","sphh":"","lbid":"","kfbh":"","ksrq":"2016-10-01","jsrq":"2016-10-10","khlb":"","roleid":"4","curkhid":"17832","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:56:38】  订单数据查询结束！server='192.168.35.11';database=FXDB;uid=ABEASD14AD;pwd=+AuDkDew
【2016-10-10 8:56:38】  select a.sphh,sp.spmc,sum(a.djlb/abs(a.djlb)*sl) xssl
                         from zmd_v_lsdjmx a
                          inner join yx_t_spdmb sp on a.sphh=sp.sphh  inner join t_mdb md on a.mdid=md.mdid and md.ty=0  inner join yx_t_khb kh on md.khid=kh.khid and kh.ty=0 
                         where a.djlb in (1,-1,2,-2) and a.djbs=1  and kh.ccid+'-' like @khid and a.rq>=convert(datetime,@ksrq) and a.rq<convert(datetime,@jsrq) and a.khid=@mdkhid
                         group by a.sphh,sp.spmc
{"lx":"sphh","khid":"17832","mdid":"18090","sphh":"","lbid":"","kfbh":"","ksrq":"2016-10-01","jsrq":"2016-10-10","khlb":"","roleid":"4","curkhid":"17832","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:56:39】  销售数据查询结束！
【2016-10-10 8:56:39】  @khid=-1-17832-%
【2016-10-10 8:56:39】  @ksrq=2016-10-01
【2016-10-10 8:56:39】  @jsrq=2016-10-10
【2016-10-10 8:56:39】  @mdkhid=18090
【2016-10-10 8:56:39】  dt_dd-rows:0 dt_ls-rows:358
【2016-10-10 8:56:43】   select sp.sphh,sp.spmc,'' zzl,'' bhl,sum(a.sl) ddsl
                            from yx_v_dddjmx a                                                            
                             inner join yx_t_spdmb sp on a.sphh=sp.sphh                                 
                            where a.djlx=201 and a.djbs=1  and a.rq>=convert(datetime,@ksrq) and a.rq<dateadd(day,1,convert(datetime,@jsrq)) and a.tzid=1 and a.khid=@khid
                            group by sp.sphh,sp.spmc order by sum(a.sl) desc
{"lx":"sphh","khid":"249","mdid":"","sphh":"","lbid":"","kfbh":"","ksrq":"2016-10-01","jsrq":"2016-10-10","khlb":"","roleid":"4","curkhid":"249","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:56:43】  订单数据查询结束！server='192.168.35.10';database=tlsoft;uid=ABEASD14AD;pwd=+AuDkDew
【2016-10-10 8:56:43】  select a.sphh,sp.spmc,sum(a.djlb/abs(a.djlb)*sl) xssl
                         from zmd_v_lsdjmx a
                          inner join yx_t_spdmb sp on a.sphh=sp.sphh  inner join t_mdb md on a.mdid=md.mdid and md.ty=0  inner join yx_t_khb kh on md.khid=kh.khid and kh.ty=0 
                         where a.djlb in (1,-1,2,-2) and a.djbs=1  and kh.ccid+'-' like @khid and a.rq>=convert(datetime,@ksrq) and a.rq<convert(datetime,@jsrq)
                         group by a.sphh,sp.spmc
{"lx":"sphh","khid":"249","mdid":"","sphh":"","lbid":"","kfbh":"","ksrq":"2016-10-01","jsrq":"2016-10-10","khlb":"","roleid":"4","curkhid":"249","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:56:44】  销售数据查询结束！
【2016-10-10 8:56:44】  @khid=-1-249-%
【2016-10-10 8:56:44】  @ksrq=2016-10-01
【2016-10-10 8:56:44】  @jsrq=2016-10-10
【2016-10-10 8:56:44】  dt_dd-rows:31 dt_ls-rows:354
【2016-10-10 8:56:48】   select a.khid,kh.khmc,sum(a.sl) ddsl
                            from yx_v_dddjmx a                                                            
                             inner join yx_t_khb kh on a.khid=kh.khid and kh.ty=0                                 
                            where a.djlx=201 and a.djbs=1  and a.rq>=convert(datetime,@ksrq) and a.rq<dateadd(day,1,convert(datetime,@jsrq)) and a.khid=@mdkhid
                            group by a.khid,kh.khmc order by sum(a.sl) desc
{"lx":"md","khid":"17832","mdid":"18090","sphh":"","lbid":"","kfbh":"","ksrq":"2016-10-01","jsrq":"2016-10-10","khlb":"","roleid":"4","curkhid":"17832","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:56:48】  订单数据查询结束！server='192.168.35.11';database=FXDB;uid=ABEASD14AD;pwd=+AuDkDew
【2016-10-10 8:56:48】  select a.khid,m.khmc,sum(a.djlb/abs(a.djlb)*sl) xssl
                          from zmd_v_lsdjmx a                          
                          inner join yx_t_khb m on a.khid=m.khid
                           inner join t_mdb md on a.mdid=md.mdid and md.ty=0  inner join yx_t_khb kh on md.khid=kh.khid and kh.ty=0                                                     
                          where a.djlb in (1,-1,2,-2) and a.djbs=1  and kh.ccid+'-' like @khid and a.rq>=convert(datetime,@ksrq) and a.rq<convert(datetime,@jsrq) and a.khid=@mdkhid
                          group by a.khid,m.khmc
{"lx":"md","khid":"17832","mdid":"18090","sphh":"","lbid":"","kfbh":"","ksrq":"2016-10-01","jsrq":"2016-10-10","khlb":"","roleid":"4","curkhid":"17832","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:56:49】  销售数据查询结束！
【2016-10-10 8:56:49】  @khid=-1-17832-%
【2016-10-10 8:56:49】  @ksrq=2016-10-01
【2016-10-10 8:56:49】  @jsrq=2016-10-10
【2016-10-10 8:56:49】  @mdkhid=18090
【2016-10-10 8:56:49】  dt_dd-rows:0 dt_ls-rows:1
【2016-10-10 8:56:53】   select a.khid,kh.khmc,sum(a.sl) ddsl
                            from yx_v_dddjmx a                                                            
                             inner join yx_t_khb kh on a.khid=kh.khid and kh.ty=0                                 
                            where a.djlx=201 and a.djbs=1  and a.rq>=convert(datetime,@ksrq) and a.rq<dateadd(day,1,convert(datetime,@jsrq)) and a.tzid='249'
                            group by a.khid,kh.khmc order by sum(a.sl) desc
{"lx":"md","khid":"249","mdid":"","sphh":"","lbid":"","kfbh":"","ksrq":"2016-10-01","jsrq":"2016-10-10","khlb":"","roleid":"4","curkhid":"249","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:56:53】  订单数据查询结束！server='192.168.35.11';database=FXDB;uid=ABEASD14AD;pwd=+AuDkDew
【2016-10-10 8:56:53】  select a.khid,m.khmc,sum(a.djlb/abs(a.djlb)*sl) xssl
                          from zmd_v_lsdjmx a                          
                          inner join yx_t_khb m on a.khid=m.khid
                           inner join t_mdb md on a.mdid=md.mdid and md.ty=0  inner join yx_t_khb kh on md.khid=kh.khid and kh.ty=0                                                     
                          where a.djlb in (1,-1,2,-2) and a.djbs=1  and kh.ccid+'-' like @khid and a.rq>=convert(datetime,@ksrq) and a.rq<convert(datetime,@jsrq)
                          group by a.khid,m.khmc
{"lx":"md","khid":"249","mdid":"","sphh":"","lbid":"","kfbh":"","ksrq":"2016-10-01","jsrq":"2016-10-10","khlb":"","roleid":"4","curkhid":"249","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:56:56】  销售数据查询结束！
【2016-10-10 8:56:56】  @khid=-1-249-%
【2016-10-10 8:56:56】  @ksrq=2016-10-01
【2016-10-10 8:56:56】  @jsrq=2016-10-10
【2016-10-10 8:56:56】  dt_dd-rows:0 dt_ls-rows:1
【2016-10-10 8:56:57】   select lb.id lbid,lb.mc lbmc,'' zzl,'' bhl,sum(a.sl) ddsl
                            from yx_v_dddjmx a                                                            
                             inner join yx_t_spdmb sp on a.sphh=sp.sphh  inner join yx_t_splb lb on sp.splbid=lb.id                                 
                            where a.djlx=201 and a.djbs=1  and a.rq>=convert(datetime,@ksrq) and a.rq<dateadd(day,1,convert(datetime,@jsrq)) and a.khid=@mdkhid
                            group by lb.id,lb.mc order by sum(a.sl) desc
{"lx":"lb","khid":"249","mdid":"249","sphh":"","lbid":"","kfbh":"","ksrq":"2016-10-01","jsrq":"2016-10-10","khlb":"","roleid":"4","curkhid":"249","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:56:57】  订单数据查询结束！server='192.168.35.11';database=FXDB;uid=ABEASD14AD;pwd=+AuDkDew
【2016-10-10 8:56:57】  select sp.splbid lbid,lb.mc lbmc,sum(a.djlb/abs(a.djlb)*sl) xssl
                         from zmd_v_lsdjmx a
                          inner join yx_t_spdmb sp on a.sphh=sp.sphh  inner join yx_t_splb lb on sp.splbid=lb.id  inner join t_mdb md on a.mdid=md.mdid and md.ty=0  inner join yx_t_khb kh on md.khid=kh.khid and kh.ty=0 
                         where a.djlb in (1,-1,2,-2) and a.djbs=1  and kh.ccid+'-' like @khid and a.rq>=convert(datetime,@ksrq) and a.rq<convert(datetime,@jsrq) and a.khid=@mdkhid
                         group by sp.splbid,lb.mc
{"lx":"lb","khid":"249","mdid":"249","sphh":"","lbid":"","kfbh":"","ksrq":"2016-10-01","jsrq":"2016-10-10","khlb":"","roleid":"4","curkhid":"249","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-10 8:56:58】  销售数据查询结束！
【2016-10-10 8:56:58】  @khid=-1-249-%
【2016-10-10 8:56:58】  @ksrq=2016-10-01
【2016-10-10 8:56:58】  @jsrq=2016-10-10
【2016-10-10 8:56:58】  @mdkhid=249
【2016-10-10 8:56:58】  dt_dd-rows:0 dt_ls-rows:31
