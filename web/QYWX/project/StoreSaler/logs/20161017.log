【2016-10-17 10:06:57】  select sp.sphh,sp.spmc,sum(a.sl) ddsl into #zb
                            from yx_v_dddjmx a                            
                             inner join yx_t_spdmb sp on a.sphh=sp.sphh                                 
                            where a.tzid=1 and a.djlx=201 and a.djbs=1  and a.rq>=convert(datetime,@ksrq) and a.rq<dateadd(day,1,convert(datetime,@jsrq))
                            group by sp.sphh,sp.spmc order by sum(a.sl) desc;
                            --备货量与周转量
                            select distinct sphh into #sphh from #zb;
                            select a.sphh,isnull(a.tcl,0) tcl,c.bhl,isnull(a.tcl,0)-isnull(b.ddsl,0) zzl into #zzbh
                            from #sphh s
                            left join (
                              --统筹计划量
                              select a.sphh,sum(b.sl0) tcl 
                              from #sphh s inner join yx_t_tcjhb a on s.sphh=a.sphh
                              inner join yx_t_tcjhcmmx b on a.id=b.id
                              where a.tzid=1 and a.shbs=1 group by a.sphh
                            ) a on s.sphh=a.sphh
                              --订单数量
                            left join (
                              select a.sphh,sum(a.sl) ddsl  
                              from #sphh s inner join yx_v_dddjmx a on a.sphh=s.sphh
                              where a.djlx=201 and a.djbs=1 group by a.sphh
                            ) b on a.sphh=b.sphh
                            left join (
                              --备货库存
                              select a.sphh,sum(a.sl0-a.dbdf0-a.qtdf0) bhl 
                              from #sphh s inner join YX_T_Spkccmmx a on a.sphh=s.sphh
                              where a.tzid=1 and a.ckid not in (9325,6671,7013) group by a.sphh
                            ) c on a.sphh=c.sphh
                            
                            select a.*,b.zzl,b.bhl from #zb a left join #zzbh b on a.sphh=b.sphh

                            drop table #zb;drop table #sphh;drop table #zzbh;
{"lx":"sphh","khid":"","mdid":"","sphh":"","lbid":"","kfbh":"","ksrq":"2016-10-01","jsrq":"2016-10-17","khlb":"","roleid":"3","curkhid":"","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-17 10:06:59】  订单数据查询结束！server='192.168.35.10';database=tlsoft;uid=ABEASD14AD;pwd=+AuDkDew
【2016-10-17 10:06:59】  select a.sphh,sp.spmc,sum(a.djlb/abs(a.djlb)*sl) xssl
                         from zmd_v_lsdjmx a
                          inner join yx_t_spdmb sp on a.sphh=sp.sphh 
                         where a.djlb in (1,-1,2,-2) and a.djbs=1  and a.rq>=convert(datetime,@ksrq) and a.rq<convert(datetime,@jsrq)
                         group by a.sphh,sp.spmc
{"lx":"sphh","khid":"","mdid":"","sphh":"","lbid":"","kfbh":"","ksrq":"2016-10-01","jsrq":"2016-10-17","khlb":"","roleid":"3","curkhid":"","curkhfl":"","order":{"col":"","direc":""}}
【2016-10-17 10:07:01】  销售数据查询结束！
【2016-10-17 10:07:01】  @ksrq=2016-10-01
【2016-10-17 10:07:01】  @jsrq=2016-10-17
【2016-10-17 10:07:01】  dt_dd-rows:871 dt_ls-rows:15468
