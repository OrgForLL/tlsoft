<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,maximum-scale=1" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <title></title>
    <link rel="stylesheet" type="text/css" href="./css/LeePageSlider.css" />
    <style type="text/css">
    html {
        -webkit-user-select: none;
        user-select: none;
    }
    
    .global_mask {
        position: fixed;
        z-index: 8000;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.6);
        display: none;
    }
    
    .loading {
        position: fixed;
        z-index: 8004;
        width: 120px;
        height: 80px;
        top: 50%;
        left: 50%;
        -webkit-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
        background-color: rgba(0, 0, 0, .4);
        text-align: center;
        border-radius: 3px;
        overflow: hidden;
        color: #fff;
        align-items: center;
        flex-direction: column;
        justify-content: center;
        display: none;
    }
    
    .loading>img {
        width: 28px;
        height: 28px;
        margin-bottom: 5px;
    }
    
    .page {
        background-color: #efefef;
        padding: 0
    }
    
    .page-not-footer {
        bottom: 0px;
    }
    
    .footer {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 40px;
        background-color: #209ba3;
        color: #fff;
        font-weight: bold;
        font-size: 16px;
    }
    
    .footer a {
        color: #fff;
        display: flex;
        width: 100%;
        height: 100%;
        justify-content: center;
        align-items: center;
    }
    
    #list {
        padding-bottom: 20px;
    }
    
    .list_item {
        background-color: #fff;
        position: relative;
        margin-top: 20px;
        display: block;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }
    
    #list .title {
        padding: 20px 20px 0 20px;
    }
    
    .title p:first-child {
        font-size: 20px;
        font-weight: 600;
    }
    
    .title p:last-child {
        font-style: italic;
    }
    
    .list_item:active {
        background-color: #f8f8f8;
    }
    
    .list_item:before {
        content: " ";
        position: absolute;
        left: 0;
        top: 0;
        right: 0;
        height: 1px;
        border-top: 1px solid #e5e5e5;
        color: #e5e5e5;
        -webkit-transform-origin: 0 0;
        transform-origin: 0 0;
        -webkit-transform: scaleY(0.5);
        transform: scaleY(0.5);
    }
    
    .list_item:after {
        content: " ";
        position: absolute;
        left: 0;
        bottom: 0;
        right: 0;
        height: 1px;
        border-bottom: 1px solid #e5e5e5;
        color: #e5e5e5;
        -webkit-transform-origin: 0 100%;
        transform-origin: 0 100%;
        -webkit-transform: scaleY(0.5);
        transform: scaleY(0.5);
    }
    
    .list_item .hd {
        position: relative;
        padding: 10px 15px;
        text-align: right;
        line-height: 2.8em;
    }
    
    .hd:after {
        content: " ";
        position: absolute;
        left: 0;
        bottom: 0;
        right: 0;
        height: 1px;
        border-bottom: 1px solid #e5e5e5;
        color: #e5e5e5;
        -webkit-transform-origin: 0 100%;
        transform-origin: 0 100%;
        -webkit-transform: scaleY(0.5);
        transform: scaleY(0.5);
        left: 15px;
    }
    
    .hd label,
    .bd label {
        float: left;
        margin-right: 0.8em;
        min-width: 4.5em;
        color: #999999;
        text-align: justify;
        text-align-last: justify;
    }
    
    .hd label {
        font-weight: 600;
    }
    
    .hd em {
        display: block;
        overflow: hidden;
        word-break: normal;
        word-wrap: break-word;
        font-style: normal;
        font-size: 1.55em;
        color: #209ba3;
    }
    
    .bd {
        padding: 10px 15px;
        font-size: 1.1em;
        text-align: right;
        color: #999999;
        line-height: 2.4;
    }
    
    .item.remark .value {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .bd .item {
        overflow: hidden;
    }
    
    .no-result {
        color: #bbb;
        font-style: italic;
        display: none;
    }
    </style>
</head>

<body ontouchstart>
    <!--全局遮罩层-->
    <div class="global_mask"></div>
    <div class="loading">
        <img src="./my_loading.gif" />
        <p class="loading_txt">加载中..</p>
    </div>
    <div class="wrap-page">
        <div class="page page-not-footer" id="list">
            <div class="title">
                <p>利郎 - 单店月费用申报
                </p>
                <p>LILANZ Expense Declaration</p>
            </div>
            <div class="list_wrap"></div>
            <p class="no-result center-translate">Sorry，暂时无申报记录..</p>
        </div>
        <!-- <div class="footer">
            <a href="expenDetail.html?id=0">添 加</a>
        </div> -->
        <script type="text/html" id="tpl_listItem">
            <a class="list_item" data-id="{{id}}">
                <div class="hd">
                    <label>报销总金额</label>
                    <em>¥{{je}}</em>
                </div>
                <div class="bd">
                    <div class="item">
                        <label>年月-单据号</label>
                        <span class="value">{{ny}} - {{djh}}</span>
                    </div>
                    <div class="item">
                        <label>客户名称</label>
                        <span class="value">{{khmc}}</span>
                    </div>
                    <div class="item">
                        <label>日期</label>
                        <span class="value">{{rq}}</span>
                    </div>
                    <div class="item remark">
                        <label>备注</label>
                        <span class="value">{{bz}}</span>
                    </div>
                </div>
            </a>
        </script>
        <script type="text/javascript" src="./js/jquery.js"></script>
        <script type="text/javascript" src="./js/template.js"></script>
        <script type="text/javascript" src="./js/fastclick.min.js"></script>
        <script type="text/javascript" src="./js/lilanzAppWVJBridge-0.1.5.min.js"></script>
        <script type="text/javascript">
        $(function() {
            //测试地址http://tm.lilanz.com/QYWX/project/Myddyfysb/MyddyfysbApi.aspx
            var baseApi = "MyddyfysbApi.aspx";
            var apptoken = getUrlParam("apptoken");
            function showLoading(text) {
                text = text || '加载中..';
                $(".loading_txt").text(text);
                $(".global_mask").show();
                $(".loading").css("display", "flex");
            };

            function hideLoading() {
                $(".global_mask").add(".loading").hide();
            }

            //获取地址栏参数
            function getUrlParam(name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]);
                return null;
            }

            function loadMainList() {
                
                showLoading("正在加载列表..");
                setTimeout(function() {
                    $.ajax({
                        type: "POST",
                        timeout: 5 * 1000,
                        contentType: "application/x-www-form-urlencoded; charset=utf-8",
                        data: {
                            method: "getYfysbList",
                            apptoken: apptoken
                        },
                        url: baseApi
                    }).done(function(msg) {
                        var data = JSON.parse(msg);
                        if (data.code == 200) {
                            if (data.list.length == 0) {
                                $('.no-result').show();
                                hideLoading();
                            } else {
                                var html = "";
                                for (var i = 0; i < data.list.length; i++) {
                                    var row = data.list[i];
                                    row.je = formatMoney(row.je, 2);
                                    html += template("tpl_listItem", row);
                                } //end for
                                $(".list_wrap").append(html);
                                hideLoading();
                            }
                        } else {
                            showLoading(data.msg);
                        }
                    }).fail(function(XMLHttpRequest, textStatus, errorThrown) {
                        console.log(XMLHttpRequest.status + "|" + XMLHttpRequest.statusText);
                    });
                }, 50);
            }

            function formatMoney(s, n) {
                n = n > 0 && n <= 20 ? n : 2;
                s = parseFloat((s + "").replace(/[^\d\.-]/g, "")).toFixed(n) + "";
                var l = s.split(".")[0].split("").reverse(),
                    r = s.split(".")[1];
                t = "";
                for (i = 0; i < l.length; i++) {
                    t += l[i] + ((i + 1) % 3 == 0 && (i + 1) != l.length ? "," : "");
                }
                return t.split("").reverse().join("") + "." + r;
            }

            function init() {
                llApp.init().then(function(msg) {
                    llApp.setStatusBar("#efefef", "black");
                });
                loadMainList();
                bindEvents();
                FastClick.attach(document.body);
            }

            function bindEvents() {
                $("#list").on("click", ".list_item", function() {
                    var id = $(this).attr("data-id");
                    window.location.href = "expenDetail.html?id=" + id + "&apptoken=" + apptoken;
                });
            }

            init();
        });
        </script>
</body>

</html>
