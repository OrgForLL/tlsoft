<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,maximum-scale=1" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <title>移动盘点</title>
    <link type="text/css" rel="stylesheet" href="../../res/css/LeePageSlider.css" />
    <style type="text/css">
        .page {
            background-color: #f3f3f3;
            padding: 0;
        }

            .page > .tips {
                color: #666;
                font-style: italic;
                padding: 10px 15px;
            }

        .tips .total_num {
            background-color: #0b9444;
            color: #fff;
            font-style: normal;
            padding: 2px 6px;
            margin-left: 10px;
            border-radius: 3px;
            font-weight: 600;
        }

        .list_table {
            margin-top: 10px;
            position: absolute;
            width: 100%;
            background-color: #f3f3f3;
            bottom: 0;
            top: 39px;
        }

        .table_head,
        .table_con {
            width: 100%;
        }

            .table_head th,
            .table_con th,
            .table_con td {
                text-align: center;
            }

            .table_head th,
            .table_con th {
                background-color: #e6e8ed;
                padding: 8px 0;
                border-bottom: 1px solid #eee;
                border-top: 1px solid #eee;
            }

        .table_head {
            position: absolute;
            z-index: 1000;
        }

        .table_con_wrap {
            position: absolute;
            top: 0;
            width: 100%;
            bottom: 0;
            overflow-y: auto;
            -webkit-overflow-scroll: touch;
        }

        .table_con td {
            padding: 13px 0;
            border-bottom: 1px solid #eee;
            color: #555;
        }

        .table_con tr:nth-child(even) {
            background-color: #f3fcef;
        }

        .table_con tr:nth-child(odd) {
            background-color: #fff;
        }

        .layui-layer-dialog {
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%,-50%);
        }

        .layui-layer-hui .layui-layer-content {
            padding: 12px !important;
        }

        #last_num {
        }
    </style>
</head>

<body>
    <div class="wrap_page">
        <div class="page">
            <p class="tips">当天刷码总量<span class="total_num"></span></p>
            <div class="list_table">
                <table class="table_head" cellpadding="0" cellspacing="0">
                    <thead>
                        <tr>
                            <th class="head_date" width="30%">日期</th>
                            <th class="head_djh" width="20%">单据号</th>
                            <th class="head_num" width="20%">数量</th>
                            <th class="head_num" width="10%"></th>
                            <th class="head_num" width="10%"></th>
                            <th class="head_num" width="10%"></th>
                        </tr>
                    </thead>
                </table>
                <div class="table_con_wrap">
                    <table class="table_con" cellpadding="0" cellspacing="0">
                        <thead style="visibility: hidden;">
                            <tr>
                                <th class="head_date" width="30%">日期</th>
                                <th class="head_djh" width="20%">单据号</th>
                                <th class="head_num" width="20%">数量</th>
                                <th class="head_num" width="10%"></th>
                                <th class="head_num" width="10%"></th>
                                <th class="head_num" width="10%"></th>
                            </tr>
                        </thead>
                        <tbody id="list">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="../../res/js/jquery.js"></script>
    <script type="text/javascript" src="../../res/js/fastclick.min.js"></script>
    <script type="text/javascript" src="./layerui/layui.js"></script>
    <script type="text/javascript">
        var app_tzid = localStorage.getItem("app_tzid");
        if (app_tzid === null || app_tzid === undefined)
            app_tzid = "";
        //apptoken = UrlSearch();
        //alert(apptoken);
        var dept = "";
        var name = "";
        var tzid = "";
        var userid = "";
        var layer = null;
        var apptoken = getQueryString("apptoken");
        //获取URL参数
        function getQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]);
            return "";
        };
        getUser(apptoken);
        setTimeout(function () {
            getList();
        }, 300);

        function getUser(apptoken) {
            var para = {};
            para.action = "getUserinfo";
            para.token = apptoken;
            para.dept = "";
            para.Parameter = [app_tzid];
            para.orgid = tzid;
            user(para);
        }
        function user(para) {
            $.ajax({
                url: "./checkScan.ashx",
                type: "POST",
                dataType: "text",
                contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                timeout: 10*1000,
                data: JSON.stringify(para),
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                },
                success: function (data) {
                    console.log(data);
                    var dt = JSON.parse(data);
                    if (dt.code == 200) {
                        dept = dt.data.dept;
                        name = dt.data.cname;
                        tzid = dt.data.tzid;
                        userid = dt.data.userid;
                        var par = new Array()
                        par[0] = tzid;
                        par[1] = userid;
                        $("#username").text(name);
                        //getDepot(apptoken, dept, par);
                        //getCompanyname(apptoken, dept, par);
                    } else {
                        //alert("获取用户信息失败！");
                        layer.msg('获取用户信息失败', { time: 1200 });
                    }
                }//end success
            });
        }
        var $list = $("#list");
        //alert($list)
        function getList() {
            var para = {};

            var par = new Array();
            par[0] = tzid;
            par[1] = name;
            para.action = "getGoodslist";
            para.token = apptoken;
            para.dept = dept;
            para.Parameter = par;
            para.orgid = tzid;
            List(para);
        }
        function List(para) {
            $.ajax({
                url: "./checkScan.ashx",
                type: "POST",
                dataType: "text",
                contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                timeout: 10*1000,
                data: JSON.stringify(para),
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                },
                success: function (data) {
                    console.log(data);
                    var dt = JSON.parse(data);
                    var sl = 0;
                    if (dt.code == 200) {
                        for (var m = 0; m < dt.data.length; m++) {
                            var rtn = dt.data[m];
                            sl += rtn.sl;
                            $list.prepend("<tr><td>" + rtn.zdrq + "</td><td>" + rtn.djh + "</td><td>" + rtn.sl + "</td><td onclick='bclick(" + rtn.id + ")'>补单</td><td onclick='dclick(" + rtn.id + ")'>查看</td><td onclick='cclick(" + rtn.id + ")'>汇总</td></tr>");
                        }
                        $(".total_num").text(sl);
                    } else {
                        //alert("无列表或获取列表信息失败！");
                        layer.msg('无列表或获取列表信息失败', { time: 1200 });
                        $(".total_num").text(0);
                    }
                }//end success
            });
        }

        function bclick(id) {
            //alert(id);
            window.location.href = "checkScan.html?apptoken=" + apptoken + "&mode=bd&id=" + id;
        }
        function cclick(id) {
            window.location.href = "scanDetail.html?apptoken=" + apptoken + "&dept=" + dept + "&id=" + id + "&tzid=" + tzid;
        }

        function dclick(id) {
            window.location.href = "checkScan.html?apptoken=" + apptoken + "&mode=ck&id=" + id;
        }
        layui.use(['layer'], function () {
            layer = layui.layer;
            layer.config({
                anim: 5,
                isOutAnim: false
            })
        });
        $(function () {

            function bindEvents() {

                $(".table_con").on("click", "tr", function () {
                    window.location.href = "scanDetail.html";
                });
            }

            function init() {
                FastClick.attach($(".table_con tr")[0]);
                bindEvents();
            }

            //init();
        });
    </script>
</body>

</html>