<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title></title>
    <link type="text/css" rel="stylesheet" href="../../res/css/font-awesome.min.css" />
    <style type="text/css">
        * {
            padding: 0;
            margin: 0;
        }

        body {
            color: #333;
            font-family: "微软雅黑";
            background: #f7f7f7;
            padding: 15px 12px;
        }

        .container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }

        .item {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #333;
            box-sizing: border-box;
            border-top: 4px solid #333;
            cursor: pointer;
            color: #000;
            background: #fff;
            opacity:0;
        }

            .item:not(:first-child) {
                margin-top: 15px;
            }

            .item:hover {
                color: #d9534f;
            }

        .imgarea {
            width: 100%;
            height: 150px;
            margin: 0px auto 10px auto;
            overflow:hidden;
        }

            .imgarea img {
                width:100%;
                height:auto;
            }

        .backgroundCover {
            -moz-background-size: cover;
            -webkit-background-size: cover;
            background-size: cover;
        }

        .item p {
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .item .title {
            font-weight: bold;
            font-size: 1.2em;
            letter-spacing: 1px;
            width: 94%;
            margin: 0 auto;
        }

        .item .more {
            margin: 4px auto;
            padding-bottom: 5px;
            width: 80%;
            border-bottom: 1px solid #ccc;
        }

        .item .atime {
            color: #838383;
            font-size: 1em;
        }

        .atime i {
            margin-right: 5px;
        }

        .loadmore, .infolab {
            text-align: center;
            margin: 30px auto 20px auto;
        }

            .loadmore a {
                text-decoration: none;
                color: #333;
                font-weight: bold;
                padding: 8px;
                border: 1px solid #333;
                border-top: 4px solid #333;
            }

        .infolab {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="item">
            <div class="imgarea"><img src="img/p1.jpg" /></div>
            <p class="title">文章标题文章标题文章标题文章标题</p>
            <p class="more">- 点击入内查看详情 -</p>
            <p class="atime"><i class="fa fa-clock-o"></i>2015.01.01 14:20:54</p>
        </div>
        <div class="item">
            <div class="imgarea backgroundCover" style="background: url('img/p2.jpg')"></div>
            <p class="title">文章标题</p>
            <p class="more">- 点击入内查看详情 -</p>
            <p class="atime"><i class="fa fa-clock-o"></i>2015.01.01</p>
        </div>
        <div class="item">
            <div class="imgarea backgroundCover" style="background: url('img/p1.jpg')"></div>
            <p class="title">文章标题</p>
            <p class="more">- 点击入内查看详情 -</p>
            <p class="atime"><i class="fa fa-clock-o"></i>2015.01.01</p>
        </div>
        <div class="item">
            <div class="imgarea backgroundCover" style="background: url('img/p2.jpg')"></div>
            <p class="title">文章标题</p>
            <p class="more">- 点击入内查看详情 -</p>
            <p class="atime"><i class="fa fa-clock-o"></i>2015.01.01</p>
        </div>
    </div>
    <div class="infolab">
        正在加载...
    </div>
    <div class="loadmore">
        <a id="morelink" href="javascript:getArticleList()">点击加载更多</a>
    </div>
    <script type="text/javascript" src="../../res/js/jquery.js"></script>
    <script type="text/javascript">
        var ssid = "", lastid = "0";
        window.onload = function () {
            ssid = GetQueryString("ssid");            
            $(".container").children().remove();
            if (ssid == "" || ssid == null) {
                $(".infolab").text("请传入参数SSID！");
                return;
            }
            getArticleList();
        }
        //获取URL参数
        function GetQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]); return null;
        }

        function getArticleList() {
            $(".infolab").text("正在加载，请稍候...");
            $.ajax({
                type: "POST",
                timeout: 3000,
                async: false,
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                url: "../../WebBLL/AjaxuploadHandler.aspx?ctrl=loadArticleList2",
                data: { ssid: ssid, lastid: lastid },
                success: function (msg) {
                    if (msg == "") {
                        $(".infolab").text("- 无更多数据了 -").show();
                        $(".loadmore").hide();
                    }else if (msg.indexOf("Successed") > -1) {
                        var jsondata = JSON.parse(msg.replace("Successed:", ""));
                        //处理返回的JSON数据          
                        var htmlstr = "", imgfile = "";
                        var bn = jsondata.rows.length;
                        for (var i = 0; i < bn; i++) {
                            var row = jsondata.rows[i];
                            htmlstr += "<div class='item' aid='" + row.id + "' rel='load' onclick='gourl(" + row.id + ")'>";
                            imgfile = (row.imgurl == "") ? "../../res/img/WXArticles/default.jpg" : row.imgurl;
                            htmlstr += "<div class='imgarea'><img src='" + imgfile + "' /></div>";
                            htmlstr += "<p class='title'>" + row.title + "</p>";
                            htmlstr += "<p class='more'>- 点击入内查看详情 -</p>";
                            htmlstr += "<p class='atime'><i class='fa fa-clock-o'></i>" + row.cretime + "</p>";
                            htmlstr += "</div>";
                        }
                        $(".container").append(htmlstr);
                        $(".infolab").hide();
                        lastid = $(".item:last-child").attr("aid");
                        var obj = $(".container").children('[rel!=loaded]');
                        obj.attr("rel", "loaded");
                        obj.fadeInWithDelay();
                    } else
                        $(".infolab").text(msg);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    $(".infolab").text("您的网络好像有点问题，请刷新重试！");
                }
            });
        }

        $.fn.fadeInWithDelay = function () {
            var delay = 0;
            return this.each(function () {
                $(this).delay(delay).animate({ opacity: 1 }, 200);                
                delay += 200;
            });
        };

        function gourl(aid) {
            window.location.replace("showarticle.aspx?id=" + aid);
        }
    </script>
</body>
</html>
